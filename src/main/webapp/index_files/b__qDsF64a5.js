/*!CK:235595481!*//*1408393528,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["n9Gk4"]); }

__d("VideoCallingTour",["Arbiter","ArbiterMixin","Chat","ChatSidebar","ChatVisibility","CSS","DOM","PresencePrivacy","Run","Toggler","Vector","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s,t,u,v,w=[],x=function(){};function y(){if(j.isVisible()){z();}else if(u)aa();}function z(){s.setContext(t.getBody());ba();s.show();ca();}function aa(){if(!v)v=p.createInstance(u.getRoot());var fa=m.scry(u.getRoot(),'div.fbNubFlyout')[0];if(fa){s.setContext(fa);ba();s.show();ca();}}function ba(){var fa=q.getElementDimensions(s.getContext()).y;s.setOffsetY(fa*.6);s.updatePosition();}function ca(){if(u)w.push(u.subscribe('hide',function(){da();if(!j.isVisible())s.hide();}),u.subscribe('show',function(){s.show();}),u.subscribe('resize',function(){ba();s.updatePosition();}));w.push(g.subscribe('sidebar/show',z),g.subscribe('sidebar/hide',aa),g.subscribe('sidebar/resized',ba));}function da(){if(v){v.setSticky(false);v=null;}}function ea(){while(w.length)w.pop().unsubscribe();if(u)da();s.hide();l.show('fbVideoCallingGetStarted');}r(x,h,{start:function(fa){s=fa;l.hide('fbVideoCallingGetStarted');k.goOnline(function(){w.push(n.subscribe('privacy-user-presence-changed',ea));o.onLeave(ea);i.openBuddyList();var ga=null;w.push(j.subscribe('sidebar/initialized',function(ha,ia){t=ia;clearTimeout(ga);ga=setTimeout(y,0);}),x.subscribe('videocallingtour/end',ea));w.push(g.subscribe('buddylist-nub/initialized',function(ha,ia){u=ia;clearTimeout(ga);ga=setTimeout(y,0);}));});x.inform('videocallingtour/start');}});e.exports=x;},null);
__d("ContextualLayer.react",["ContextualLayer","React","ReactLayer","Style"],function(a,b,c,d,e,f,g,h,i,j){var k=h.PropTypes,l=i.createClass({propTypes:{contextRef:k.string,context:function(m,n,o){if((m.context==null)==(m.contextRef==null))return new Error(("Exactly one of `context` or `contextRef` must be set on `")+(o+"`."));var p=m[n];if(p!=null){if(typeof p!=='object')return new Error(("Invalid `"+n+"` supplied to `"+o+"`, ")+("expected a React component."));if(h.isValidComponent(p))return new Error(("Invalid `"+n+"` supplied to `"+o+"`, ")+("expected a React component instance. You're passing a React ")+("descriptor."));}}},immutableProps:{modal:null},createLayer:function(m){var n=this._getContextNode(),o={context:n,contextBounds:this.props.contextBounds,position:this.props.position,alignment:this.props.alignment,offsetX:this.props.offsetX,offsetY:this.props.offsetY,addedBehaviors:this.enumerateBehaviors(this.props.behaviors),shouldSetARIAProperties:this.props.shouldSetARIAProperties},p=new g(o,m);this._node=m;this._matchContextSize(this.props);if(this.props.contextBounds)p.setContextWithBounds(n,this.props.contextBounds);p.conditionShow(this.props.shown);return p;},receiveProps:function(m){this.updateBehaviors(m.behaviors);var n=this._getContextNode();if(m.contextBounds){this.layer.setContextWithBounds(n,m.contextBounds);}else this.layer.setContext(n);this._matchContextSize(m);this.layer.setPosition(m.position);this.layer.setAlignment(m.alignment);this.layer.setOffsetX(m.offsetX);this.layer.setOffsetY(m.offsetY);this.layer.conditionShow(m.shown);},_getContextNode:function(){var m;if(this.props.context){m=this.props.context.getDOMNode();}else if(this.props.contextRef)m=this.getNodeForOwnerRef(this.props.contextRef);return m;},_matchContextSize:function(m){var n=this._node,o=this._getContextNode();if(m.containerWidthMatchContext)j.set(n,'width',o.offsetWidth+'px');if(m.containerHeightMatchContext)j.set(n,'height',o.offsetHeight+'px');}});e.exports=l;},null);
__d("SearchableTextInput.react",["EventListener","React","AbstractTextFieldMixin.react","AbstractTextInput.react","getActiveElement","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=h.createClass({displayName:'SearchableTextInput',propTypes:l(i.propTypes,{queryString:h.PropTypes.string,searchSource:h.PropTypes.object,searchSourceOptions:h.PropTypes.object,onEntriesFound:h.PropTypes.func.isRequired,searchOnFocus:h.PropTypes.bool,searchOnUpdate:h.PropTypes.bool,onPaste:h.PropTypes.func,onFocus:h.PropTypes.func,onChange:h.PropTypes.func}),componentDidMount:function(){if(this.props.onPaste)this._listener=g.listen(this.refs.input.getTextFieldDOM(),'paste',this.props.onPaste);},componentDidUpdate:function(n){if(this.props.searchOnUpdate)if(n.queryString!==this.props.queryString)this.search(this.props.queryString);},componentWillUnmount:function(){if(this._listener){this._listener.remove();this._listener=null;}},_onInputFocus:function(){this.props.searchSource.bootstrap(function(){if(this.props.searchOnFocus)this.search(this.props.queryString);}.bind(this));this.props.onFocus&&this.props.onFocus();},_onSearchCallback:function(n,o){if(this.props.queryString===o)this.props.onEntriesFound(n);},_onChange:function(event){this.props.onChange&&this.props.onChange(event);var n=event.target.value;setTimeout(function(){this.search(n);}.bind(this));},search:function(n){this.props.searchSource.search(n,this._onSearchCallback,this.props.searchSourceOptions);},focusInput:function(){var n=this.getTextFieldDOM();if(k()===n){this._onInputFocus();}else n.offsetHeight&&n.focus();},blurInput:function(){var n=this.getTextFieldDOM();n.offsetHeight&&n.blur();},getTextFieldDOM:function(){return this.refs.input.getTextFieldDOM();},render:function(){return (h.createElement(j,Object.assign({},this.props,{ref:"input",value:this.props.queryString||'',onFocus:this._onInputFocus,onChange:this._onChange})));}});e.exports=m;},null);
__d("TypeaheadNavigation",[],function(a,b,c,d,e,f){var g={moveUp:function(h,i,j){var k=h.indexOf(i),l=k==-1?h.length-1:k-1;j(l==-1?null:h[l]);},moveDown:function(h,i,j){var k=h.indexOf(i)+1;j(k==h.length?null:h[k]);}};e.exports=g;},null);
__d("TypeaheadView.react",["React","cx","merge"],function(a,b,c,d,e,f,g,h,i){var j=g.createClass({displayName:'TypeaheadView',propTypes:{entries:g.PropTypes.array.isRequired,extraRendererProps:g.PropTypes.object,highlightedEntry:g.PropTypes.object,isVisible:g.PropTypes.bool,queryString:g.PropTypes.string,Renderer:g.PropTypes.func.isRequired,selectedEntry:g.PropTypes.object},_onSelect:function(k){if(this.props.onSelect)this.props.onSelect(k);},_onHighlight:function(k){this.props.onHighlight(k);},render:function(){var k=((!this.props.isVisible?"hidden_elem":'')),l=i({highlightedEntry:this.props.highlightedEntry,selectedEntry:this.props.selectedEntry,entries:this.props.entries,onSelect:this._onSelect,onHighlight:this._onHighlight,onRenderHighlight:this.props.onRenderHighlight,queryString:this.props.queryString},this.props.extraRendererProps);return (g.createElement(g.DOM.div,{className:k},this.props.Renderer(l)));}});e.exports=j;},null);
__d("AbstractTypeahead.react",["AbstractTextFieldMixin.react","ContextualLayer.react","InputSelection","React","ReactLayeredComponentMixin","SearchableTextInput.react","TypeaheadNavigation","TypeaheadView.react","cx","getOrCreateDOMID","merge","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=10,t=j.createClass({displayName:'AbstractTypeahead',mixins:[k],propTypes:q(g.propTypes,{inputClassName:j.PropTypes.string,placeholder:j.PropTypes.string,autoCapitalize:j.PropTypes.string,queryString:j.PropTypes.string,searchSource:j.PropTypes.object.isRequired,searchSourceOptions:j.PropTypes.object,excludedEntries:j.PropTypes.object,presenter:j.PropTypes.object.isRequired,onSelectAttempt:j.PropTypes.func,onEnterWithoutSelection:j.PropTypes.func,autoHighlight:j.PropTypes.bool,showEntriesOnFocus:j.PropTypes.bool,selectOnBlur:j.PropTypes.bool,selectOnTab:j.PropTypes.bool,focusedOnInit:j.PropTypes.bool,hideViewWithEntries:j.PropTypes.bool,disabled:j.PropTypes.bool,entriesWidthMatchContext:j.PropTypes.bool,selectedEntry:j.PropTypes.object,onTypeaheadVisibilityChanged:j.PropTypes.func,onPaste:j.PropTypes.func}),getDefaultProps:function(){return {selectOnBlur:false,selectOnTab:true,hideViewWithEntries:true,entriesWidthMatchContext:true};},getInitialState:function(){return {highlightedEntry:null,isAutoHighlight:this.props.autoHighlight,activeDescendant:null,activeEntries:[],focused:!!this.props.focusedOnInit,viewIsVisible:!!this.props.focusedOnInit};},_onRenderHighlight:function(u){var v=p(u);this.setState({activeDescendant:v});},_onEntriesFound:function(u){if(!this.isMounted())return;if(this.props.excludedEntries){var v=this.props.excludedEntries;u=u.filter(function(da){return !v.hasOwnProperty(da.getUniqueID());});}var w=this.props.presenter,x=typeof w.sortEntries=='function'?w.sortEntries(u):u,y=x.slice(0,w.maxEntries||s);if(!y.length){this.setState({activeDescendant:null,activeEntries:y,highlightedEntry:null,isAutoHighlight:this.props.autoHighlight});this._setViewIsVisible(false);return;}var z=this.state.highlightedEntry,aa=z&&y.indexOf(z)!==-1,ba=(this.state.focused&&(this.props.showEntriesOnFocus||this.props.queryString.length>0));if(!this.props.autoHighlight){this.setState({activeEntries:y,highlightedEntry:aa?z:null});if(ba)this._setViewIsVisible(true);return;}var ca=this.state.isAutoHighlight;if(ca){z=y[0];}else{z=aa?z:y[0];ca=!aa;}this.setState({activeEntries:y,highlightedEntry:z,isAutoHighlight:ca});if(ba)this._setViewIsVisible(true);},_onInputFocus:function(){if((this.state.activeEntries.length&&this.state.queryString)||this.props.showEntriesOnFocus)this._setViewIsVisible(true);this.setState({focused:true});this.props.onFocus&&this.props.onFocus();},_onInputBlur:function(){if(this.props.hideViewWithEntries){this._setViewIsVisible(false);this.clearActiveEntries();}if(this.props.selectOnBlur&&this.state.highlightedEntry)this.props.onSelectAttempt(this.state.highlightedEntry);this.setState({focused:false});this.props.onBlur&&this.props.onBlur();},_onInputClick:function(){var u=this.getTextFieldDOM(),v=i.get(u);if(v&&v.start==v.end)u.select();this.props.onClick&&this.props.onClick();},_onEnter:function(event){if(this.props.onEnterWithoutSelection&&(!this.state.viewIsVisible||!this.state.highlightedEntry)){this.props.onEnterWithoutSelection(event);return;}if(!this.state.viewIsVisible)return;if(!this.state.highlightedEntry){event.preventDefault();return;}if(this.props.hideViewWithEntries)this._setViewIsVisible(false);if(this.props.onSelectAttempt)this.props.onSelectAttempt(this.state.highlightedEntry);event.preventDefault();},_onTab:function(event){if(this.props.selectOnTab&&this.state.viewIsVisible&&this.props.onSelectAttempt&&this.state.highlightedEntry){if(this.props.hideViewWithEntries){this._setViewIsVisible(false);event.preventDefault();}this.props.onSelectAttempt(this.state.highlightedEntry);}},_onDownArrow:function(event){event.preventDefault();m.moveDown(this.state.activeEntries,this.state.highlightedEntry,this._setHighlight);},_onUpArrow:function(event){event.preventDefault();m.moveUp(this.state.activeEntries,this.state.highlightedEntry,this._setHighlight);},_setHighlight:function(u){this.setState({highlightedEntry:u,isAutoHighlight:!u});},_onInputChange:function(event){if(this.props.onChange)this.props.onChange(event);this._setViewIsVisible(this.state.focused&&(this.props.showEntriesOnFocus||event.target.value.length>0)&&this.state.activeEntries.length>0);},_onViewHighlight:function(u){this.setState({highlightedEntry:u,isAutoHighlight:false});},_getView:function(){return (j.createElement(n,{Renderer:this.props.presenter.ViewRenderer,extraRendererProps:this.props.presenter.extraRendererProps,highlightedEntry:this.state.highlightedEntry,selectedEntry:this.props.selectedEntry,isVisible:this.state.viewIsVisible,onHighlight:this._onViewHighlight,onRenderHighlight:this._onRenderHighlight,onSelect:this.props.onSelectAttempt,entries:this.state.activeEntries,queryString:this.props.queryString}));},_setViewIsVisible:function(u){if(u!==this.state.viewIsVisible){this.props.onTypeaheadVisibilityChanged&&this.props.onTypeaheadVisibilityChanged(u);this.setState({viewIsVisible:u});}},componentWillReceiveProps:function(u){if(!u.queryString&&!this.props.showEntriesOnFocus)this.clearActiveEntries();},renderLayers:function(){if(!this.props.presenter.useLayer)return {};var u=null,v=null;if(this.props.context){u=this.props.context;}else v='input';return {typeaheadView:j.createElement(h,{behaviors:this.props.presenter.layerBehaviors,containerWidthMatchContext:this.props.entriesWidthMatchContext,contextRef:v,context:u,position:"below",shown:this.state.viewIsVisible,shouldSetARIAProperties:false},this._getView())};},render:function(){var u=j.createElement(l,{'aria-activedescendant':this.state.activeDescendant,'aria-autocomplete':"list",ref:"input",autoCapitalize:this.props.autoCapitalize,className:this.props.inputClassName,queryString:this.props.queryString,placeholder:this.props.placeholder,searchSource:this.props.searchSource,searchSourceOptions:this.props.searchSourceOptions,searchOnFocus:!!this.props.showEntriesOnFocus,disabled:this.props.disabled,onEntriesFound:this._onEntriesFound,onBlur:this._onInputBlur,onFocus:this._onInputFocus,onChange:this._onInputChange,onDownArrow:this._onDownArrow,onUpArrow:this._onUpArrow,onTab:this._onTab,onEnter:this._onEnter,onBackspace:this.props.onBackspace,onPaste:this.props.onPaste,onClick:this._onInputClick}),v=null;if(!this.props.presenter.useLayer)v=this._getView();return (j.createElement(j.DOM.span,Object.assign({},this.props,{className:r(this.props.className,"_58ah"),onBlur:null,onClick:null,onFocus:null}),{searchableInput:u,view:v}));},componentDidMount:function(){if(this.props.focusedOnInit)this.refs.input.focusInput();},clearActiveEntries:function(){this.setState({activeDescendant:null,activeEntries:[],highlightedEntry:null});},focusInput:function(){this.refs.input.focusInput();},blurInput:function(){if(this.refs.input.blur){this.refs.input.blur();}else if(this.refs.input.blurInput)this.refs.input.blurInput();},hideView:function(){this._setViewIsVisible(false);},getTextFieldDOM:function(){return this.refs.input.getTextFieldDOM();}});e.exports=t;},null);
__d("AbstractSearchSource",["Deferred","emptyFunction","mixInto"],function(a,b,c,d,e,f,g,h,i){function j(){}var k={bootstrap:function(l){l=l||h;if(this._bootstrapped){l();return;}if(this._bootstrapDeferred)return this._bootstrapDeferred.addCallback(l);this._bootstrapDeferred=new g();this._bootstrapDeferred.addCallback(l);this.bootstrapImpl(function(){this._bootstrapped=true;this._bootstrapDeferred.succeed();this._bootstrapDeferred=null;}.bind(this));return this._bootstrapDeferred;},search:function(l,m,n){this.searchImpl(l,m,n);},bootstrapImpl:function(l){l();},searchImpl:function(l,m,n){throw new Error('Abstract method #searchImpl is not implemented.');}};i(j,k);j.Mixin=k;e.exports=j;},null);
__d("SearchSourceCallbackManager",["createObjectFrom","invariant"],function(a,b,c,d,e,f,g,h){function i(k){"use strict";this.$SearchSourceCallbackManager0=k.parseFn;h(typeof this.$SearchSourceCallbackManager0==='function');this.$SearchSourceCallbackManager1=k.matchFn;h(typeof this.$SearchSourceCallbackManager1==='function');this.$SearchSourceCallbackManager2=k.alwaysPrefixMatch||false;this.$SearchSourceCallbackManager3=k.indexFn||j;this.reset();}i.prototype.search=function(k,l,m){"use strict";var n=this.$SearchSourceCallbackManager4(k,l,m);if(n)return 0;this.$SearchSourceCallbackManager5.push({queryString:k,callback:l,options:m});var o=this.$SearchSourceCallbackManager5.length-1;this.$SearchSourceCallbackManager6.push(o);return o;};i.prototype.$SearchSourceCallbackManager4=function(k,l,m){"use strict";var n=this.$SearchSourceCallbackManager7(k),o=!!this.$SearchSourceCallbackManager8[k];if(!n.length){l([],k);return o;}var p=n.map(function(q){return this.$SearchSourceCallbackManager9[q];},this);l(p,k);return o;};i.prototype.$SearchSourceCallbackManagera=function(){"use strict";var k=this.$SearchSourceCallbackManager6;this.$SearchSourceCallbackManager6=[];k.forEach(this.$SearchSourceCallbackManagerb,this);};i.prototype.$SearchSourceCallbackManagerb=function(k){"use strict";var l=this.$SearchSourceCallbackManager5[k];if(!l)return;var m=this.$SearchSourceCallbackManager4(l.queryString,l.callback,l.options);if(m){delete this.$SearchSourceCallbackManager5[k];return;}this.$SearchSourceCallbackManager6.push(k);};i.prototype.reset=function(){"use strict";this.$SearchSourceCallbackManager9={};this.$SearchSourceCallbackManagerc={};this.$SearchSourceCallbackManagerd={};this.$SearchSourceCallbackManagere={};this.$SearchSourceCallbackManager8={};this.$SearchSourceCallbackManager6=[];this.$SearchSourceCallbackManager5=[undefined];};i.prototype.addLocalEntries=function(k){"use strict";k.forEach(function(l){var m=l.getUniqueID(),n=this.$SearchSourceCallbackManager3(l);this.$SearchSourceCallbackManager9[m]=l;this.$SearchSourceCallbackManagerc[m]=n;var o=this.$SearchSourceCallbackManager0(n);o.tokens.forEach(function(p){if(!this.$SearchSourceCallbackManagerd.hasOwnProperty(p))this.$SearchSourceCallbackManagerd[p]={};this.$SearchSourceCallbackManagerd[p][m]=true;},this);},this);this.$SearchSourceCallbackManagera();};i.prototype.addQueryEntries=function(k,l){"use strict";var m=this.$SearchSourceCallbackManager7(l),n=this.$SearchSourceCallbackManager0(l).flatValue;this.$SearchSourceCallbackManagere[n]=g(m,true);k.forEach(function(o){var p=o.getUniqueID();this.$SearchSourceCallbackManager9[p]=o;this.$SearchSourceCallbackManagerc[p]=this.$SearchSourceCallbackManager3(o);this.$SearchSourceCallbackManagere[n][p]=true;},this);this.$SearchSourceCallbackManagera();};i.prototype.unsubscribe=function(k){"use strict";delete this.$SearchSourceCallbackManager5[k];};i.prototype.removeEntry=function(k){"use strict";delete this.$SearchSourceCallbackManager9[k];};i.prototype.getAllEntriesMap=function(){"use strict";return this.$SearchSourceCallbackManager9;};i.prototype.setQueryStringAsExhausted=function(k){"use strict";this.$SearchSourceCallbackManager8[k]=true;};i.prototype.unsetQueryStringAsExhausted=function(k){"use strict";delete this.$SearchSourceCallbackManager8[k];};i.prototype.$SearchSourceCallbackManager7=function(k){"use strict";var l=this.$SearchSourceCallbackManagerf(k,this.$SearchSourceCallbackManagerg(k)),m=this.$SearchSourceCallbackManagerf(k,this.$SearchSourceCallbackManagerh(k)),n=l.concat(m),o={},p=[];n.forEach(function(q){if(!o[q]&&this.$SearchSourceCallbackManager9[q]!==undefined){p.push(q);o[q]=true;}},this);return p;};i.prototype.$SearchSourceCallbackManagerf=function(k,l){"use strict";var m=this.$SearchSourceCallbackManageri(k,l),n=this.$SearchSourceCallbackManager9;function o(p,q){if(m[p]!==m[q])return m[p]?-1:1;var r=n[p],s=n[q];if(r.getOrder()!==s.getOrder())return r.getOrder()-s.getOrder();var t=r.getTitle().length,u=s.getTitle().length;if(t!==u)return t-u;return r.getUniqueID()-s.getUniqueID();}return l.sort(o).slice();};i.prototype.$SearchSourceCallbackManageri=function(k,l){"use strict";var m={};l.forEach(function(n){m[n]=this.$SearchSourceCallbackManager1(k,this.$SearchSourceCallbackManagerc[n]);},this);return m;};i.prototype.$SearchSourceCallbackManagerg=function(k){"use strict";var l=this.$SearchSourceCallbackManager0(k,this.$SearchSourceCallbackManager2),m=this.$SearchSourceCallbackManager2?l.sortedTokens:l.tokens,n=m.length,o=l.isPrefixQuery?n-1:null,p={},q={},r={},s=false,t={},u=0;m.forEach(function(w,x){if(t.hasOwnProperty(w))return;u++;t[w]=true;for(var y in this.$SearchSourceCallbackManagerd){var z=(y===w&&!p.hasOwnProperty(y)),aa=false;if(!z)aa=((this.$SearchSourceCallbackManager2||o===x)&&y.indexOf(w)===0);if(!z&&!aa)continue;if(y===w){if(q.hasOwnProperty(y))s=true;p[y]=true;}else{if(p.hasOwnProperty(y)||q.hasOwnProperty(y))s=true;q[y]=true;}for(var ba in this.$SearchSourceCallbackManagerd[y])if(x===0||(r.hasOwnProperty(ba)&&r[ba]==u-1))r[ba]=u;}},this);var v=Object.keys(r).filter(function(w){return r[w]==u;});if(s||u<n)v=this.$SearchSourceCallbackManagerj(k,v);return v;};i.prototype.$SearchSourceCallbackManagerh=function(k){"use strict";var l=this.$SearchSourceCallbackManager0(k).flatValue,m=this.$SearchSourceCallbackManagerk(l);if(this.$SearchSourceCallbackManagere.hasOwnProperty(l))return m;return this.$SearchSourceCallbackManagerj(k,m);};i.prototype.$SearchSourceCallbackManagerk=function(k){"use strict";var l=0,m=null,n=this.$SearchSourceCallbackManagere;Object.keys(n).forEach(function(o){if(k.indexOf(o)===0&&o.length>l){l=o.length;m=o;}});return (n.hasOwnProperty(m)?Object.keys(n[m]):[]);};i.prototype.$SearchSourceCallbackManagerj=function(k,l){"use strict";return l.filter(function(m){return this.$SearchSourceCallbackManager1(k,this.$SearchSourceCallbackManagerc[m]);},this);};function j(k){return [k.getTitle(),k.getKeywordString()].join(' ');}e.exports=i;},null);
__d("SearchableEntry",["HTML","isValidUniqueID","invariant"],function(a,b,c,d,e,f,g,h,i){function j(l){switch(typeof l){case 'string':return l;case 'object':var m=g.replaceJSONWrapper(l);if(g.isHTML(m)){var n=m.getRootNode();return n.textContent||n.innerText||'';}else return '';default:return '';}}function k(l){"use strict";i(h(l.uniqueID));i(!!l.title&&typeof l.title==='string');this.$SearchableEntry0=l.uniqueID+'';this.$SearchableEntry1=l.title;this.$SearchableEntry2=l.order||0;this.$SearchableEntry3=j(l.subtitle);this.$SearchableEntry4=l.keywordString||'';this.$SearchableEntry5=l.photo||'';this.$SearchableEntry6=l.uri||'';this.$SearchableEntry7=l.type||'';this.$SearchableEntry8=l.auxiliaryData||null;}k.prototype.getUniqueID=function(){"use strict";return this.$SearchableEntry0;};k.prototype.getOrder=function(){"use strict";return this.$SearchableEntry2;};k.prototype.getTitle=function(){"use strict";return this.$SearchableEntry1;};k.prototype.getSubtitle=function(){"use strict";return this.$SearchableEntry3;};k.prototype.getKeywordString=function(){"use strict";return this.$SearchableEntry4;};k.prototype.getPhoto=function(){"use strict";return this.$SearchableEntry5;};k.prototype.getURI=function(){"use strict";return this.$SearchableEntry6;};k.prototype.getType=function(){"use strict";return this.$SearchableEntry7;};k.prototype.getAuxiliaryData=function(){"use strict";return this.$SearchableEntry8;};e.exports=k;},null);
__d("AbstractAsyncSearchSource",["AbstractSearchSource","SearchSourceCallbackManager","SearchableEntry","TokenizeUtil","copyProperties","emptyFunction","isValidUniqueID"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){for(var n in g)if(g.hasOwnProperty(n))p[n]=g[n];var o=g===null?null:g.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=g;function p(q,r,s){"use strict";this.$AbstractAsyncSearchSource0=q.bootstrapRequests;this.$AbstractAsyncSearchSource1=q.queryRequests;this.$AbstractAsyncSearchSource2=q.auxiliaryFields;this.$AbstractAsyncSearchSource3=q.asyncErrorHandler||l;this.$AbstractAsyncSearchSource4=q.packageFn||this.$AbstractAsyncSearchSource5;this.$AbstractAsyncSearchSource6=q.getAllForEmptyQuery;this.$AbstractAsyncSearchSource7=[];this.$AbstractAsyncSearchSource8=new h({parseFn:j.parse,matchFn:j.isQueryMatch,indexFn:q.indexFn});this.$AbstractAsyncSearchSource9=r;this.$AbstractAsyncSearchSourcea=s;}p.prototype.bootstrapImpl=function(q){"use strict";if(!this.$AbstractAsyncSearchSource0||!this.$AbstractAsyncSearchSource0.length){q();return;}var r=this.$AbstractAsyncSearchSource0.length,s=0;this.$AbstractAsyncSearchSource0.forEach(function(t){this.$AbstractAsyncSearchSourceb({},t,function(u){this.$AbstractAsyncSearchSource8.addLocalEntries(u);this.$AbstractAsyncSearchSource7=this.$AbstractAsyncSearchSource7.concat(u);s++;if(s===r){q();q=null;}}.bind(this));}.bind(this));};p.prototype.searchImpl=function(q,r,s){"use strict";if(this.$AbstractAsyncSearchSource6&&q===''){this.getBootstrappedEntries(function(y){r(y,q);});return;}var t=null,u={},v=this.$AbstractAsyncSearchSource8.search(q,function(y){if(!t){t=y;t.forEach(function(z){u[z.getUniqueID()]=true;});}else y.forEach(function(z){var aa=z.getUniqueID();if(!u[aa]){t.push(z);u[aa]=true;}});r(t,q);},s);if(!v||!this.$AbstractAsyncSearchSource1||!this.$AbstractAsyncSearchSource1.length)return;var w={value:q,existing_ids:t&&t.map(function(y){return y.getUniqueID();}).join(',')},x=this.$AbstractAsyncSearchSource1.length;this.$AbstractAsyncSearchSource1.forEach(function(y){this.$AbstractAsyncSearchSourceb(w,y,function(z){this.$AbstractAsyncSearchSourcec(z,q);x--;if(!x)this.$AbstractAsyncSearchSource8.setQueryStringAsExhausted(q);}.bind(this));},this);};p.prototype.getBootstrappedEntries=function(q){"use strict";return this.bootstrap(function(){return q(this.$AbstractAsyncSearchSource7||[]);}.bind(this));};p.prototype.getAllEntriesMap=function(){"use strict";return this.$AbstractAsyncSearchSource8.getAllEntriesMap();};p.prototype.$AbstractAsyncSearchSourceb=function(q,r,s){"use strict";this.$AbstractAsyncSearchSource9(q,r,function(t){return s(this.$AbstractAsyncSearchSourcea(t,this.$AbstractAsyncSearchSource4).filter(function(u){return !!u;}));}.bind(this),this.$AbstractAsyncSearchSource3);};p.prototype.$AbstractAsyncSearchSourced=function(q){"use strict";this.$AbstractAsyncSearchSource8.addLocalEntries(q);};p.prototype.$AbstractAsyncSearchSourcec=function(q,r){"use strict";if(q.length)this.$AbstractAsyncSearchSource8.addQueryEntries(q,r);};p.prototype.$AbstractAsyncSearchSource5=function(q,r){"use strict";var s=q.title||q.text,t=q.uniqueID||q.uid;if(!s||!m(t))return null;return new i({uniqueID:t,order:q.order||q.index||r,title:s,subtitle:q.subtitle||q.category||q.subtext,keywordString:q.keywordString||q.tokens,type:q.type,photo:q.photo,uri:q.uri||q.path,auxiliaryData:this.$AbstractAsyncSearchSourcee(q)});};p.prototype.$AbstractAsyncSearchSourcee=function(q){"use strict";var r;if(this.$AbstractAsyncSearchSource2){r={};for(var s in this.$AbstractAsyncSearchSource2){var t=this.$AbstractAsyncSearchSource2[s];r[s]=q[t];}}if(q.aux_data){r=r||{};k(r,q.aux_data);}return r;};e.exports=p;},null);
__d("WebAsyncSearchSource",["AbstractAsyncSearchSource","AbstractSearchSource","AsyncRequest","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){for(var k in h)if(h.hasOwnProperty(k))m[k]=h[k];var l=h===null?null:h.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=h;function m(n){"use strict";this.$WebAsyncSearchSource0=new g(n,this.$WebAsyncSearchSource1,this.$WebAsyncSearchSource2);}m.prototype.bootstrapImpl=function(n){"use strict";this.$WebAsyncSearchSource0.bootstrap(n);};m.prototype.searchImpl=function(n,o,p){"use strict";this.$WebAsyncSearchSource0.search(n,o,p);};m.prototype.getBootstrappedEntries=function(n){"use strict";return this.$WebAsyncSearchSource0.getBootstrappedEntries(n);};m.prototype.getAllEntriesMap=function(){"use strict";return this.$WebAsyncSearchSource0.getAllEntriesMap();};m.prototype.$WebAsyncSearchSource1=function(n,o,p,q){"use strict";new i(o.uri).setData(j({},n,o.data)).setMethod('GET').setReadOnly(true).setHandler(p).setErrorHandler(q).send();};m.prototype.$WebAsyncSearchSource2=function(n,o){"use strict";var p=n.getPayload().entries||n.getPayload()||[];return p.map(o,this);};e.exports=m;},null);
__d("getDOMImageSize",["URI"],function(a,b,c,d,e,f,g){function h(m){m.onload=null;m.onerror=null;m.onreadystatechange=null;m._callback=null;m._thisObj=null;m._srcStr=null;m.parentNode&&m.parentNode.removeChild(m);}function i(){var m=this;if(m._callback)m._callback.call(m._thisObj,m.naturalWidth||m.width,m.naturalHeight||m.height,m._srcStr);h(m);}function j(){var m=this;if(m.readyState==='complete')i.call(m);}function k(){var m=this;if(m._callback)m._callback.call(m._thisObj,0,0,m._srcStr);h(m);}function l(m,n,o){o=o||null;if(!m){n.call(o,0,0,'');return;}var p=document.body;if(!p){setTimeout(l.bind(this,m,n,o),500);return;}var q;if(typeof m==='string'){q=m;}else if(typeof m==='object')if(typeof m.width==='number'&&typeof m.height==='number'){if(typeof m.src==='string'){q=m.src;if(m.naturalWidth&&m.naturalHeight){n.call(o,m.naturalWidth,m.naturalHeight,q);return;}}if(typeof m.uri==='string'){q=m.uri;if(m.width&&m.height){n.call(o,m.width,m.height,q);return;}}}else if(m instanceof g)q=m.toString();if(!q){n(0,0,m);return;}var r=document.createElement('img');r.onreadystatechange=j;r.onload=i;r.onerror=k;r._callback=n;r._thisObj=o;r._srcStr=q;r.src=q;r.style.cssText='position:absolute;left:0;top:0;width:auto;height:auto;clip:rect(0 0 0 0);';p.insertBefore(r,p.firstChild);}e.exports=l;},null);
__d("CachedDOMImageSizePool",["debounce","getDOMImageSize"],function(a,b,c,d,e,f,g,h){function i(j,k){"use strict";this.$CachedDOMImageSizePool0={};this.$CachedDOMImageSizePool1=k;this.$CachedDOMImageSizePool2=0;this.$CachedDOMImageSizePool3=j;this.$CachedDOMImageSizePool4=g(this.$CachedDOMImageSizePool5,5000,this);this.$CachedDOMImageSizePool6={};this.$CachedDOMImageSizePool7={};}i.prototype.get=function(j,k,l){"use strict";if(!j){k.call(l,0,0,j);return;}var m=this.$CachedDOMImageSizePool0[j];if(m){m.lastAccessTime=Date.now();k.call(l,m.width,m.height,m.src);}else if(this.$CachedDOMImageSizePool6[j]){this.$CachedDOMImageSizePool6[j].push(k);this.$CachedDOMImageSizePool7[j].push(l);}else{this.$CachedDOMImageSizePool6[j]=[k];this.$CachedDOMImageSizePool7[j]=[l];h(j,this.$CachedDOMImageSizePool8,this);}};i.prototype.set=function(j,k,l){"use strict";if(this.$CachedDOMImageSizePool2>this.$CachedDOMImageSizePool3)this.$CachedDOMImageSizePool4();var m=this.$CachedDOMImageSizePool0;if(j&&!m[j]){var n={width:k,height:l,src:j,lastAccessTime:Date.now()};m[j]=n;this.$CachedDOMImageSizePool2++;}};i.prototype.$CachedDOMImageSizePool8=function(j,k,l){"use strict";this.set(l,j,k);var m=this.$CachedDOMImageSizePool6[l],n=this.$CachedDOMImageSizePool7[l];for(var o=0,p=m.length;o<p;o++)m[o].call(n[o],j,k,l);delete this.$CachedDOMImageSizePool6[l];delete this.$CachedDOMImageSizePool7[l];};i.prototype.$CachedDOMImageSizePool5=function(){"use strict";var j=Date.now(),k=this.$CachedDOMImageSizePool0,l=this.$CachedDOMImageSizePool2,m=this.$CachedDOMImageSizePool1;for(var n in k){var o=k[n];if((j-o.lastAccessTime)>m){delete k[n];l--;}}this.$CachedDOMImageSizePool2=l;};e.exports=i;},null);
__d("BackgroundImage.react",["CachedDOMImageSizePool","React","ReactPropTypes","XUISpinner.react","cx","invariant","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n='(-?(\\d+\\.)?\\d+(px|\\%))',o=new RegExp('^'+n+'?(\\s'+n+')?$','g'),p=new g(50,10*60*1000),q=h.createClass({displayName:'BackgroundImage',propTypes:{src:i.string,width:i.number.isRequired,height:i.number.isRequired,backgroundSize:i.oneOf(['contain','cover','containinside','coverinside']),loadingIndicatorStyle:i.oneOf(['none','large','small']),backgroundPosition:function(r,s,t){var u=r[s];if(u){l(typeof u==='string');l(u.match(o));}},onImageLoad:i.func,optimizeResizeSpeed:i.bool,onContextMenu:i.func},getInitialState:function(){return {imageWidth:null,imageHeight:null,imageSrc:this.props.src,loading:true};},getDefaultProps:function(){return {optimizeResizeSpeed:false,loadingIndicatorStyle:'none'};},componentDidMount:function(){this._resolveImageSize();},componentDidUpdate:function(r){if(this.props.src!==this.state.imageSrc)this.setState({imageWidth:0,imageHeight:0,imageSrc:this.props.src,loading:true},this._resolveImageSize);},_resolveImageSize:function(){var r=this.state.imageSrc;if(r)p.get(r,this._onImageSizeResolved,this);},render:function(){var r={width:this.props.width+'px',height:this.props.height+'px'},s=m(this.props.className,"_5f0d");return (h.createElement(h.DOM.div,Object.assign({},this.props,{className:m(this.props.className,s),style:Object.assign({},(this.props.style||{}),r),onContextMenu:this.props.onContextMenu}),this._renderImage(),this._renderContent(),this._renderLoadingIndicator()));},_renderLoadingIndicator:function(){if(!this.state.loading||this.props.loadingIndicatorStyle==='none')return null;return (h.createElement(h.DOM.div,{className:"_5laq _5lar"},h.createElement(h.DOM.div,{className:"_5las"},h.createElement(h.DOM.div,{className:"_5lat"},h.createElement(j,{size:this.props.loadingIndicatorStyle})))));},_renderContent:function(){if(this.props.children)return (h.createElement(h.DOM.div,{className:"_5laq"},h.createElement(h.DOM.div,{className:"_5las"},h.createElement(h.DOM.div,{className:"_5lat"},this.props.children))));},_renderImage:function(){if(!this.state.imageWidth||!this.state.imageHeight)return;var r=this.props.width,s=this.props.height,t,u;switch(this.props.backgroundSize){case 'cover':t='cover';u=false;break;case 'coverinside':t='cover';u=true;break;case 'contain':t='contain';u=false;break;case 'containinside':t='contain';u=true;}var v=this.state.imageWidth,w=this.state.imageHeight,x=r/s,y=v/w;if(t==='contain')if((v>r||!u)&&y>=x){v=r;w=v/y;}else if(w>s||!u){w=s;v=w*y;}if(t==='cover')if((v>r||!u)&&y>=x){w=s;v=w*y;}else if(w>s||!u){v=r;w=v/y;}var z=this._getImageStyle(v,w);return (h.createElement(h.DOM.img,{alt:"",className:(("_5i4g")+(this.props.optimizeResizeSpeed?' '+"_5sjv":'')),style:z,src:this.state.imageSrc}));},_getImageStyle:function(r,s){var t;if(this.props.backgroundPosition){t=this.props.backgroundPosition.split(' ');}else t=['50%','50%'];return {width:Math.round(r)+'px',height:Math.round(s)+'px',left:this._getBackgroundPositionPxValue('left',t[0],r,s),top:this._getBackgroundPositionPxValue('top',t[1]||t[0],r,s)};},_getBackgroundPositionPxValue:function(r,s,t,u){var v=parseFloat(s),w=s.substr(v.toString().length);if(w==='px')return s;if(r==='left'){return Math.round((this.props.width-t)*(v/100))+'px';}else return Math.round((this.props.height-u)*(v/100))+'px';},_onImageSizeResolved:function(r,s,t){if(!this.isMounted()||this.state.imageSrc!==t)return;var u=this.props.onImageLoad?this.props.onImageLoad.bind(null,r,s):null;this.setState({imageWidth:r,imageHeight:s,loading:false},u);}});e.exports=q;},null);
__d("TypeaheadViewItem",["React","SearchableEntry"],function(a,b,c,d,e,f,g,h){var i={entry:g.PropTypes.instanceOf(h).isRequired,highlighted:g.PropTypes.bool,selected:g.PropTypes.bool,onSelect:g.PropTypes.func.isRequired,onHighlight:g.PropTypes.func,onRenderHighlight:g.PropTypes.func},j={_onSelect:function(k){this.props.onSelect(this.props.entry,k);},_onHighlight:function(k){if(this.props.onHighlight)this.props.onHighlight(this.props.entry,k);},shouldComponentUpdate:function(k){return (this.props.entry.getUniqueID()!==k.entry.getUniqueID()||this.props.highlighted!==k.highlighted||this.props.selected!==k.selected);},componentDidMount:function(){if(this.props.highlighted&&this.props.onRenderHighlight)this.props.onRenderHighlight(this.getDOMNode());},componentDidUpdate:function(){if(this.props.highlighted&&this.props.onRenderHighlight)this.props.onRenderHighlight(this.getDOMNode());}};e.exports={propTypes:i,Mixin:j};},null);
__d("ContentRollTypeaheadView.react",["BackgroundImage.react","ImageBlock.react","LegacyScrollableArea.react","React","TypeaheadViewItem","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=j.createClass({displayName:'ContentRollTypeaheadViewItem',mixins:[k.Mixin],propTypes:k.propTypes,render:function(){var p=this.props.entry,q=p.getSubtitle()?j.createElement(j.DOM.div,{className:"_599q"},p.getSubtitle()):null;if(q&&p.getAuxiliaryData()&&p.getAuxiliaryData().icon)q=j.createElement(h,{spacing:"small"},j.createElement(g,{width:16,height:16,src:p.getAuxiliaryData().icon}),q);var r=p.getPhoto()?j.createElement(g,{width:32,height:32,backgroundSize:"cover",src:p.getPhoto()}):j.createElement(j.DOM.span,null),s=(("_5yww")+(!q?' '+"_5mne":'')+(this.props.highlighted?' '+"_599n":''));return (j.createElement(j.DOM.li,{className:s,onMouseDown:this._onSelect,onMouseEnter:this._onHighlight},j.createElement(h,{spacing:"medium"},r,j.createElement(j.DOM.div,null,j.createElement(j.DOM.div,{className:"_599p"},p.getTitle()),q))));}}),o=j.createClass({displayName:'ContentRollTypeaheadView',propTypes:{highlightedEntry:j.PropTypes.object,entries:j.PropTypes.array.isRequired,onSelect:j.PropTypes.func.isRequired,onHighlight:j.PropTypes.func,onRenderHighlight:j.PropTypes.func,scrollableAreaHeight:j.PropTypes.number.isRequired,scrollableAreaWidth:j.PropTypes.number.isRequired},_renderItem:function(p){var q=p===this.props.highlightedEntry;return (j.createElement(n,{key:p.getUniqueID(),entry:p,highlighted:q,onSelect:this.props.onSelect,onHighlight:this.props.onHighlight,onRenderHighlight:this.props.onRenderHighlight}));},render:function(){var p=(("_2072")+(!this.props.entries.length?' '+"_599s":'')),q=this.props.entries,r={};q.forEach(function(v){r[v.getType()]=r[v.getType()]||[];r[v.getType()].push(v);});var s=[];for(var t in r){var u=null;switch(t){case 'recent':u="Recently Viewed Links";break;case 'saved':u="Saved Links";break;case 'bing':u="Bing Results";break;}if(u)s.push(j.createElement(j.DOM.div,{className:"_1opo"},u));r[t].forEach(function(v){s.push(this._renderItem(v));},this);}return (j.createElement(j.DOM.div,{className:p},j.createElement(i,{height:this.props.scrollableAreaHeight,width:this.props.scrollableAreaWidth},j.createElement(j.DOM.ul,null,s))));}});e.exports=o;},null);
__d("ContentRollTypeahead.react",["AbstractTypeahead.react","React","ReactPropTypes","WebAsyncSearchSource","ContentRollTypeaheadView.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=20,o='/ajax/metacomposer/attachment/og/typeahead/content_roll',p=h.createClass({displayName:'ContentRollTypeahead',propTypes:{className:i.string,onSelection:i.func.isRequired,scrollableAreaHeight:h.PropTypes.number.isRequired,scrollableAreaWidth:h.PropTypes.number.isRequired,userID:i.string.isRequired,useLayer:i.bool},getInitialState:function(){return {query:''};},_handleChange:function(event){this.setState({query:event.target.value});},_handleSelectAttempt:function(q){this.setState({query:''});var r={object_id:q.getUniqueID(),url:q.getURI(),source:q.getType(),query:q.getAuxiliaryData().query,subindex:q.getAuxiliaryData().subindex,subtotal:q.getAuxiliaryData().subtotal,index:q.getAuxiliaryData().index,total:q.getAuxiliaryData().total};this.props.onSelection(r);},_getSearchSource:function(){if(!this._searchSource)this._searchSource=new j({bootstrapRequests:[{uri:o,data:{viewer:this.props.userID}}],queryRequests:[{uri:o,data:{viewer:this.props.userID}}],getAllForEmptyQuery:true});return this._searchSource;},_getPlaceholder:function(){if(!this._placeholder)this._placeholder="Search for articles, videos, music, and more";return this._placeholder;},focusInput:function(){this.refs.typeahead.focusInput();},render:function(){var q={ViewRenderer:k,maxEntries:n,useLayer:this.props.useLayer,extraRendererProps:{scrollableAreaHeight:this.props.scrollableAreaHeight,scrollableAreaWidth:this.props.scrollableAreaWidth}};return (h.createElement(g,{autoHighlight:true,className:this.props.className,focusedOnInit:true,inputClassName:"_55r1",onChange:this._handleChange,onSelectAttempt:this._handleSelectAttempt,placeholder:this._getPlaceholder(),presenter:q,queryString:this.state.query,ref:"typeahead",searchSource:this._getSearchSource(),showEntriesOnFocus:true}));}});e.exports=p;},null);
__d("ContentRollFlyout.react",["ContentRollTypeahead.react","Parent","React","ReactPropTypes","Toggler","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=i.createClass({displayName:'ContentRollFlyout',propTypes:{onSelection:j.func.isRequired,userID:j.string.isRequired},getInitialState:function(){return {showFlyout:false};},componentDidMount:function(){var n=this._getParentToggler();if(n)k.listen('show',n,function(){this.setState({showFlyout:true});}.bind(this));},_getParentToggler:function(){return h.byClass(this.getDOMNode(),'uiToggle');},_hideParentToggler:function(){var n=this._getParentToggler();if(n)k.hide(n);},_handleSelection:function(n){this._hideParentToggler();this.props.onSelection(n);},render:function(){if(!this.state.showFlyout)return i.createElement(i.DOM.div,null);return (i.createElement(g,{className:"_5j11",onSelection:this._handleSelection,scrollableAreaHeight:288,scrollableAreaWidth:256,userID:this.props.userID,useLayer:false}));}});e.exports=m;},null);
__d("MenuSeparator.react",["MenuSeparator","ReactMenu","mergeInto"],function(a,b,c,d,e,f,g,h,i){var j=function(k){var l={ctor:g};h.putOnReactComponentCostume(l);i(l,k);return l;};e.exports=j;},null);
__d("NubController",["ArbiterMixin","Dock","copyProperties"],function(a,b,c,d,e,f,g,h,i){function j(){}i(j.prototype,g,{init:function(k){this.el=k;h.registerNubController(k,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){h.hide(this.el);},show:function(){h.show(this.el);}});e.exports=j;},null);
__d("arraySort",["invariant"],function(a,b,c,d,e,f,g){function h(i,j){g(Array.isArray(i));var k=i.slice();if(j)return k.sort(j);return k.sort();}e.exports=h;},null);
__d("DataViewPolyfill",["copyProperties"],function(a,b,c,d,e,f,g){"use strict";function h(i,j,k){if(j===undefined){this._ba=new Uint8Array(i);}else if(k===undefined){this._ba=new Uint8Array(i,j);}else this._ba=new Uint8Array(i,j,k);this.byteLength=this._ba.byteLength;}g(h,{isSupported:function(){return !!a.Uint8Array;}});g(h.prototype,{getUint8:function(i){if(i>=this._ba.length)throw new Error('Trying to read beyond bounds of DataViewPolyfill');return this._ba[i];},getUint16:function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1);return j?(l*256)+k:(k*256)+l;},getUint32:function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1),m=this.getUint8(i+2),n=this.getUint8(i+3);return j?(((n*256+m)*256+l)*256)+k:(((k*256+l)*256+m)*256)+n;}});e.exports=h;},null);
__d("OrderedMap",["invariant","mixInto"],function(a,b,c,d,e,f,g,h){"use strict";var i='key:';function j(q,r){var s={};for(var t=0;t<q.length;t++){var u=q[t],v=r(u);l(v);var w=i+v;g(!(w in s));s[w]=u;}return s;}function k(q,r){this._normalizedObj=q;this._computedPositions=null;this.length=r;}function l(q){g(q!==''&&(typeof q==='string'||typeof q==='number'));}function m(q,r,s){g(typeof q==='number'&&typeof r==='number'&&r>=0&&q>=0&&q+r<=s);}function n(q,r){g(q&&q.constructor===Object&&(!r||r.constructor===Object));var s={},t=0,u;for(u in q)if(q.hasOwnProperty(u)){s[u]=q[u];t++;}for(u in r)if(r.hasOwnProperty(u)){if(!(u in s))t++;s[u]=r[u];}return new k(s,t);}var o={has:function(q){l(q);var r=i+q;return r in this._normalizedObj;},get:function(q){l(q);var r=i+q;return this.has(q)?this._normalizedObj[r]:undefined;},merge:function(q){g(q instanceof k);return n(this._normalizedObj,q._normalizedObj);},map:function(q,r){return this.mapRange(q,0,this.length,r);},mapRange:function(q,r,s,t){var u=this._normalizedObj,v={},w=0;m(r,s,this.length);var x=r+s-1;for(var y in u)if(u.hasOwnProperty(y)){if(w>=r){if(w>x)break;var z=u[y];v[y]=q.call(t,z,y.substr(i.length),w);}w++;}return new k(v,s);},filter:function(q,r){return this.filterRange(q,0,this.length,r);},filterRange:function(q,r,s,t){var u={},v=0;this.forEachRange(function(w,x,y){if(q.call(t,w,x,y)){var z=i+x;u[z]=w;v++;}},r,s);return new k(u,v);},forEach:function(q,r){this.forEachRange(q,0,this.length,r);},forEachRange:function(q,r,s,t){m(r,s,this.length);var u=this._normalizedObj,v=0,w=r+s-1;for(var x in u)if(u.hasOwnProperty(x)){if(v>=r){if(v>w)break;var y=u[x];q.call(t,y,x.substr(i.length),v);}v++;}},mapKeyRange:function(q,r,s,t){var u=this.indexOfKey(r),v=this.indexOfKey(s);g(u!==undefined&&v!==undefined);g(v>=u);return this.mapRange(q,u,(v-u)+1,t);},forEachKeyRange:function(q,r,s,t){var u=this.indexOfKey(r),v=this.indexOfKey(s);g(u!==undefined&&v!==undefined);g(v>=u);this.forEachRange(q,u,(v-u)+1,t);},keyAtIndex:function(q){var r=this._getOrComputePositions(),s=r.keyByIndex[q];return s?s.substr(i.length):undefined;},keyAfter:function(q){return this.nthKeyAfter(q,1);},keyBefore:function(q){return this.nthKeyBefore(q,1);},nthKeyAfter:function(q,r){var s=this.indexOfKey(q);g(s!==undefined);return this.keyAtIndex(s+r);},nthKeyBefore:function(q,r){return this.nthKeyAfter(q,-r);},indexOfKey:function(q){l(q);var r=i+q,s=this._getOrComputePositions(),t=s.indexByKey[r];return t===undefined?undefined:t;},toArray:function(){var q=[],r=this._normalizedObj;for(var s in r)if(r.hasOwnProperty(s))q.push(r[s]);return q;},_getOrComputePositions:function(){var q=this._computedPositions;if(!q)this._computePositions();return this._computedPositions;},_computePositions:function(){this._computedPositions={keyByIndex:{},indexByKey:{}};var q=this._computedPositions.keyByIndex,r=this._computedPositions.indexByKey,s=0,t=this._normalizedObj;for(var u in t)if(t.hasOwnProperty(u)){q[s]=u;r[u]=s;s++;}}};h(k,o);var p={from:function(q){g(q instanceof k);return n(q._normalizedObj,null);},fromArray:function(q,r){g(Array.isArray(q));g(typeof r==='function');return new k(j(q,r),q.length);}};e.exports=p;},null);
__d("TabsViewport",["Arbiter","ArbiterMixin","ChatTabModel","Dock","DOM","DOMDimensions","Event","Parent","Vector","ViewportBounds","areJSONRepresentationsEqual","copyProperties","csx","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=175,v=269,w=0;function x(){return u;}function y(){return v;}function z(aa){this._root=aa;var ba=this._recalculateWidth.bind(this);m.listen(window,'resize',ba);j.subscribe('resize',ba);g.subscribeOnce('sidebar/initialized',ba,g.SUBSCRIBE_NEW);i.subscribe('chat/tabs-changed',t(this._recalculateTabs,this,true));this._recalculateWidth();this._initialized=true;}r(z.prototype,h,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var aa=z._getAvailableDockWidth(this._root),ba=Math.max(1,Math.floor(aa/y())),ca=ba!=this._maxShown;if(!this._viewState||ca||aa<=this._viewState.usedWidth||aa>this._viewState.widthToShowNext){this._availableWidth=aa;this._maxShown=ba;this._viewState=null;this._recalculateTabs(ca);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(aa){var ba=z._getTabsToShow(i.get(),this._availableWidth);if(aa||!q(this._viewState,ba)){this._viewState=ba;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},hasRoomForRaisedTab:function(){return this._availableWidth-this._viewState.usedWidth>y();},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},getShowingTabsOrder:function(){var aa=i.get(),ba=this._viewState.tabsToShow;return aa.tabs.filter(function(ca){return ba[ca.id];});},getRightmostHiddenTab:function(){var aa=i.get(),ba=this._viewState.tabsToShow,ca=aa.tabs.filter(function(ea){return !ba[ea.id];}),da=ca.shift();return da?da.id:null;},getLeftmostVisibleTab:function(){var aa=this.getShowingTabsOrder(),ba=aa.pop();return ba?ba.id:null;},getRightmostRaisedTab:function(){var aa=this.getShowingTabsOrder(),ba=aa.length;for(var ca=0;ca<ba;ca++)if(i.getTab(aa[ca].id).raised)return aa[ca].id;return null;},getRaisedVisibleTabs:function(){var aa=[],ba=this.getShowingTabsOrder(),ca=ba.length;for(var da=0;da<ca;da++)if(i.getTab(ba[da].id).raised)aa.push(ba[da].id);return aa;},shouldPromoteOnRaise:function(aa){if(!this._viewState.tabsToShow[aa])return true;if(this._viewState.nextToHide!=aa)return false;var ba=i.getTab(aa),ca=ba&&ba.raised;return !ca&&(this._availableWidth-this._viewState.usedWidth<y()-x());}});r(z,{_getAvailableDockWidth:function(aa){var ba=l.getViewportWithoutScrollbarDimensions().width;ba-=p.getLeft()+p.getRight();ba-=50;var ca=n.byClass(aa,'fbDock'),da=k.find(ca,"._56ox"),ea=o.getElementDimensions(da).x;ba-=ea;var fa=k.scry(ca,"._56oy");ea+=o.getElementDimensions(fa.pop()).x;var ga=o.getElementDimensions(ca),ha=ga.x-ea;if(ha>w)w=ha;ba-=w;ba-=15;return Math.max(ba,0);},_getTabsToShow:function(aa,ba){ba=Math.max(ba,y()+1);function ca(sa,ta){return (sa.raised||!ta)?y():x();}var da=JSON.parse(JSON.stringify(aa.tabs)),ea=-1,fa=null;if(aa.promoted)da.forEach(function(sa,ta){if(sa.id===aa.promoted){ea=ta;fa=sa;}});var ga=0,ha=false,ia=0,ja=!fa;da.forEach(function(sa,ta){var ua=ca(sa,ha);ha=ha||!sa.raised;sa.leftmostOffset=ga+ua;ga+=ua;if(sa.leftmostOffset<ba)ia++;ja|=ta==ea;sa.alreadyPlacedPromoted=ja;});function ka(sa,ta,ua){var va={};for(var wa=0;wa<ta;wa++){var xa=sa[wa];if(!xa.alreadyPlacedPromoted&&wa==ta-1){va[ua]=true;}else va[xa.id]=true;}return va;}var la=ka(da,ia,aa.promoted),ma=ka(da,ia-1,aa.promoted),na=null;for(var oa in la)if(!ma[oa])na=oa;var pa=da[ia-1],qa=pa?pa.leftmostOffset:0,ra=Infinity;if(ia<da.length)ra=da[ia].leftmostOffset;return {nextToHide:na,tabsToShow:la,usedWidth:qa,widthToShowNext:ra};}});e.exports=z;},null);
__d("ChatTabPresence",["AvailableList","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f,g,h){var i=b('MercuryThreads').get(),j={};function k(l){var m=i.getCanonicalUserInThread(l);if(m)g.updateForID(m);}h.subscribe('chat/tabs-changed',function(event,l){l.tabs.forEach(function(m){if(m.raised&&!j[m.id])k(m.id);});j={};l.tabs.forEach(function(m){if(m.raised)j[m.id]=true;});});e.exports={};},null);
__d("ChatMentionsNotifications",["fbt","CurrentUser","MercuryParticipants"],function(a,b,c,d,e,f,g,h,i){var j={notifyIfMessageToMe:function(k){var l='fbid:'+h.getID(),m=k.body;i.get(l,function(n){var o=new RegExp(n.short_name,"i");if(o.test(m))j._notify(k);});},_notify:function(k){var l=48,m=k.body;if(m.length>l)m=m.substr(0,l-3)+"...";new Notification("\"You were tagged in a message!\"",{body:m,icon:"http://facebook.com//images/icons-large/fb-xl.png"});}};e.exports=j;},null);
__d("VideoCallPromo",["ArbiterMixin","AsyncRequest","ChatConfig","ChatVisibility","LegacyContextualDialog","CSS","MercuryParticipants","ChatTabTemplates","VideoCallCore","VideoCallSupport","copyProperties","emptyFunction","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=b('MercuryThreads').get();function t(){this._dialog=null;}function u(w){if(!(p.isVideoCallSupported()&&i.get('video.show_promo')))return false;var x=s.getCanonicalUserInThread(w);if(!x)return false;return j.isOnline()&&o.availableForCall(x);}function v(w){new h().setURI('/ajax/chat/video/log_promo.php').setData({viewedUserID:w}).setAllowCrossPageTransition(true).setErrorHandler(r).send();}q(t.prototype,g);q(t.prototype,{render:function(w,x){var y=u(x);if(!y)return;var z=s.getCanonicalUserInThread(x);m.get('fbid:'+z,function(aa){if(!aa.call_promo)return;var ba=n[':fb:mercury:call:promo'].build();this._dialog=new k();this._dialog.init(ba.getRoot()).setWidth(250).setAlignH('center').setContext(w).show();l.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');l.addClass(w,'video_call_promo');v(s.getCanonicalUserInThread(x));this.inform('chat/dialog-rendered',{dialog:this,thread_id:x});}.bind(this));},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=t;},null);
__d("VideoCallTourDialog",["ArbiterMixin","LegacyContextualDialog","CSS","ChatTabTemplates","VideoCallCore","VideoCallingTour","copyProperties","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=b('MercuryThreads').get();function o(){this._dialog=null;}m(o.prototype,g);m(o.prototype,{render:function(p,q){var r=n.getCanonicalUserInThread(q);if(!r||!k.availableForCall(r))return;var s=j[':fb:mercury:call:tour'].build();this._dialog=new h();this._dialog.init(s.getRoot()).setWidth(250).setAlignH('center').setContext(p).show();i.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');i.addClass(p,'video_call_tour');this.inform('chat/dialog-rendered',{dialog:this,thread_id:q});l.inform('videocallingtour/end');},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=o;},null);
__d("ChatContextualDialogController",["Event","ArbiterMixin","ChatTabModel","VideoCallingTour","VideoCallPromo","VideoCallTourDialog","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=60000,p=false,q=false,r=function(y,z){this._videoCallPromo=new k();this._videoCallTour=new l();this._threadID=y;this._tabMainElement=z;this._openDialog=null;this._subscriptionTokens=[];this._scrollListener=null;this._timeout=null;};function s(y,event,z){if(y._openDialog)y._openDialog.updatePosition();}function t(y){if(y._openDialog)y._openDialog.updatePosition();}function u(y){if(y._openDialog){y._openDialog.hide();y._openDialog=null;}if(y._timeout){clearTimeout(y._timeout);y._timeout=null;}while(y._subscriptionTokens.length)y._subscriptionTokens.pop().unsubscribe();if(y._scrollListener){y._scrollListener.remove();y._scrollListener=null;}}function v(y,event,z){if(z.thread_id===y._threadID){y._openDialog=z.dialog;p=true;x(y);y._timeout=n(y.destroy.bind(y,y._threadID),o);y._scrollListener=g.listen(window,'scroll',t.bind(null,y));}}function w(y,z){if(!y._openDialog){y._subscriptionTokens.push(z.subscribe('chat/dialog-rendered',v.bind(null,y)));z.render(y._tabMainElement,y._threadID);}}function x(y){y._subscriptionTokens.push(i.subscribe('chat/tabs-changed',s.bind(null,y)),r.subscribe('dialog/close-all',u.bind(null,y)));}m(r,h);m(r.prototype,{destroy:function(){u(this);},tabFocused:function(){if(q){w(this,this._videoCallTour);return;}if(!p)w(this,this._videoCallPromo);},tabNotActive:function(){u(this);},hideVideoCallouts:function(){u(this);}});j.subscribe('videocallingtour/start',function(){q=true;r.inform('dialog/close-all');});j.subscribe('videocallingtour/end',function(){q=false;});e.exports=r;},null);
__d("ChatFileUploaderMixin",["SubscriptionsHandler","React"],function(a,b,c,d,e,f,g,h){var i={propTypes:{attachmentsShelf:h.PropTypes.object,onFileUploaderMounted:h.PropTypes.func,onUploadFinished:h.PropTypes.func,onUpdateAttachmentsShelf:h.PropTypes.func,onSubmit:h.PropTypes.func},setUpSubscriptionsHandler:function(j){this._uploader=j;this._subscriptions=new g();this._subscriptions.addSubscriptions(this._uploader.subscribe(['all-uploads-completed','upload-canceled'],this._handleUploadFinished),this._uploader.subscribe('dom-updated',this._handleUpdateAttachmentsShelf),this._uploader.subscribe('submit',this._handleSubmit));this.props.onFileUploaderMounted(this._uploader);},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();this._uploader&&this._uploader.destroy();},isUploading:function(){return this._uploader.isUploading();},getAttachments:function(){return this._uploader.getAttachments();},getImageFiles:function(){return this._uploader.getImageFiles();},getVideoFiles:function(){return this._uploader.getVideoFiles();},removeAttachments:function(){return this._uploader.removeAttachments();},_handleUploadFinished:function(){if(this.props.onUploadFinished)this.props.onUploadFinished();},_handleUpdateAttachmentsShelf:function(){if(this.props.onUpdateAttachmentsShelf)this.props.onUpdateAttachmentsShelf();},_handleSubmit:function(){if(this.props.onSubmit)this.props.onSubmit();}};e.exports=i;},null);
__d("ChatFileUploader.react",["ChatFileUploaderMixin","InlineBlock.react","MercuryConfig","MercuryFileUploader","React","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){'use strict';var n=k.createClass({displayName:'ChatFileUploader',mixins:[g],shouldComponentUpdate:function(){return false;},componentDidMount:function(){var o=new j(this.props.attachmentsShelf,this.refs.form.getDOMNode(),this.refs.input.getDOMNode(),this.refs.attachID.getDOMNode());this.setUpSubscriptionsHandler(o);},render:function(){return (k.createElement(k.DOM.form,{ref:"form",action:i.upload_url,method:"post"},k.createElement(k.DOM.input,{type:"hidden",ref:"attachID",name:"attach_id"}),k.createElement(h,{className:"_m _4q60 itemLabel"},k.createElement(k.DOM.input,{type:"file",className:"_n",name:"attachment[]",multiple:"true",ref:"input"}),k.createElement(k.DOM.span,{className:"_4q61 itemAnchor"},"Add Files..."))));}});e.exports=n;},null);
__d("ChatPhotoEditorContextualDialog",["ContextualDialog","CSS","Event","LayerHideOnBlur","PhotoEditorConfig","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(n,o,p,q,r){"use strict";var s=l(k.Constants.CHAT_DIALOG_PATH).addQueryData({thread_id:r}).toString();p.setAttribute('ajaxify',s);this.$ChatPhotoEditorContextualDialog0=n;this.$ChatPhotoEditorContextualDialog1=q;i.listen(n,'click',this.$ChatPhotoEditorContextualDialog2.bind(this));i.listen(q,'click',this.$ChatPhotoEditorContextualDialog3.bind(this));}m.prototype.$ChatPhotoEditorContextualDialog2=function(){"use strict";var n=this.$ChatPhotoEditorContextualDialog4();if(n.isShown()){n.hide();}else n.show();};m.prototype.$ChatPhotoEditorContextualDialog3=function(){"use strict";this.$ChatPhotoEditorContextualDialog4().hide();};m.prototype.$ChatPhotoEditorContextualDialog4=function(){"use strict";if(!this.$ChatPhotoEditorContextualDialog5){var n={context:this.$ChatPhotoEditorContextualDialog0,width:115,alignment:'center',addedBehaviors:[j]};this.$ChatPhotoEditorContextualDialog5=new g(n,this.$ChatPhotoEditorContextualDialog1);h.show(this.$ChatPhotoEditorContextualDialog1);}return this.$ChatPhotoEditorContextualDialog5;};e.exports=m;},null);
__d("getImageSize",["DataViewPolyfill"],function(a,b,c,d,e,f,g){var h=a.DataView||g;function i(m){return {width:m.getUint16(6,true),height:m.getUint16(8,true)};}function j(m){return {width:m.getUint32(16,false),height:m.getUint32(20,false)};}function k(m){var n=m.byteLength,o=2;while(o<n){var p=m.getUint16(o,false);o+=2;if(p==65472||p==65474){return {width:m.getUint16(o+5,false),height:m.getUint16(o+3,false)};}else o+=m.getUint16(o,false);}return null;}function l(m){var n=new h(m);if(n.getUint8(0)==255&&n.getUint8(1)==216)return k(n);if(n.getUint8(0)==71&&n.getUint8(1)==73&&n.getUint8(2)==70)return i(n);if(n.getUint8(0)==137&&n.getUint8(1)==80&&n.getUint8(2)==78&&n.getUint8(3)==71)return j(n);return null;}e.exports=l;l.gif=i;l.png=j;l.jpeg=k;},null);
__d("ChatPhotoUploader.react",["ChatAutoSendPhotoUploader","Image.react","InlineBlock.react","Link.react","MercuryConfig","React","SubscriptionsHandler","cx","emptyFunction","fbt","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';var r=l.createClass({displayName:'ChatPhotoUploader',propTypes:{actionURI:l.PropTypes.string,onSubmit:l.PropTypes.func,onAllUploadsComplete:l.PropTypes.func,onLastUploadFail:l.PropTypes.func,onLastUploadCancel:l.PropTypes.func},getDefaultProps:function(){return {actionURI:k.upload_url,onSubmit:o,onAllUploadsComplete:o,onLastUploadFail:o,onLastUploadCancel:o};},componentDidMount:function(){this._uploader=new g(this.refs.form.getDOMNode(),this.refs.input.getDOMNode(),this.refs.attachID.getDOMNode());this._subscriptions=new m();this._subscriptions.addSubscriptions(this._uploader.subscribe('submit',this._handleSubmit),this._uploader.subscribe('all-uploads-completed',this._handleAllUploadsCompleted),this._uploader.subscribe('last-upload-failed',this._handleLastUploadFailed),this._uploader.subscribe('last-upload-canceled',this._handleLastUploadCanceled));},shouldComponentUpdate:function(s,t){return s.actionURI!=this.props.actionURI;},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();this._uploader&&this._uploader.destroy();},render:function(){return (l.createElement(l.DOM.form,{action:this.props.actionURI,method:"post",ref:"form"},l.createElement(l.DOM.input,{type:"hidden",name:"attach_id",ref:"attachID"}),l.createElement(l.DOM.input,{type:"hidden",name:"images_only",value:true}),l.createElement(i,{className:"_m _4q60 _3rzn"},l.createElement(j,{className:"_4q61 _509v"},l.createElement(h,{className:"_509w",src:q('/images/chat/chat_camera_icon.png'),alt:"Camera"})),l.createElement(l.DOM.input,{type:"file",className:"_n",name:"attachment[]",multiple:"true",accept:"image/*",ref:"input"}))));},_handleSubmit:function(s,t){this.props.onSubmit(s,t);},_handleAllUploadsCompleted:function(s,t){this.props.onAllUploadsComplete(s,t);},_handleLastUploadFailed:function(s,t){this.props.onLastUploadFail(s,t);},_handleLastUploadCanceled:function(s,t){this.props.onLastUploadCancel(s,t);},isUploading:function(){return this._uploader&&this._uploader.isUploading();},uploadFile:function(s){this._uploader.uploadFile(s);}});e.exports=r;},null);
__d("ChatPrivacyActionController",["ChatVisibility","JSLogger","PresencePrivacy","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){var k=function(l,m){this._userID=l;this._logger=h.create('blackbird');this._getState=function(){if(g.isOnline())return i.allows(this._userID)?k.NORMAL:k.BLOCKED;return k.OFFLINE;};this._togglePrivacy=function(){var n=this._getState();switch(this._getState()){case k.OFFLINE:if(g.isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});g.goOnline(function(){if(!i.allows(this._userID)){if(this._getState()!==k.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case k.BLOCKED:i.allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case k.NORMAL:i.disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};setTimeout(function(){var n=function(){m&&m(this._getState());}.bind(this);n();this._subscribeToken=i.subscribe('privacy-changed',n);}.bind(this),0);};k.OFFLINE='offline';k.BLOCKED='blocked';k.NORMAL='normal';j(k.prototype,{togglePrivacy:function(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function(){i.unsubscribe(this._subscribeToken);}});e.exports=k;},null);
__d("ChatShareLinkUploader",["AsyncRequest","CSS","DOM","URLScraper","MercuryShareLinkUploader","MercuryAttachmentTemplates","Event"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){for(var n in k)if(k.hasOwnProperty(n))p[n]=k[n];var o=k===null?null:k.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=k;function p(q,r,s){"use strict";this.$ChatShareLinkUploader0=q;this.$ChatShareLinkUploader1=r;this.$ChatShareLinkUploader2=s;this.$ChatShareLinkUploader3=false;this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader5=null;m.listen(r,'keyup',function(){!r.value.length&&this.$ChatShareLinkUploader6.enable();}.bind(this));this.$ChatShareLinkUploader6=new j(r);this.$ChatShareLinkUploader6.subscribe('match',function(t,u){this.loadShare(u&&u.url);}.bind(this));this.$ChatShareLinkUploader7=null;}p.prototype.getAttachData=function(){"use strict";return this.loadAttachData(this.$ChatShareLinkUploader3,this.$ChatShareLinkUploader0,this.$ChatShareLinkUploader1);};p.prototype.close=function(){"use strict";this.$ChatShareLinkUploader8();this.$ChatShareLinkUploader6.disable();this.inform('closed');};p.prototype.clear=function(){"use strict";this.$ChatShareLinkUploader8();this.$ChatShareLinkUploader6.enable();};p.prototype.$ChatShareLinkUploader8=function(){"use strict";var q=this.$ChatShareLinkUploader7;delete this.$ChatShareLinkUploader7;if(q){i.remove(q);this.inform('dom-updated');}this.$ChatShareLinkUploader3=false;this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader5&&this.$ChatShareLinkUploader5.abort();this.$ChatShareLinkUploader5=null;this.$ChatShareLinkUploader6&&this.$ChatShareLinkUploader6.reset();};p.prototype.loadShare=function(q,r){"use strict";this.$ChatShareLinkUploader4=q;this.$ChatShareLinkUploader5&&this.$ChatShareLinkUploader5.abort();var s=l[':fb:mercury:share-link-row'].build();if(this.$ChatShareLinkUploader7)i.remove(this.$ChatShareLinkUploader7);this.$ChatShareLinkUploader7=s.getRoot();m.listen(s.getNode('closeFileUpload'),'click',function(event){this.close();event.kill();}.bind(this));i.appendContent(this.$ChatShareLinkUploader0,this.$ChatShareLinkUploader7);h.show(this.$ChatShareLinkUploader0);this.inform('dom-updated');var t={u:q,chat:true,extra_params:JSON.stringify(r)};this.$ChatShareLinkUploader5=new g().setMethod('POST').setURI('/ajax/share_scrape.php').setData(t).setHandler(this.$ChatShareLinkUploader9.bind(this).bind(null,q));this.$ChatShareLinkUploader5.send();this.inform('link-detected');};p.prototype.$ChatShareLinkUploader9=function(q,r){"use strict";if(this.$ChatShareLinkUploader4!==q)return;this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader5=null;i.appendContent(this.$ChatShareLinkUploader7,r.payload);this.$ChatShareLinkUploader2();this.$ChatShareLinkUploader3=true;if(!this.getAttachData()){this.close();return;}h.addClass(this.$ChatShareLinkUploader7,'done');};e.exports=p;},null);
__d("StickerContextualDialog.react",["ReactAbstractContextualDialog","ReactLayer","cx"],function(a,b,c,d,e,f,g,h,i){'use strict';var j=47,k=h.createClass(g.createSpec({displayName:'StickerXUIContextualDialog',theme:{wrapperClassName:"_53ii",arrowDimensions:{offset:j,length:16}}}));k.WIDTH={NORMAL:312,WIDE:400};e.exports=k;},null);
__d("ChatStickerButton.react",["React","ReactLayeredComponentMixin","StickerContextualDialog.react","StickersFlyout.react","StickerState","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';var o=278,p=g.createClass({displayName:'ChatStickerButton',propTypes:{onStickerSelect:g.PropTypes.func,onEmoticonSelect:g.PropTypes.func,onFlyoutShown:g.PropTypes.func,onFlyoutHidden:g.PropTypes.func,packID:g.PropTypes.string,shown:g.PropTypes.bool},mixins:[h],getDefaultProps:function(){return {onStickerSelect:m,onEmoticonSelect:m,shown:false};},componentDidMount:function(){this._subscription=k.addListener(k.PACK_SELECTED,function(q){return this.setProps({packID:q});}.bind(this));},shouldComponentUpdate:function(q,r){return (q.packID!=this.props.packID||q.shown!=this.props.shown);},componentWillUnmount:function(){this._subscription&&this._subscription.remove();},render:function(){return (g.createElement(g.DOM.a,{className:"_4vuh",onClick:this._showFlyout,onMouseDown:this._prepareForClick,title:"Choose a sticker or emoticon",ref:"link"},g.createElement(g.DOM.div,{className:(("_4vui")+(this.props.shown?' '+"open":''))})));},renderLayers:function(){return {contextualDialog:g.createElement(i,{alignment:"left",className:"_5e-r",contextRef:"link",onBlur:this._hideFlyout,position:"above",shown:this.props.shown,width:o},g.createElement(g.DOM.div,null,g.createElement(j,{onShown:function(q){return this.props.onFlyoutShown&&this.props.onFlyoutShown(q);}.bind(this),onHidden:function(){return this.props.onFlyoutHidden&&this.props.onFlyoutHidden();}.bind(this),onEscKeyDown:this._hideFlyout,onStickerSelect:this._handleStickerSelected,onEmoticonSelect:this._handleEmoticonSelected,packID:this.props.packID,shown:this.props.shown})))};},_prepareForClick:function(){this._clickGuard=this.props.shown;},_showFlyout:function(){!this._clickGuard&&this.setProps({shown:true});},_hideFlyout:function(){this.setProps({shown:false});},_handleStickerSelected:function(q){this.props.onStickerSelect(q);},_handleEmoticonSelected:function(q){this._hideFlyout();this.props.onEmoticonSelect(q);}});e.exports=p;},null);
__d("ChatTabMenu.react",["ChatFileUploader.react","ChatPrivacyActionController","ChatConfig","MercuryConfig","MercuryThreadMuter","React","PopoverMenu.react","ReactMenu","MenuSeparator.react","Toggler","TrackingNodes","cx","fbt","goURI","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){'use strict';var u=b('MercuryThreadMetadataRenderer').get(),v=b('MercuryThreads').get(),w=n.Item,x=l.createClass({displayName:'ChatTabMenu',propTypes:{onFileUploaderMounted:l.PropTypes.func,updatePrivacyLinkFunc:l.PropTypes.func,nameConversationFunc:l.PropTypes.func,leaveConversationFunc:l.PropTypes.func,showParticipantsFunc:l.PropTypes.func,clearHistoryFunc:l.PropTypes.func,reportSpamFunc:l.PropTypes.func,createGroupFunc:l.PropTypes.func,isMultichat:l.PropTypes.bool,showAddFriend:l.PropTypes.func,threadID:l.PropTypes.string,attachmentsShelf:l.PropTypes.object,onUploadFinished:l.PropTypes.func,onUpdateAttachmentsShelf:l.PropTypes.func,onSubmit:l.PropTypes.func,enableDesktopNotif:l.PropTypes.func},getDefaultProps:function(){return {show:true};},componentWillMount:function(){if(!this.props.isMultiChat)this._privacyActionController=new h(v.getCanonicalUserInThread(this.props.threadID),this.props.updatePrivacyLinkFunc);},componentDidMount:function(){if(!this.props.fullURL){var y=this;u.getWebMessengerURL(this.props.threadID,function(z){y.setProps({fullURL:z});});}},componentWillUnmount:function(){this._privacyActionController&&this._privacyActionController.destroy();},_unmuteThread:function(){v.updateThreadMuteSetting(this.props.threadID,0);p.hide();},_renderFileUploader:function(){return (l.createElement(w,{className:"_37_x"},l.createElement(g,{onFileUploaderMounted:this.props.onFileUploaderMounted,attachmentsShelf:this.props.attachmentsShelf,onUploadFinished:this.props.onUploadFinished,onUpdateAttachmentsShelf:this.props.onUpdateAttachmentsShelf,onSubmit:this.props.onSubmit})));},_renderOpenFullConversation:function(){if(this.props.fullURL)return (l.createElement(w,{onclick:function(){return t(this.props.fullURL);}.bind(this)},"See Full Conversation"));return null;},_renderAddFriend:function(){return (l.createElement(w,{onclick:this.props.showAddFriend},"Add Friends to Chat..."));},_renderTogglePrivacy:function(){if(!this.props.isMultichat){var y=this._privacyActionController.togglePrivacy.bind(this._privacyActionController);return (l.createElement(w,{onclick:y},this.props.privacyText));}return null;},_renderMuteConversation:function(){if(!this.props.isMuted){var y=k.showMuteChangeDialog.bind(null,this.props.threadID);return (l.createElement(w,{onclick:y},"Mute Conversation..."));}else return (l.createElement(w,{onclick:this._unmuteThread},"Unmute Conversation"));},_renderClearConversation:function(){if(!this.props.isMultichat)return (l.createElement(w,{onclick:this.props.clearHistoryFunc},"Clear Window"));return null;},_renderReportSpam:function(){if(!this.props.isMultichat)return (l.createElement(w,{onclick:this.props.reportSpamFunc},"Report as Spam or Abuse..."));return null;},_renderCreateGroup:function(){if(this.props.isMultichat&&i.get('group_create_multichat_dock'))return (l.createElement(w,{onclick:this.props.createGroupFunc},"Create Group"));return null;},_renderConversationName:function(){if(this.props.isMultichat&&this.props.fullURL)return (l.createElement(w,{onclick:this.props.nameConversationFunc},"Edit Conversation Name"));return null;},_renderLeaveConversation:function(){if(this.props.isMultichat)return (l.createElement(w,{onclick:this.props.leaveConversationFunc},"Leave Conversation..."));return null;},_renderEnableDesktopNotifications:function(){if(j.DesktopNotificationsGK&&"Notification" in window&&Notification.permission!=="granted")return (l.createElement(w,{onclick:this.props.enableDesktopNotif},"Enable Desktop Notifications"));return null;},_renderPeopleList:function(){if(this.props.isMultichat&&this.props.fullURL&&i.get('chat_remove_participants'))return (l.createElement(w,{onclick:this.props.showParticipantsFunc},"Edit Participants..."));return null;},render:function(){var y=this._renderReportSpam(),z=this._renderCreateGroup(),aa=l.createElement(n,{className:(("chatReact")+(!this.props.show?' '+"hidden_elem":''))},this._renderOpenFullConversation(),this._renderFileUploader(),this._renderAddFriend(),this._renderTogglePrivacy(),this._renderConversationName(),this._renderPeopleList(),l.createElement(o,null),this._renderMuteConversation(),this._renderClearConversation(),this._renderLeaveConversation(),y?(l.createElement(o,null)):null,y,z?(l.createElement(o,null)):null,z,this._renderEnableDesktopNotifications()),ba="Options",ca=q.getTrackingInfo(q.types.DROPDOWN_BUTTON);return (l.createElement(m,{menu:aa},l.createElement(l.DOM.a,{'data-ft':ca,'data-hover':"tooltip",'aria-label':ba,'data-tooltip-alignh':"center",className:"button"})));}});e.exports=x;},null);
__d("ChatDateBreak.react",["React","ReactPropTypes","Timestamp.react","cx","formatDate","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=g.createClass({displayName:'ChatDateBreak',propTypes:{date:h.instanceOf(Date).isRequired},shouldComponentUpdate:function(n){return this.props.date.getTime()!==n.date.getTime();},render:function(){var n=this.props.date,o=k(n,{today:'g:ia',withinWeek:'l g:ia',thisYear:'F jS, g:ia',older:'F j, Y g:i a'}),p=Math.round(n.getTime()/1000);return (g.createElement(g.DOM.div,Object.assign({},this.props,{className:l(this.props.className,"_5w-5")}),g.createElement(g.DOM.div,{className:"_5w-6"},g.createElement(i,{time:p,verbose:o,text:o}))));}});e.exports=m;},null);
__d("ChatAuthorPhotoBlock.react",["MercuryParticipants","ReactPropTypes","React","cx","formatDate","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=86400000,n=i.createClass({displayName:'ChatAuthorPhotoBlock',propTypes:{authorID:h.string.isRequired,hideName:h.bool,hidePhoto:h.bool,timestamp:h.number},getInitialState:function(){return {author:{id:null,name:'',href:'#',image_src:''}};},componentDidMount:function(){this.updateAuthor(this.props.authorID);},componentWillReceiveProps:function(o){if(o.authorID!=this.state.author.id)this.updateAuthor(o.authorID);},render:function(){return (i.createElement(i.DOM.div,Object.assign({},this.props,{className:l(this.props.className,"_5yt9")}),this.renderAuthorName(),this.renderAuthorPhoto(),this.props.children));},renderAuthorName:function(){if(!this.props.hideName)return (i.createElement(i.DOM.div,{className:"_5ys-",ref:"name"},this.state.author.name));},renderAuthorPhoto:function(){if(!this.props.hidePhoto){var o=null;if(this.props.timestamp){var p=(Date.now()-this.props.timestamp>m)?'M jS, g:ia':'g:ia';o=k(new Date(this.props.timestamp),p);}return (i.createElement(i.DOM.a,{'aria-label':o,className:"_5ys_",'data-hover':"tooltip",'data-tooltip-position':"left",href:this.state.author.href,ref:"link"},i.createElement(i.DOM.img,{src:this.state.author.image_src,ref:"image"})));}},updateAuthor:function(o){g.get(o,function(p){this.isMounted()&&this.setState({author:p});}.bind(this));}});e.exports=n;},null);
__d("ChatBubble.react",["DOM","DOMDimensions","MercuryMessageRenderer","ReactPropTypes","React","cx","fbt","startsWith","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=null,q=k.createClass({displayName:'ChatBubble',propTypes:{attachments:j.renderable,body:j.string,maxWidth:j.number.isRequired},getInitialState:function(){return {bubbleWidth:this.props.maxWidth};},componentDidMount:function(){this.renderDOMBody();this.shrinkBubble();},componentWillReceiveProps:function(r){if(r.body!=this.props.body)this.setState({bubbleWidth:this.props.maxWidth});},componentDidUpdate:function(r,s){this.renderDOMBody();if(r.body!=this.props.body)this.shrinkBubble();},render:function(){return (k.createElement(k.DOM.div,Object.assign({},this.props,{className:o(this.props.className,"_5w1r"),ref:"bubble",style:Object.assign({},(this.props.style||{}),{maxWidth:this.state.bubbleWidth})}),k.createElement(k.DOM.div,null,k.createElement(k.DOM.span,{className:"_5yl5",ref:"content"},this.renderBody())),this.props.attachments));},renderBody:function(){var r=this.props.body||'';if(n(r,'?OTR'))return (k.createElement(k.DOM.span,{className:"_89h"},"[encrypted message]"));return r;},renderDOMBody:function(){var r=this.props.body||'';if(!n(r,'?OTR'))g.setContent(this.refs.content.getDOMNode(),i.formatMessageBody(r));},shrinkBubble:function(){var r=this.refs.bubble.getDOMNode(),s=this.refs.content.getDOMNode(),t=h.getElementDimensions(r).width,u=h.getElementDimensions(s).width;if(this.contentWraps()&&u>0&&u<this.props.maxWidth&&t-u-this.getBoxWidth()>0&&u!=this.state.bubbleWidth)this.setState({bubbleWidth:u});},contentWraps:function(){var r=this.refs.content.getDOMNode(),s=r.getClientRects(),t=h.getElementDimensions(r).height;return (s&&s.length>1&&s[0].height<t);},getBoxWidth:function(){if(!p)p=h.measureElementBox(this.refs.bubble.getDOMNode(),'width',true,true,false);return p;}});e.exports=q;},null);
__d("MercurySpoofWarning.react",["MercuryParticipants","ReactPropTypes","React","fbt"],function(a,b,c,d,e,f,g,h,i,j){var k=i.createClass({displayName:'MercurySpoofWarning',propTypes:{authorID:h.string.isRequired},getInitialState:function(){return {author:{name:''}};},componentWillMount:function(){this.componentWillReceiveProps(this.props);},componentWillReceiveProps:function(l){g.get(l.authorID,function(m){return this.setState({author:m});}.bind(this));},render:function(){return (i.createElement(i.DOM.div,Object.assign({},this.props),j._("Unable to confirm {name_or_email} as the sender.",[j.param("name_or_email",this.state.author.name)])));}});e.exports=k;},null);
__d("ChatMessage.react",["ChatAnimatedGifs","ChatAuthorPhotoBlock.react","ChatBubble.react","ChatConfig","CSS","ImmutableObject","MercuryAttachment","MercuryAttachments.react","MercuryAttachmentRenderer","MercuryErrorInfo","MercuryIDs","MercuryMessageError.react","MercurySpoofWarning.react","React","ReactPropTypes","cx","fbt","formatDate","isRTL","joinClasses","MercuryMessages"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){'use strict';var aa=b('MercuryMessages').get(),ba=t.createClass({displayName:'ChatMessage',propTypes:{message:u.instanceOf(l).isRequired,maxBubbleWidth:u.number.isRequired,onImageLoad:u.func,onStickerClick:u.func},componentDidMount:function(){k.conditionClass(this.getDOMNode(),"_2cnu",this.isOneLine());},isOneLine:function(){var ca=this.props.message;return aa.isInbound(ca)&&!this.refs.attachmentsInside&&this.refs.bubble&&!this.refs.bubble.contentWraps();},shouldComponentUpdate:function(ca,da){return ca.message!==this.props.message;},render:function(){var ca=this.props.message,da=aa.isInbound(ca),ea=q.isMultichat(ca.thread_id),fa=y(ca.body),ga=j.get('chat_fading_bubbles')&&!da&&aa.isSending(ca),ha=p.hasErrorStatus(ca),ia=(("_5wd4")+(da?' '+"_1nc7":'')+(!da?' '+"_1nc6":'')+(da&&ea?' '+"_5ysy":'')+(ga?' '+"_4oe5":'')+(ha?' '+"_1zcs":'')+(fa?' '+"direction_rtl":'')+(!fa?' '+"direction_ltr":'')),ja=new Date(ca.timestamp);return (t.createElement(h,Object.assign({},this.props,{authorID:ca.author,className:z(this.props.className,ia),hideName:!da||!ea,hidePhoto:!da,timestamp:ca.timestamp,title:da?null:x(ja,'g:ia')}),this._renderInner(),this._renderUndertext()));},_renderInner:function(){if(this.props.message.is_filtered_content)return (t.createElement(t.DOM.div,{className:"_5wd9",ref:"inner"},this._renderFilteredContent()));return (t.createElement(t.DOM.div,{className:"_5wd9",ref:"inner"},this._renderBubble(),this._renderAttachments('outside')));},_renderUndertext:function(){if(this.props.message.is_filtered_content)return null;return (t.createElement(t.DOM.div,{className:"_3ry4",ref:"undertext"},t.createElement(r,{className:"_5wda clearfix",message:this.props.message,ref:"status"}),this._renderSpoofWarning()));},_renderSpoofWarning:function(){return (this.props.message.is_spoof_warning?t.createElement(s,{authorID:this.props.message.author,className:"_5wdb"}):null);},_renderFilteredContent:function(){return t.createElement(t.DOM.div,{className:"_5wdc uiBoxYellow clearfix"},"This message is no longer available because it was identified as abusive or marked as spam.");},_renderAttachments:function(ca){var da=this.props.message,ea=ca=='inside'?'attachmentsInside':'attachmentsOutside',fa=m.get(da).filter(function(ga){var ha=o.isBubblePreferred(ga);return (ha&&ca==='inside')||(!ha&&ca==='outside');});if(fa.length>0)return t.createElement(n,{className:"_5wdd clearfix",isChat:true,message:da,attachments:fa,ref:ea,onImageLoad:this.props.onImageLoad,onStickerClick:this.props.onStickerClick});},_renderBubble:function(){var ca=this.props.message,da=ca.body,ea=this._renderAttachments('inside');if(g.shouldHideBody(ca))da='';if(da||ea)return (t.createElement(t.DOM.div,{className:"_5wde"},t.createElement(i,{attachments:ea,body:da,className:"_5wdf",maxWidth:this.props.maxBubbleWidth,ref:"bubble"})));}});e.exports=ba;},null);
__d("ChatVideoCallLink.react",["Arbiter","ChatVisibility","MercuryParticipants","PresencePrivacy","React","ReactPropTypes","SubscriptionsHandler","VideoCallCore","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=k.createClass({displayName:'ChatVideoCallLink',propTypes:{message:l.object.isRequired,onClick:l.func.isRequired},componentDidMount:function(){this._subscriptions=new m();this._subscriptions.addSubscriptions(g.subscribe(['buddylist/availability-changed'],this.availabilityChanged),j.subscribe(['privacy-changed','privacy-availability-changed'],this.availabilityChanged));},componentWillUnmount:function(){this._subscriptions.release();},render:function(){return (k.createElement(k.DOM.a,{className:(("callBackLink")+(this.shouldHideLink()?' '+"hidden_elem":'')),'data-gt':JSON.stringify({videochat:'clicked_callback_link'}),href:"#",onClick:this.linkClicked},this.renderLinkText()));},renderLinkText:function(){if(this.props.message.log_message_data.event_name=='install_canceled'){return ("Retry setup and call back.");}else if(!this.props.message.log_message_data.event_name&&this.props.message.log_message_data.callee==i.user&&!this.props.message.log_message_data.answered)return ("Call back.");},shouldHideLink:function(){return !h.isOnline()||!n.availableForCall(this.props.message.log_message_data.to);},linkClicked:function(){var r;if(this.props.message.log_message_data.event_name=='install_canceled'){r='callback_cancelinstall_link';}else if(!this.props.message.log_message_data.event_name&&this.props.message.log_message_data.callee==i.user&&!this.props.message.log_message_data.answered)r='callback_link';this.props.onClick(this.props.message.log_message_data.to,this.props.message.thread_id,r);},availabilityChanged:function(){this.forceUpdate();}});e.exports=q;},null);
__d("MercuryLogMessage.react",["DOM","Event","ChatVideoCallLink.react","ImmutableObject","MercuryLogMessageRenderer","MercuryLogMessageType","React","ReactPropTypes","VideoCallSupport","cx","emptyFunction","formatDate","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';var t=m.createClass({displayName:'MercuryLogMessage',propTypes:{message:n.instanceOf(j).isRequired,onImageLoad:n.func,onVideoCallLinkClick:n.func},getDefaultProps:function(){return {onImageLoad:q};},getInitialState:function(){return {messageText:null};},componentDidMount:function(){this.componentWillReceiveProps(this.props);},componentWillReceiveProps:function(u){k.renderText(u.message,function(v){this.setState({messageText:v});}.bind(this));},shouldComponentUpdate:function(u,v){return this.state.messageText!=v.messageText;},componentDidUpdate:function(){var u=this.refs.attachment.getDOMNode();k.renderAttachmentLegacy(u,this.props.message);g.scry(u,'img').forEach(function(v){var w=h.listen(v,'load',function(){this.props.onImageLoad(v);w.remove();}.bind(this));}.bind(this));},render:function(){return (m.createElement(m.DOM.div,Object.assign({},this.props,{className:s(this.props.className,"_5ye6"),title:r(new Date(this.props.message.timestamp),'g:ia')}),k.renderIcon(this.props.message),m.createElement(m.DOM.div,{className:"_5ye7"},this.state.messageText,this.renderVideoCallLink()),m.createElement(m.DOM.div,{className:"_5ye8",ref:"attachment"})));},renderVideoCallLink:function(){if(this.props.message.log_message_type!==l.VIDEO_CALL||!this.props.onVideoCallLinkClick||!o.isVideoCallSupported())return null;return (m.createElement(i,{message:this.props.message,onClick:this.props.onVideoCallLinkClick}));}});e.exports=t;},null);
__d("ChatConversation.react",["ChatConfig","ChatDateBreak.react","ChatMessage.react","CurrentUser","MercuryConstants","ImmutableObject","MercuryActionTypeConstants","MercuryLogMessage.react","React","cx","invariant","OrionMercuryReceiverNUX"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';var r=b('OrionMercuryReceiverNUX').module,s=k.MercurySupportedShareType,t=1000*60*60,u=o.createClass({displayName:'ChatConversation',propTypes:{maxBubbleWidth:o.PropTypes.number.isRequired,messages:o.PropTypes.arrayOf(o.PropTypes.instanceOf(l)).isRequired,onCallLinkClick:o.PropTypes.func,onImageLoad:o.PropTypes.func,onStickerClick:o.PropTypes.func},componentWillReceiveProps:function(v){q(v.maxBubbleWidth===this.props.maxBubbleWidth);},render:function(){var v=this.props.messages,w=[];for(var x=0;x<v.length;x++){var y=v[x],z=(x>0)?v[x-1]:null;if(y.is_cleared)continue;if(!z||z.is_cleared||y.timestamp-z.timestamp>t)w.push(o.createElement(h,{date:new Date(y.timestamp),key:'db:'+y.message_id}));if(y.action_type==m.LOG_MESSAGE){w.push(o.createElement(n,{className:"_5w0o",key:y.message_id,message:y,onImageLoad:this.props.onImageLoad,onCallLinkClick:this.props.onCallLinkClick}));}else w.push(o.createElement(i,{key:y.message_id,message:y,maxBubbleWidth:this.props.maxBubbleWidth,onImageLoad:this.props.onImageLoad,onStickerClick:this.props.onStickerClick}));if(r&&!g.get('orion_receiver_nux_completed')&&y.attachments&&y.attachments.length&&y.attachments[0].share_data_type===s.FB_ORION&&y.attachments[0].metadata&&y.attachments[0].metadata.receiver&&y.attachments[0].metadata.receiver.id===j.getID()){var aa=y.attachments[0],ba=aa.metadata;w.push(o.createElement(r,{key:'omrn:'+y.message_id,amount:ba.amount,currency:ba.currency,creationTime:ba.creationTime,onImageLoad:this.props.onImageLoad,sender:ba.sender}));}}return o.createElement(o.DOM.div,null,w);}});e.exports=u;},null);
__d("ChatTypingIndicators.react",["ChatAuthorPhotoBlock.react","DOM","MercuryIDs","MercuryParticipants","ReactPropTypes","React","SubscriptionsHandler","Tooltip","MercuryTypingReceiver","arraySort","createObjectFrom","cx","emptyFunction","fbt","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=b('MercuryThreadInformer').get(),v=l.createClass({displayName:'ChatTypingIndicators',propTypes:{indicatorsWillShow:k.func,indicatorsDidShow:k.func,threadID:k.string.isRequired},getDefaultProps:function(){return {indicatorsWillShow:s,indicatorsDidShow:s};},getInitialState:function(){return {typingUserIDs:[]};},componentDidMount:function(){this._subscriptions=new m();this._subscriptions.addSubscriptions(o.addRetroactiveListener('state-changed',this.typingStateChanged),u.subscribe('messages-received',this.messagesReceived));},componentWillReceiveProps:function(w){if(w.threadID!=this.props.threadID)this.setState({typingUserIDs:[]});},componentWillUpdate:function(w,x){if(x.typingUserIDs.length>0)this.props.indicatorsWillShow();},componentDidUpdate:function(){if(this.state.typingUserIDs.length>0)this.props.indicatorsDidShow();j.getMulti(this.state.typingUserIDs,function(w){if(this.isMounted())this.state.typingUserIDs.forEach(function(x){var y=w[x];n.set(this.refs[x].getDOMNode(),this.renderTooltip(y.short_name),'above','left');}.bind(this));}.bind(this));},componentWillUnmount:function(){this._subscriptions.release();},render:function(){var w=i.isMultichat(this.props.threadID);return (l.createElement(l.DOM.div,{className:"_2fsr"},this.state.typingUserIDs.map(function(x){return l.createElement(g,{authorID:x,className:(("_gfq")+(w?' '+"_52fu":'')),hideName:!w,key:x},l.createElement(l.DOM.div,{className:"_52ft"},l.createElement(l.DOM.div,{className:"_gfp",ref:x})));})));},renderTooltip:function(w){var x=h.create('span');l.renderComponent(l.createElement(l.DOM.span,null,t._("{name} is typing...",[t.param("name",w)])),x);return x;},typingStateChanged:function(w){if(this.props.threadID in w)this.setState({typingUserIDs:p(w[this.props.threadID])});},messagesReceived:function(w,x){if(this.props.threadID in x){var y=x[this.props.threadID],z=q(y.map(function(aa){return aa.author;}));this.setState({typingUserIDs:p(this.state.typingUserIDs.filter(function(aa){return !z[aa];}))});}}});e.exports=v;},null);
__d("MercuryTypingIndicator",["Animation","CSS","DOM","MercuryTypingReceiver","MercuryParticipants","Style","ChatTabTemplates","Tooltip","copyProperties","cx","tx","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=b('MercuryThreadInformer').get(),s=[];r.subscribe('messages-received',function(v,w){s.forEach(function(x){var y=w[x._threadID];y&&x.receivedMessages(y);});});j.addRetroactiveListener('state-changed',function(v){s.forEach(function(w){var x=v[w._threadID];x&&w._handleStateChanged(x);});});function t(v){var w=m[':fb:chat:conversation:message-group'].build(),x=m[':fb:mercury:typing-indicator:typing'].build();h.addClass(w.getRoot(),"_50kd");var y=w.getNode('profileLink');n.set(y,v.name,'left');y.href=v.href;w.setNodeContent('profileName',v.name);w.setNodeProperty('profilePhoto','src',v.image_src);var z=q._("{name} is typing...",{name:v.short_name});n.set(x.getRoot(),z,'above');i.appendContent(w.getNode('messages'),x.getRoot());return w;}function u(v,w,x){this._animations={};this._activeUsers={};this._typingIndicator=w;this._messagesView=x;this._threadID=v;this._subscription=j.addRetroactiveListener('state-changed',function(y){var z=y[this._threadID];z&&this._handleStateChanged(z);}.bind(this));s.push(this);}o(u.prototype,{destroy:function(){Object.keys(this._activeUsers).forEach(this._removeUserBubble.bind(this));this._controller.destroy();s.remove(this);},receivedMessages:function(v){v.forEach(function(w){if(!k.isAuthor(w.author))this._removeUserBubble(w.author);}.bind(this));},_handleStateChanged:function(v){for(var w in this._activeUsers)if(v.indexOf(w)===-1){this._slideOutUserBubble(w);delete this._activeUsers[w];}if(v.length)k.getMulti(v,function(x){var y=this._messagesView.isScrolledToBottom(),z={};for(var aa in x){var ba=this._activeUsers[aa];z[aa]=ba||t(x[aa]).getRoot();if(!ba)i.appendContent(this._typingIndicator,z[aa]);}var ca=Object.keys(z).length>0;y&&this._messagesView.scrollToBottom(ca);this._activeUsers=z;}.bind(this));},_removeUserBubble:function(v,w){var x=this._getCurrentAnimation(v,w);if(x){x.animation.stop();i.remove(x.elem);delete this._animations[v];}if(v in this._activeUsers){i.remove(this._activeUsers[v]);delete this._activeUsers[v];}w&&i.remove(w);},_slideOutUserBubble:function(v){var w=this._activeUsers[v];if(this._getCurrentAnimation(v,w)){return;}else if(w){l.set(w,'overflow','hidden');var x=(new g(w)).from('opacity',1).from('height',w.offsetHeight).to('height',0).to('opacity',0).ease(g.ease.end).duration(250).ondone(this._removeUserBubble.bind(this,v,w)).go();this._animations[v]={animation:x,elem:w};}},_getCurrentAnimation:function(v,w){if(this._animations[v]&&(!w||this._animations[v].elem===w))return this._animations[v];}});e.exports=u;},null);
__d("MercuryMessageList",["ImmutableObject","LogHistory","OrderedMap","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j){'use strict';var k=h.getInstance('mercury_message_list');function l(q){this.$MercuryMessageList0=n(q?m(q):[]);}l.prototype.append=function(q){this.$MercuryMessageList0=this.$MercuryMessageList0.merge(n(m(q)));p('append',q);};l.prototype.prepend=function(q){this.$MercuryMessageList0=n(m(q)).merge(this.$MercuryMessageList0);p('prepend',q);};l.prototype.update=function(q){this.$MercuryMessageList0=this.$MercuryMessageList0.merge(n(m(q.filter(function(r){return this.contains(r);}.bind(this)))));p('update',q);};l.prototype.reorder=function(q){this.$MercuryMessageList0=n(q.map(function(r){var s=this.$MercuryMessageList0.get(r.message_id);if(!s||s.timestamp!=r.timestamp||s.is_cleared!=r.is_cleared)return new g(r);return s;}.bind(this)));p('reorder',q);};l.prototype.hasReachedClearedMessages=function(){var q=this.messageAt(0);return !!(q&&q.is_cleared);};l.prototype.messageAt=function(q){var r=this.$MercuryMessageList0.keyAtIndex(q);return r?this.$MercuryMessageList0.get(r):undefined;};l.prototype.contains=function(q){return this.$MercuryMessageList0.indexOfKey(o(q))!==undefined;};l.prototype.toArray=function(){return this.$MercuryMessageList0.toArray();};l.prototype.toOrderedMap=function(){return this.$MercuryMessageList0;};function m(q){return q.map(function(r){return new g(r);});}function n(q){return i.fromArray(q,o);}function o(q){return q.message_id;}function p(event,q){j(function(){k.debug(event,{messageIDs:q.map(function(r){return r.message_id;})});},0);}e.exports=l;},null);
__d("MercuryMessageStore",["MercuryAPIArgsSource","LogHistory","MercuryMessageList","MercuryParticipants","SubscriptionsHandler","MercuryThreadlistConstants","copyProperties","merge","mixInEventEmitter","setTimeoutAcrossTransitions","MercuryMessages","MercuryThreads","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';var q=b('MercuryMessages').get(),r=b('MercuryThreads').get(),s=b('MercuryThreadInformer').get(),t=h.getInstance('mercury_message_store');function u(w){this.$MercuryMessageStore0=w;this.$MercuryMessageStore1=new i();this.$MercuryMessageStore2=1;this.$MercuryMessageStore3=null;this.$MercuryMessageStore4=0;this.$MercuryMessageStore5=new k();this.$MercuryMessageStore5.addSubscriptions(s.subscribe('messages-received',function(x,y){return this.$MercuryMessageStore7(y);}.bind(this)),s.subscribe('messages-updated',function(x,y){return y[this.$MercuryMessageStore0]&&this.$MercuryMessageStore8(y[this.$MercuryMessageStore0]);}.bind(this)),s.subscribe('messages-reordered',function(x,y){return y[this.$MercuryMessageStore0]&&this.$MercuryMessageStore9();}.bind(this)));this.$MercuryMessageStorea();}u.prototype.setNewThreadID=function(w){this.$MercuryMessageStoreb=w;};u.prototype.destroy=function(){this.$MercuryMessageStore5&&this.$MercuryMessageStore5.release();};u.prototype.subscribe=function(w){return this.addRetroactiveListener('updated',w);};u.prototype.fetchMoreMessages=function(){if(q.hasLoadedExactlyNMessages(this.$MercuryMessageStore0,this.$MercuryMessageStore4)&&q.hasLoadedAllMessages(this.$MercuryMessageStore0))return false;if(r.isNewEmptyLocalThread(this.$MercuryMessageStore0))return false;if(this.$MercuryMessageStore1.hasReachedClearedMessages())return false;return this.$MercuryMessageStorea();};u.prototype.$MercuryMessageStorea=function(){var w=this.$MercuryMessageStore4+l.RECENT_MESSAGES_LIMIT*this.$MercuryMessageStore2;q.getThreadMessagesRange(this.$MercuryMessageStore0,0,w,this.$MercuryMessageStorec.bind(this),null,g.MERCURY);if(this.$MercuryMessageStore2<10)this.$MercuryMessageStore2+=1;if(q.hasLoadedNMessages(this.$MercuryMessageStore0,w)){this.$MercuryMessageStore9();return false;}return true;};u.prototype.$MercuryMessageStorec=function(w){if(w&&w.length){this.$MercuryMessageStore3=w[0].timestamp;this.$MercuryMessageStore4=w.length;}};u.prototype.$MercuryMessageStore7=function(w){var x=[],y=w[this.$MercuryMessageStore0];if(y&&y.length)x=x.concat(y);if(this.$MercuryMessageStoreb){var z=w[this.$MercuryMessageStoreb];if(z&&z.length){x=x.concat(z);this.$MercuryMessageStoreb=null;}}if(x.length){this.$MercuryMessageStore1.append(x);this.$MercuryMessageStore4+=x.length;var aa=x.every(function(ba){return ba.author!=j.user;});this.$MercuryMessageStored(u.MESSAGES_RECEIVED,{allFromOthers:aa});}};u.prototype.$MercuryMessageStore8=function(w){this.$MercuryMessageStore1.update(q.getMessagesFromIDs(Object.keys(w)));var x=this.$MercuryMessageStore1.messageAt(0);if(x)this.$MercuryMessageStore3=x.timestamp;this.$MercuryMessageStored(u.MESSAGES_CHANGED);};u.prototype.$MercuryMessageStore9=function(){if(!this.$MercuryMessageStore3)return;this.$MercuryMessageStore1.reorder(q.getThreadMessagesSinceTimestamp(this.$MercuryMessageStore0,this.$MercuryMessageStore3));this.$MercuryMessageStore3=this.$MercuryMessageStore1.messageAt(0).timestamp;this.$MercuryMessageStored(u.MESSAGES_REORDERED);};u.prototype.$MercuryMessageStored=function(w,x){var y=this.$MercuryMessageStore1.toArray();this.releaseHeldEventType('updated');this.emitAndHold('updated',n({messages:y,eventType:w},x));v(this.$MercuryMessageStore0,w,y);};function v(w,x,y){p(function(){t.debug('updated',{threadID:w,eventType:x,messageIDs:y.map(function(z){return z.message_id;})});},0);}m(u,{MESSAGES_FETCHED:'fetched',MESSAGES_CHANGED:'changed',MESSAGES_RECEIVED:'received',MESSAGES_REORDERED:'reordered'});o(u,{updated:true});e.exports=u;},null);
__d("ChatTabMessagesView",["Animation","Arbiter","ArbiterMixin","MercuryAttachment","MercuryAttachmentRenderer","BanzaiLogger","ChannelConstants","ChatAnimatedGifs","ChatConfig","ChatConversation.react","ChatDateBreak.react","ChatTypingIndicators.react","CSS","CurrentUser","DOM","Event","ImmutableObject","MercuryLastMessageIndicator.react","LiveTimer","MercuryActionTypeConstants","MercuryAPIArgsSource","MercuryErrorInfo","MercuryLogMessage.react","MercuryLogMessageType","MercurySourceType","MercuryMessageError.react","MercuryThreadlistConstants","MercuryTypingIndicator","MercuryMessageRenderer","MercuryMessageStore","Parent","MercuryParticipants","React","ServerTime","MercurySpoofWarning.react","MercuryStatusTemplates","StickerActions","StickerState","StickerStoreController","Style","SubscriptionsHandler","ChatTabTemplates","Tooltip","UserAgent_DEPRECATED","arrayContains","copyProperties","createArrayFrom","csx","cx","extendArray","formatDate","getElementPosition","isRTL","removeFromArray","shield","throttle","tx","MercuryMessages","MercuryServerRequests","MercuryThreadMetadataRenderer","MercuryThreads","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb){'use strict';var lb=b('MercuryMessages').get(),mb=b('MercuryServerRequests').get(),nb=b('MercuryThreadMetadataRenderer').get(),ob=b('MercuryThreads').get(),pb=b('MercuryThreadInformer').get(),qb,rb=34,sb=1000*60*60,tb=70,ub=null,vb=20;function wb(ec){return eb(new Date(ec),'g:ia');}function xb(ec){var fc=va[':fb:chat:conversation:message-group'].build(),gc=fc.getNode('profileLink'),hc=la.isAuthor(ec.author),ic=mb.tokenizeThreadID(ec.thread_id),jc=ic.type!=='user',kc=!hc;s.conditionClass(fc.getRoot(),"_50kd",!hc);s.conditionClass(fc.getRoot(),"_50x4",jc&&!hc);s.conditionShow(gc,kc);la.get(ec.author,function(lc){if(kc){gc.href=lc.href;var mc="You";if(!hc)mc=u.create('div',{className:"_522l"},[u.create('div',{className:"_522m"},wb(ec.timestamp)),lc.name]);wa.set(gc,mc,'left');if(!hc&&jc)fc.setNodeContent('profileName',lc.name);fc.setNodeProperty('profilePhoto','src',lc.image_src);}});return fc;}function yb(ec,fc){if(!s.hasClass(ec,"_kso")){var gc=u.scry(ec,"._kso");if(gc.length===1){ec=gc[0];}else return;}ta.set(ec,'max-width',zb(fc)+'px');var hc,ic,jc=ec.firstChild;if(ec.childNodes.length===1&&jc.getAttribute('data-measureme')){hc=jc.getClientRects();var kc=jc.offsetHeight;if(hc&&hc.length>1&&hc[0].height<kc){ic=true;if(!qb){u.remove(jc);qb=ec.offsetWidth;u.appendContent(ec,jc);}var lc=jc.offsetWidth,mc=ec.offsetWidth-lc-qb;if(mc>0)ta.set(ec,'max-width',lc+'px');}}var nc=ka.byClass(ec,"_50x4");if(nc)s.conditionClass(nc,"_51lo",hc?!ic:ec.offsetHeight<rb);}function zb(ec){if(ub===null){var fc=ec.childNodes[0];ta.set(ec,'overflow','scroll');ub=fc.clientWidth-tb;ta.set(ec,'overflow','');}return ub;}function ac(ec){var fc=va[':fb:mercury:chat:message:forward'].build(),gc=fc.getNode('forwardText');if(gc){s.hide(fc.getRoot());nb.renderWebMessengerLink(ec.thread_id,fc.getNode('forwardLink'),s.show.bind(s,fc.getRoot()));if(ec.forward_count>1){u.appendContent(gc,kb._("{count} forwarded messages",{count:ec.forward_count}));}else u.appendContent(gc,"1 forwarded message");}return fc.getRoot();}var bc=[];function cc(ec,fc,gc,hc,ic,jc,kc,lc){this.loadingIcon=ic;this.threadID=ec;this.sheetController=fc;this.scrollContainer=gc;this.conversationElem=hc;this.messageElements={};this.tabView=lc;this.messageGroup=null;this.prevMessage=null;y.restart(na.get()/1000);this._fetchMultiplier=1;this._oldestMessageDisplayedTimestamp=null;this._loadingMoreMessages=false;this._currentMessageCount=0;this._hasReachedClearedMessages=false;var mc=ga.MESSAGE_TIMESTAMP_THRESHOLD;this._oldestMessageDisplayedTimestamp=Date.now()-mc;bc.push(this);function nc(){cc.inform('interaction-with-tab',ec);}this._subscriptions=new ua();this._subscriptions.addSubscriptions(h.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this)),v.listen(this.scrollContainer,'mousedown',nc));if(xa.firefox()){var oc=('WheelEvent' in window)?'wheel':'DOMMouseScroll';this.scrollContainer.addEventListener(oc,nc,false);}else this._subscriptions.addSubscriptions(v.listen(this.scrollContainer,'mousewheel',nc));this._subscriptions.addSubscriptions(v.listen(this.scrollContainer,'scroll',jb(this.scrolling,50,this)));if(o.get('chat_react')){var pc;ma.renderComponent(ma.createElement(r,{threadID:this.threadID,indicatorsWillShow:function(){return pc=this.isScrolledToBottom();}.bind(this),indicatorsDidShow:function(){return pc&&this.scrollToBottom(true);}.bind(this)}),kc);}else this.typingIndicator=new ha(this.threadID,kc,this);var qc;this.lastMessageIndicatorNode=jc;this.lastMessageIndicator=ma.renderComponent(ma.createElement(x,{threadID:this.threadID,hideTyping:true,indicatorWillShow:function(){return qc=this.isScrolledToBottom();}.bind(this),indicatorDidShow:function(){return qc&&this.scrollToBottom(true);}.bind(this)}),this.lastMessageIndicatorNode);if(o.get('chat_react_user_messages')){this.initializeConversation();}else{lb.getThreadMessagesRange(this.threadID,0,ga.RECENT_MESSAGES_LIMIT,this._updateTimestamp.bind(this));this.rerender();}}za(cc,i);za(cc.prototype,{initializeConversation:function(){this._store=new ja(this.threadID);this._conversation=ma.renderComponent(ma.createElement(p,{maxBubbleWidth:zb(this.scrollContainer),messages:[],onImageLoad:function(ec){var fc=this.scrollContainer,gc=fc.scrollTop+fc.clientHeight;if(gc+ec.offsetHeight>=fc.scrollHeight)this.scrollToBottom();}.bind(this),onStickerClick:this._onStickerClick.bind(this),onCallLinkClick:function(ec,fc,gc){cc.inform('video-call-clicked',{userID:ec,threadID:fc,clickSource:gc});}}),this.conversationElem);this._subscriptions.addSubscriptions(this._store.subscribe(function(ec){if(ec.eventType==ja.MESSAGES_RECEIVED&&ec.allFromOthers&&!this.isScrolledToBottom()){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}if(ec.eventType==ja.MESSAGES_REORDERED){this._loadingMoreMessages=false;s.hide(this.loadingIcon);}var fc=this.isScrolledToBottom(),gc=this._getLoadingHeight(),hc=this.scrollContainer.scrollHeight,ic=this.scrollContainer.scrollTop,jc=ec.messages;this._conversation.setProps({messages:jc},function(){if(fc){this.scrollToBottom();}else if(ec.eventType==ja.MESSAGES_REORDERED)this.scrollToPosition(this.scrollContainer.scrollHeight-hc-gc+ic);}.bind(this));this.lastMessageIndicator.setProps({lastMessage:jc.length>0?jc[jc.length-1]:null});if(ec.eventType==ja.MESSAGES_RECEIVED&&this._shouldShowStickerReplyNUX(jc)&&this.tabView&&this.tabView.isFocused())this.tabView.showStickerReplyNUX();}.bind(this)));},scrolling:function(){this._checkToAnimateSticker();if(o.get('chat_react_user_messages')){if(this.isScrolledNearTop()&&!this._loadingMoreMessages&&!this.isScrolledToBottom()&&!this.tabView._isDragDropActive)if(this._store.fetchMoreMessages()){s.show(this.loadingIcon);this._loadingMoreMessages=true;}}else if(!this._loadingMoreMessages&&this.isScrolledNearTop()&&!this.isScrolledToBottom()&&!this._hasReachedClearedMessages&&!this.tabView._isDragDropActive)this.loadMoreMessages();if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},getScrollTop:function(){return this.scrollContainer&&this.scrollContainer.scrollTop;},destroy:function(){u.scry(this.conversationElem,'.stickerContainer').forEach(function(ec){return ma.unmountComponentAtNode(ec);});ma.unmountComponentAtNode(this.conversationElem);u.empty(this.conversationElem);this._subscriptions&&this._subscriptions.release();hb(bc,this);ma.unmountComponentAtNode(this.lastMessageIndicatorNode);delete this.lastMessageIndicator;if(o.get('chat_react_user_messages'))this._store&&this._store.destroy();this.destroyed=true;},_appendMessage:function(ec){if(ec==this.prevMessage)return;if(ec.is_cleared){this._hasReachedClearedMessages=true;return;}this._appendDateBreak(ec);if(ec.action_type===z.LOG_MESSAGE){this._appendLogMessage(ec);}else this._appendUserMessageXHP(ec);this.prevMessage=ec;},_appendUserMessageXHP:function(ec){var fc=ga.GROUPING_THRESHOLD,gc=this._renderMessageWithStatus(ec);if(!this.messageGroup||ec.author!==la.user||this.prevMessage.author!=ec.author||this.prevMessage.timestamp<ec.timestamp-fc){this.messageGroup=xb(ec);u.appendContent(this.conversationElem,this.messageGroup.getRoot());}u.appendContent(this.messageGroup.getNode('messages'),gc);yb(gc,this.scrollContainer);},_appendDateBreak:function(ec){if(ec.action_type===z.LOG_MESSAGE&&ec.log_message_type===da.SERVER_ERROR)return;var fc=this.prevMessage!==null?ec.timestamp-this.prevMessage.timestamp:Infinity;if(fc>=sb){var gc=new Date(ec.timestamp),hc=u.create('div',{className:"_5xjf"});ma.renderComponent(ma.createElement(q,{date:gc}),hc);u.appendContent(this.conversationElem,hc);this.messageGroup=null;}},_appendLogMessage:function(ec){var fc=u.create('div',{className:"_5ye9"}),gc=ma.createElement(fa,{message:new w(ec)}),hc=ma.createElement(ca,{className:"_5w0o",message:new w(ec),onCallLinkClick:function(ic,jc,kc){cc.inform('video-call-clicked',{userID:ic,threadID:jc,clickSource:kc});}});if(ba.hasErrorStatus(ec))hc=ma.createElement(ma.DOM.div,{className:"clearfix _542q"},ma.createElement(ma.DOM.div,{className:"_5pi7"},hc),ma.createElement(ma.DOM.div,{className:"_5pi6"},gc));ma.renderComponent(hc,fc);u.appendContent(this.conversationElem,fc);this.messageGroup=null;},rerender:function(){if(!this._oldestMessageDisplayedTimestamp)return;var ec=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollHeight,fc=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollTop,gc=this.isScrolledToBottom();u.empty(this.conversationElem);this.messageElements={};this.messageGroup=null;this.prevMessage=null;var hc=lb.getThreadMessagesSinceTimestamp(this.threadID,this._oldestMessageDisplayedTimestamp);this._renderOlderMessages(hc,ec,fc,gc);this._finishedFetchingMoreMessages=false;},update:function(ec){for(var fc in ec){var gc=this.messageElements[fc];if(gc){var hc=this.isScrolledToBottom(),ic=lb.getMessagesFromIDs([fc])[0],jc=this._renderMessageWithStatus(ic);u.replace(gc,jc);yb(jc,this.scrollContainer);if(hc)this.scrollToBottom();}}if(this.scrollContainer.scrollTop===0)this._checkToAnimateSticker();},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},_appendMessages:function(ec){var fc=this.scrollContainer.style.overflowY;ta.set(this.scrollContainer,'overflow-y','scroll');ec.forEach(this._appendMessage.bind(this));this.lastMessageIndicator&&this.lastMessageIndicator.setLastMessage(this.prevMessage);ta.set(this.scrollContainer,'overflow-y',fc);},_appendNewMessages:function(ec){var fc=this.isScrolledToBottom(),gc=this._messagesOnlySentFromSelf(ec);this._appendMessages(ec);if(fc){this.scrollToBottom();}else if(!gc){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}if(this._shouldShowStickerReplyNUX(ec)&&this.tabView&&this.tabView.isFocused())this.tabView.showStickerReplyNUX();},_messagesOnlySentFromSelf:function(ec){for(var fc=0;fc<ec.length;fc++)if(ec[fc].author!==la.user)return false;return true;},_shouldShowStickerReplyNUX:function(ec){if(!ra.shouldShowStickerReplyNUX()||!ec.length)return false;var fc=ec[ec.length-1];if(fc.author===la.user)return false;if(fc.has_attachment)return fc.attachments.some(function(gc){return gc.attach_type==='sticker';});return false;},_renderOlderMessages:function(ec,fc,gc,hc){if(!ec)return;this._appendMessages(ec);if(hc){this.scrollToBottom();}else if(this._finishedFetchingMoreMessages)this.scrollToPosition(this.scrollContainer.scrollHeight-fc-this.loadingHeight+gc);},_updateTimestamp:function(ec){if(ec&&ec.length){this._oldestMessageDisplayedTimestamp=ec[0].timestamp;this._currentMessageCount=ec.length;}this._loadingMoreMessages=false;this._finishedFetchingMoreMessages=true;s.hide(this.loadingIcon);},isScrolledToBottom:function(ec){var fc=this.scrollContainer;ec=ec||vb;return fc.scrollTop+fc.clientHeight>=fc.scrollHeight-ec;},isScrolledNearTop:function(){return this.scrollContainer.scrollTop<this.scrollContainer.clientHeight;},scrollToBottom:function(ec){this.scrollToPosition(this.scrollContainer.scrollHeight,ec);},scrollToPosition:function(ec,fc){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(fc===true){this._scrollTopAnimation=(new g(this.scrollContainer)).to('scrollTop',ec).ease(g.ease.end).duration(400).go();}else this.scrollContainer.scrollTop=ec;},loadMoreMessages:function(){if(lb.hasLoadedExactlyNMessages(this.threadID,this._currentMessageCount)&&lb.hasLoadedAllMessages(this.threadID))return;if(ob.isNewEmptyLocalThread(this.threadID))return;s.show(this.loadingIcon);this.loadingHeight=this._getLoadingHeight();this._loadingMoreMessages=true;if(this._fetchMultiplier<10)this._fetchMultiplier+=1;var ec=ga.RECENT_MESSAGES_LIMIT*this._fetchMultiplier,fc=this._currentMessageCount+ec,gc=lb.hasLoadedNMessages(this.threadID,fc);lb.getThreadMessagesRange(this.threadID,0,fc,this._updateTimestamp.bind(this),null,aa.CHAT);if(gc)this.rerender();},_renderMessageWithStatus:function(ec){var fc=this._makeSingleMessage(ec),gc=ma.createElement(fa,{message:new w(ec)});if(ba.hasErrorStatus(ec)){var hc=va[':fb:chat:conversation:message:status'].build();s.addClass(hc.getRoot(),"_542q");u.appendContent(hc.getNode('message'),fc);ma.renderComponent(gc,hc.getNode('status'));fc=hc.getRoot();}this.messageElements[ec.message_id]=fc;return fc;},_makeSingleMessage:function(ec){var fc=this._renderSingleMessage(ec);s.addClass(fc,"_55r0");return fc;},_renderSingleMessage:function(ec){var fc=va[':fb:chat:conversation:message'].render();fc.setAttribute('title',wb(ec.timestamp));if(ec.subject){var gc=va[':fb:chat:conversation:message:subject'].render();u.setContent(gc,ec.subject);u.appendContent(fc,gc);}function hc(oc){return u.create('span',{'data-measureme':1},oc);}if(ec.is_filtered_content){var ic=pa[':fb:mercury:filtered-message'].build();u.appendContent(fc,hc(ic.getRoot()));return fc;}var jc=ec.body||'';if(n.shouldHideBody(ec))jc='';if(jc.substr(0,4)=='?OTR'){u.setContent(fc,hc("[encrypted message]"));s.addClass(fc,"_542c");}else{s.addClass(fc,gb(jc)?'direction_rtl':'direction_ltr');var kc=ia.formatMessageBody(jc);u.appendContent(fc,hc(kc));}if(ec.has_attachment){var lc=u.create('div'),mc=this._appendMessageAttachments(lc,ec);if(!ec.body&&!mc)return lc;u.appendContent(fc,ab(lc.childNodes));}if(ec.forward_count)u.appendContent(fc,ac(ec));if(ec.is_spoof_warning){var nc=u.create('div',{className:"_5wdb"});ma.renderComponent(ma.createElement(oa,{authorID:ec.author}),nc);return u.create('div',null,[u.create('div',null,fc),nc]);}return fc;},_appendMessageAttachments:function(ec,fc){var gc=0,hc=fc.attachments;hc.sort(k.booleanLexicographicComparator([k.isPhotoAttachment,k.isShareAttachment,k.isFileAttachment,k.isErrorAttachment]));if(fc.raw_attachments&&fc.raw_attachments.length>0)hc=j.convertRaw(fc.raw_attachments);if(fc.attachments.length===0&&fc.preview_attachments&&fc.preview_attachments.length>0)db(hc,fc.preview_attachments);var ic=k.renderPhotoAttachments(hc.filter(k.isPhotoAttachment),fc,176,4);if(ic)u.appendContent(ec,u.create('div',{className:"_55pl"},ic));for(var jc=0;jc<hc.length;jc++){if(k.isPhotoAttachment(hc[jc])){gc=1;continue;}var kc=k.renderAttachment(true,hc[jc],fc,null,null,this._onStickerClick.bind(this));kc.error&&u.appendContent(ec,kc.error);kc.content&&u.appendContent(ec,kc.content);gc|=kc.bubblePreferred;}var lc=u.scry(ec,'img');lc.forEach(function(mc){this._subscriptions.addSubscriptions(v.listen(mc,'load',ib(this._thumbLoaded,this,mc)));}.bind(this));return !!gc;},_onStickerClick:function(ec,fc){if(!ec)return;l.log('StickersLoggerConfig',{event:'click_sticker',packid:ec,stickerid:fc});var gc=this.tabView;ra.onTrayDataReady(function(){if(ya(ra.getPackIDsInTray(),ec)){var hc=ra.getPack(ec);if(hc&&hc.isPromoted)qa.addPack(ec);gc.setStickersFlyoutPackID(ec);}else sa.showStore(ec);});},_thumbLoaded:function(ec){var fc=this.scrollContainer.scrollTop+this.scrollContainer.clientHeight;if(fc+ec.offsetHeight>=this.scrollContainer.scrollHeight)this.scrollToBottom();},_checkToAnimateSticker:function(){var ec=fb(this.scrollContainer);h.inform('chatScrolled/'+this.threadID,{scrollTop:this.scrollContainer.scrollTop,top:ec.y,viewHeight:ec.height});},setNewThreadID:function(ec){if(o.get('chat_react_user_messages')){this._store.setNewThreadID(ec);}else this._newThreadID=ec;}});if(!o.get('chat_react_user_messages')){pb.subscribe('messages-reordered',function(ec,fc){bc.forEach(function(gc){fc[gc.threadID]&&gc.rerender();});});pb.subscribe('messages-updated',function(ec,fc){bc.forEach(function(gc){fc[gc.threadID]&&gc.update(fc[gc.threadID]);});});pb.subscribe('messages-received',function(ec,fc){bc.forEach(function(gc){var hc=fc[gc.threadID];if(hc&&hc.length){gc._currentMessageCount+=hc.length;gc._appendNewMessages(hc);}if(gc._newThreadID){var ic=fc[gc._newThreadID];if(ic&&ic.length){gc._currentMessageCount+=ic.length;gc._appendNewMessages(ic);gc._newThreadID=null;}}});});h.subscribe(m.getArbiterType('chat_event'),function(ec,fc){if(dc(fc.obj)){var gc=(t.getID()==fc.obj.from)?fc.obj.to:fc.obj.from,hc=ob.getThreadIdForUser(gc),ic=bc.filter(function(lc){return lc.threadID===hc;});if(ic.length>0){var jc=ic[0],kc=lb.constructLogMessageObject(ea.CHAT_WEB,hc,da.VIDEO_CALL,fc.obj);kc.author='fbid:'+fc.obj.from;jc._appendNewMessages([kc]);}}});}function dc(ec){return (ec.event_name==='installing'||ec.event_name==='install_canceled');}e.exports=cc;},null);
__d("ChatAddFriendsTabSheetRawRenderer",["ContextualTypeaheadView","DOM","Event","MercuryTypeahead","ChatTabTemplates","fbt","tx","MercuryDataSourceWrapper"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=b('MercuryDataSourceWrapper').source,o={render:function(p,q,r,s,t,u){var v=u?k[':fb:mercury:chat:tab-sheet:add-friends-empty-tab'].build():k[':fb:mercury:chat:tab-sheet:add-friends'].build(),w=new j(n,g);w.setExcludedParticipantsFromThreadMeta(s);if(!u)w.setPlaceholder("Add friends to this chat");w.build();h.replace(v.getNode('participantsTypeahead'),w.getElement());h.setContent(r,v.getRoot());w.getTokenizer().adjustWidth();var x=v.getNode('participantsTypeahead').getAttribute('data-labelid'),y=h.scry(w.getElement(),'input[type="text"]')[0];if(y)if(x){y.setAttribute('aria-labelledby',x);}else y.setAttribute('aria-label',"To");w.focus();if(!u){var z=function(){var aa=w.getSelectedParticipantIDs();if(aa.length)t(aa);q.close(p);};i.listen(v.getNode('doneButton'),'click',z);w.subscribe('tokens-return',function(){if(w.getTokens().length)z();});}return w;}};e.exports=o;},null);
__d("MultiChatController",["AsyncSignal","ChatOpenTab","copyProperties","Form","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j){var k=b('MercuryMessages').get(),l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get();function n(){}i(n,{subscribe:function(o,p){o.subscribe('confirm',function(){this.createGroupThreadFromChooserDialog(o,p);}.bind(this));},createGroupThreadFromChooserDialog:function(o,p){var q=j.serialize(o.getRoot()),r=JSON.parse(q.profileChooserItems),s=[];for(var t in r)if(r[t])s.push(t);var u=n.createThreadForFBIDs(s);l.subscribe('update-thread-ids',function(v,w){for(var x in w)if(w[x]==u)new g('/ajax/groups/chat/log',{group_id:p,message_id:x}).send();});o.hide();},createThreadForTokens:function(o){if(!o.length)return;var p;if(o.length==1){p='user:'+o[0].split(':')[1];}else p='root:'+k.generateNewClientMessageID(Date.now());m.createNewLocalThread(p,o);h.openThread(p,'MultiChatController');},createThreadForFBIDs:function(o){var p=[];for(var q=0;q<o.length;q++)p.push("fbid:"+o[q]);return n.createThreadForTokens(p);}});e.exports=n;},null);
__d("ChatAddFriendsTabSheet",["ArbiterMixin","ChatAddFriendsTabSheetRawRenderer","ChatOpenTab","MercuryLogMessageType","MercurySourceType","MultiChatController","Style","copyProperties","MercuryMessages","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=b('MercuryMessages').get(),p=b('MercuryThreads').get();function q(t,u,v){this._threadID=t;this._rootElement=u;this._sheetView=v;this._typeahead=null;}n(q.prototype,g,{render:function(){p.getThreadMeta(this._threadID,function(t){var u=t.is_canonical_user?r:s;this._typeahead=h.render(this,this._sheetView,this._rootElement,t,u.bind(null,t),p.isNewEmptyLocalThread(this._threadID));this._typeahead.subscribe('tokens-changed',function(){this.inform('chat/tokens-changed',{token_count:this._typeahead.getTokens().length});}.bind(this));this._typeahead.subscribe('resize',function(){this._sheetView.resize();}.bind(this));}.bind(this));},getParticipants:function(){if(!this._typeahead)return null;return this._typeahead.getSelectedParticipantIDs();},isPermanent:function(){return true;},isSheetWithInput:function(){return true;},getType:function(){return 'add_friends_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);},getHeight:function(){return m.get(this._rootElement,'height');}});function r(t,u){var v=t.participants;l.createThreadForTokens(v.concat(u));}function s(t,u){var v=t.thread_id;if(p.isEmptyLocalThread(v)){p.addParticipantsToThreadLocally(v,u);}else o.sendMessage(o.constructLogMessageObject(k.CHAT_WEB,v,j.SUBSCRIBE,{added_participants:u}));i.openThread(v,'ChatAddFriendsTabSheet');}e.exports=q;},null);
__d("ChatNameConversationTabSheetRawRenderer",["DOM","Event","Input","Keys","ChatTabTemplates","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m={render:function(n,o,p,q,r,s){var t=k[':fb:mercury:chat:tab-sheet:name-conversation'].build(),u=t.getNode('nameInput'),v=t.getNode('doneButton'),w="Done",x="Hide",y=q.name;if(y){i.setValue(u,y);}else g.setContent(v,x);var z=function(){var aa=i.getValue(u);if(aa)r(aa);s();o.close(n);};h.listen(u,'input',function(){g.setContent(v,i.getValue(u).length===0?x:w);});h.listen(v,'click',z);h.listen(u,'keyup',function(aa){if(aa.keyCode===j.RETURN){z();return false;}});g.setContent(p,t.getRoot());!n.isAutomatic()&&u.focus();}};e.exports=m;},null);
__d("ChatNameConversationTabSheet",["AsyncRequest","ChatNameConversationTabSheetRawRenderer","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryMessages').get(),m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get(),o='/ajax/chat/multichat/name_conversation/dismiss.php',p={};function q(r,s,t){"use strict";this.$ChatNameConversationTabSheet0=r;this.$ChatNameConversationTabSheet1=s;this.$ChatNameConversationTabSheet2=t;this.$ChatNameConversationTabSheet3=false;}q.prototype.render=function(){"use strict";n.getThreadMeta(this.$ChatNameConversationTabSheet0,function(r){h.render(this,this.$ChatNameConversationTabSheet2,this.$ChatNameConversationTabSheet1,r,this.$ChatNameConversationTabSheet4.bind(null,r),this.$ChatNameConversationTabSheet5.bind(this,r));this.$ChatNameConversationTabSheet2.resize();}.bind(this));};q.prototype.isPermanent=function(){"use strict";return true;};q.prototype.isSheetWithInput=function(){"use strict";return true;};q.prototype.getType=function(){"use strict";return 'name_conversation_type';};q.prototype.open=function(r){"use strict";this.$ChatNameConversationTabSheet3=r;if(!(this.$ChatNameConversationTabSheet3&&this.$ChatNameConversationTabSheet6()))this.$ChatNameConversationTabSheet2.open(this);};q.prototype.close=function(){"use strict";this.$ChatNameConversationTabSheet2.close(this);};q.prototype.isAutomatic=function(){"use strict";return this.$ChatNameConversationTabSheet3;};q.prototype.$ChatNameConversationTabSheet6=function(){"use strict";return !!p[this.$ChatNameConversationTabSheet0];};q.prototype.$ChatNameConversationTabSheet7=function(){"use strict";p[this.$ChatNameConversationTabSheet0]=true;};q.prototype.$ChatNameConversationTabSheet5=function(r){"use strict";if(!r.name_conversation_sheet_dismissed||!this.$ChatNameConversationTabSheet6()){this.$ChatNameConversationTabSheet7();m.getServerThreadID(r.thread_id,function(s){new g(o).setData({thread_id:s}).send();});}};q.prototype.$ChatNameConversationTabSheet4=function(r,s){"use strict";var t=r.name;if((s||t)&&(s!=t))l.sendMessage(l.constructLogMessageObject(k.CHAT_WEB,r.thread_id,j.THREAD_NAME,{name:s}),null,i.CHAT);};e.exports=q;},null);
__d("ChatNewMessagesTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m,n,o){this._threadID=m;this._rootElement=n;this._sheetView=o;}k(l.prototype,h,{render:function(){var m=j[':fb:mercury:chat:tab-sheet:clickable-message-icon-sheet'].build();i.setContent(m.getNode('text'),i.tx._("Scroll down to see new messages."));i.setContent(this._rootElement,m.getRoot());g.listen(m.getRoot(),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return true;},isSheetWithInput:function(){return true;},getType:function(){return 'new_messages_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=l;},null);
__d("ChatNoRecipientsTabSheet",["DOM","fbt","MercuryParticipants","ChatTabTemplates","copyProperties","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryThreadInformer').get(),m=b('MercuryThreads').get();function n(o,p,q){this._threadID=o;this._rootElement=p;this._sheetView=q;l.subscribe('threads-updated',this._handleThreadsUpdated.bind(this));}k(n.prototype,{render:function(){var o=j[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(o.getNode('text'),"Everyone has left the conversation.");g.setContent(this._rootElement,o.getRoot());},isPermanent:function(){return true;},getType:function(){return 'no_recipients_type';},_handleThreadsUpdated:function(){m.getThreadMeta(this._threadID,function(o){var p=i.user,q=o.participants.filter(function(r){return r!=p;});if(q.length<1&&!m.isNewEmptyLocalThread(this._threadID)){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));}});e.exports=n;},null);
__d("ChatOfflineTabSheet",["ChatPrivacyActionController","ChatVisibility","CSS","DOM","Event","JSLogger","MercuryParticipants","ChatTabTemplates","copyProperties","cx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=b('MercuryThreads').get();function r(s,t,u){this._rootElement=t;this._sheetView=u;this._logger=l.create('blackbird');this._canonicalUser=q.getCanonicalUserInThread(s);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}o(r.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('offline_sheet_open_with_non_friend');return;}var s=n[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build(),t='fbid:'+this._canonicalUser;m.get(t,function(u){var v='fbChatGoOnlineLink',w=j.tx._("turn on chat"),x=j.create('a',{href:'#',className:v},w),y=j.tx._("To chat with {name} and other friends, {link}.",{name:u.short_name,link:x});j.setContent(s.getNode('text'),y);i.addClass(s.getRoot(),"_1sk1");j.setContent(this._rootElement,s.getRoot());k.listen(this._rootElement,'click',function(event){if(i.hasClass(event.getTarget(),v)){if(h.isOnline())this._logger.error('tab_sheet_already_online');this._privacyActionController.togglePrivacy();this._logger.log('tab_sheet_go_online',{tab_id:this._canonicalUser});return false;}}.bind(this));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(s){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(s){case g.OFFLINE:this._sheetView.open(this);break;case g.NORMAL:case g.BLOCKED:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'offline_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=r;},null);
__d("ChatUploadWarningTabSheet",["DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f,g,h,i){function j(k,l,m){this._threadID=k;this._rootElement=l;this._sheetView=m;}i(j.prototype,{render:function(){var k=h[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(k.getNode('text'),g.tx._("Please wait until the upload is complete before you send your message."));g.setContent(this._rootElement,k.getRoot());},isPermanent:function(){return false;},getType:function(){return 'upload_warning_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=j;},null);
__d("ChatReadOnlyTabSheet",["React","MercuryReadOnlyReason","cx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){var j=b('MercuryThreads').get();function k(l,m,n){"use strict";this.$ChatReadOnlyTabSheet0=l;this.$ChatReadOnlyTabSheet1=m;this.$ChatReadOnlyTabSheet2=n;}k.prototype.render=function(){"use strict";var l=h.getReason(j.getThreadMetaNow(this.$ChatReadOnlyTabSheet0));g.renderComponent(g.createElement(g.DOM.div,{className:"_87-"},l),this.$ChatReadOnlyTabSheet1);};k.prototype.isPermanent=function(){"use strict";return false;};k.prototype.getType=function(){"use strict";return 'chat-thread-is-read-only';};k.prototype.open=function(){"use strict";this.$ChatReadOnlyTabSheet2.open(this);};k.prototype.close=function(){"use strict";this.$ChatReadOnlyTabSheet2.open(this);};e.exports=k;},null);
__d("ChatReadOnlyEarlyWarningTabSheet",["React","MercuryReadOnlyReason","cx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){var j=b('MercuryThreads').get();function k(l,m,n){"use strict";this.$ChatReadOnlyEarlyWarningTabSheet0=l;this.$ChatReadOnlyEarlyWarningTabSheet1=m;this.$ChatReadOnlyEarlyWarningTabSheet2=n;}k.prototype.render=function(){"use strict";var l=h.getEarlyWarning(j.getThreadMetaNow(this.$ChatReadOnlyEarlyWarningTabSheet0));g.renderComponent(g.createElement(g.DOM.div,{className:"_87-"},l),this.$ChatReadOnlyEarlyWarningTabSheet1);};k.prototype.isPermanent=function(){"use strict";return false;};k.prototype.getCloseTimeout=function(){"use strict";return 20000;};k.prototype.getType=function(){"use strict";return 'chat-thread-is-read-only-early-warning';};k.prototype.open=function(){"use strict";this.$ChatReadOnlyEarlyWarningTabSheet2.open(this);};k.prototype.close=function(){"use strict";this.$ChatReadOnlyEarlyWarningTabSheet2.open(this);};e.exports=k;},null);
__d("ChatThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m,n,o){this._threadID=m;this._rootElement=n;this._sheetView=o;}k(l.prototype,h,{render:function(){var m=j[':fb:mercury:chat:tab-sheet:message-mute-sheet'].build();i.setContent(m.getNode('text'),i.tx._("This conversation is muted. Chat tabs will not pop up for it and push notifications are off."));i.setContent(this._rootElement,m.getRoot());g.listen(m.getNode('unmuteButton'),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return false;},getType:function(){return 'chat-thread-is-muted';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=l;},null);
__d("ChatUserBlockedTabSheet",["CSS","ChatPrivacyActionController","DOM","Event","GenderConst","JSLogger","MercuryParticipants","ChatTabTemplates","copyProperties","cx","tx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=b('MercuryThreads').get();function s(t,u,v){this._rootElement=u;this._sheetView=v;this._logger=l.create('blackbird');this._canonicalUser=r.getCanonicalUserInThread(t);if(this._canonicalUser)this._privacyActionController=new h(this._canonicalUser,this._handlePrivacyChange.bind(this));}o(s.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('user_blocked_sheet_open_with_non_friend');return;}var t=n[':fb:mercury:chat:tab-sheet:user-blocked'].build(),u='fbid:'+this._canonicalUser;m.get(u,function(v){var w=null;switch(v.gender){case k.FEMALE_SINGULAR:case k.FEMALE_SINGULAR_GUESS:w=q._("You turned off chat for {name} but you can still send her a message. ",{name:v.short_name});break;case k.MALE_SINGULAR:case k.MALE_SINGULAR_GUESS:w=q._("You turned off chat for {name} but you can still send him a message. ",{name:v.short_name});break;default:w=q._("You turned off chat for {name} but you can still send them a message. ",{name:v.short_name});}i.setContent(t.getNode('text'),w);var x=q._("Turn on chat for {name}?",{name:v.short_name});i.setContent(t.getNode('actionLink'),x);g.addClass(t.getRoot(),"_1sk0");i.setContent(this._rootElement,t.getRoot());j.listen(t.getNode('actionLink'),'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(t){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');if(t==h.BLOCKED){var u='fbid:'+this._canonicalUser;m.get(u,function(v){if(v.is_friend){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));return;}this._sheetView.close(this);},isPermanent:function(){return true;},getType:function(){return 'user_blocked_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=s;},null);
__d("ChatTabSheetController",["ChatAddFriendsTabSheet","ChatNameConversationTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatUploadWarningTabSheet","ChatReadOnlyTabSheet","ChatReadOnlyEarlyWarningTabSheet","ChatThreadIsMutedTabSheet","ChatUserBlockedTabSheet","copyProperties","MercurySheetView","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=b('MercuryThreads').get(),t=function(u,v,w){this._sheetView=new r(u,v,w);this._addFriendsTabSheet=new g(u,v,this._sheetView);this._nameConversationTabSheet=new h(u,v,this._sheetView);this._userBlockedTabSheet=new p(u,v,this._sheetView);this._offlineTabSheet=new k(u,v,this._sheetView);this._newMessagesTabSheet=new i(u,v,this._sheetView);this._uploadWarningTabSheet=new l(u,v,this._sheetView);this._threadIsMutedTabSheet=new o(u,v,this._sheetView);this._readOnlyTabSheet=new m(u,v,this._sheetView);this._readOnlyEarlyWarningTabSheet=new n(u,v,this._sheetView);if(!s.getCanonicalUserInThread(u))this._noRecipientsTabSheet=new j(u,v,this._sheetView);};q(t.prototype,{openAddFriendsSheet:function(){this._addFriendsTabSheet.open();},getAddFriendsTabSheet:function(){return this._addFriendsTabSheet;},getAddFriendsParticipants:function(){var u=this._addFriendsTabSheet.getParticipants();this._addFriendsTabSheet.close();return u;},openNameConversationSheet:function(u){this._nameConversationTabSheet.open(u);},openReadOnlySheet:function(){this._readOnlyTabSheet.open();},openReadOnlyEarlyWarningSheet:function(){this._readOnlyEarlyWarningTabSheet.open();},openNewMessagesSheet:function(){this._newMessagesTabSheet.open();},openUploadWarningTabSheet:function(){this._uploadWarningTabSheet.open();},openThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.open();},closeAutomaticNameConversationSheet:function(){if(this._nameConversationTabSheet.isAutomatic())this._nameConversationTabSheet.close();},closeThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.close();},closeNewMessagesSheet:function(){this._newMessagesTabSheet.close();},closeUploadWarningTabSheet:function(){this._uploadWarningTabSheet.close();},onClickNewMessagesSheet:function(u){this._newMessageClickSub=this._newMessagesTabSheet.subscribe('clicked',u);},onClickThreadIsMutedSheet:function(u){this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',u);},onResize:function(u){this._sheetView.subscribe('resize',u);},onTokensChanged:function(u){this._addFriendsTabSheet.subscribe('chat/tokens-changed',u);},destroy:function(){this._sheetView&&this._sheetView.destroy();this._offlineTabSheet&&this._offlineTabSheet.destroy();this._userBlockedTabSheet&&this._userBlockedTabSheet.destroy();this._newMessageClickSub&&this._newMessageClickSub.unsubscribe();this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();}});e.exports=t;},null);
__d("EmoticonUtils",["EmoticonsList","Parent","endsWith","startsWith"],function(a,b,c,d,e,f,g,h,i,j){var k='emoticon_',l=g.symbols,m={getEmoteFromTarget:function(n){var o=h.byClass(n,'emoticon');if(!o)return null;var p=null;o.className.split(' ').forEach(function(q){if(j(q,k))p=q.substring(k.length);});return l[p]||null;},insertEmoticon:function(n,o,p){var q=o.substring(0,p.start),r=o.substring(p.end);if(p.start>0&&!i(q,' '))n=' '+n;if(!j(r,' '))n+=' ';var s=q+n+r;p.start+=n.length;p.end=p.start;return {result:s,start:p.start,end:p.end};}};e.exports=m;},null);
__d("SelectionPosition",["Event","InputSelection","SubscriptionsHandler","merge"],function(a,b,c,d,e,f,g,h,i,j){function k(l){"use strict";this.$SelectionPosition0=l;this.$SelectionPosition1={start:0,end:0};this.$SelectionPosition2=new i();this.$SelectionPosition3=false;this.updatePos();this.enable();}k.prototype.getPos=function(){"use strict";return j(this.$SelectionPosition1);};k.prototype.setPos=function(l,m){"use strict";this.$SelectionPosition1={start:l,end:m};this.restore();};k.prototype.updatePos=function(){"use strict";this.$SelectionPosition1=h.get(this.$SelectionPosition0);};k.prototype.restore=function(){"use strict";h.set(this.$SelectionPosition0,this.$SelectionPosition1.start,this.$SelectionPosition1.end);};k.prototype.enable=function(){"use strict";if(!this.$SelectionPosition3){this.$SelectionPosition2.addSubscriptions(g.listen(this.$SelectionPosition0,'keyup',this.updatePos.bind(this)),g.listen(this.$SelectionPosition0,'click',this.updatePos.bind(this)));this.$SelectionPosition3=true;}};k.prototype.disable=function(){"use strict";if(this.$SelectionPosition3){this.$SelectionPosition2.release();this.$SelectionPosition3=false;}};e.exports=k;},null);
__d("StickerSearchNUX.react",["React","ReactLayeredComponentMixin","StickerServerRequests","XUIAmbientNUX.react","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){var l=g.createClass({displayName:'StickerSearchNUX',mixins:[h],getInitialState:function(){return {nuxShown:true};},componentDidMount:function(){i.markSeenSearchTooltipNUX();},hideNUX:function(){this.setState({nuxShown:false});},onCloseButtonClicked:function(){this.hideNUX();this.props.showIndicatorFunc();},renderLayers:function(){return {stickerSearchNUX:g.createElement(j,{ref:"NUX",contextRef:"container",shown:this.state.nuxShown,position:"above",width:"auto",onCloseButtonClick:this.onCloseButtonClicked},"Now you can search for stickers!")};},render:function(){return (g.createElement(g.DOM.span,{ref:"container"}));}});e.exports=l;},null);
__d("rebound",[],function(a,b,c,d,e,f){var g={},h=g.SpringSystem=function t(){this._springRegistry={};this._activeSprings=[];this._listeners=[];this._idleSpringIndices=[];this._boundFrameCallback=r(this._frameCallback,this);};s(h,{});s(h.prototype,{_springRegistry:null,_isIdle:true,_lastTimeMillis:-1,_activeSprings:null,_listeners:null,_idleSpringIndices:null,_frameCallback:function(){this.loop();},_frameCallbackId:null,createSpring:function(t,u){var v=new i(this);this.registerSpring(v);if(typeof t==='undefined'||typeof u==='undefined'){v.setSpringConfig(k.DEFAULT_ORIGAMI_SPRING_CONFIG);}else{var w=k.fromOrigamiTensionAndFriction(t,u);v.setSpringConfig(w);}return v;},getIsIdle:function(){return this._isIdle;},getSpringById:function(t){return this._springRegistry[t];},getAllSprings:function(){return Object.values(this._springRegistry);},registerSpring:function(t){this._springRegistry[t.getId()]=t;},deregisterSpring:function(t){m(this._activeSprings,t);delete this._springRegistry[t.getId()];},advance:function(t,u){while(this._idleSpringIndices.length>0)this._idleSpringIndices.pop();for(var v=0,w=this._activeSprings.length;v<w;v++){var x=this._activeSprings[v];if(x.systemShouldAdvance()){x.advance(t/1000,u/1000);}else this._idleSpringIndices.push(this._activeSprings.indexOf(x));}while(this._idleSpringIndices.length>0){var y=this._idleSpringIndices.pop();y>=0&&this._activeSprings.splice(y,1);}},loop:function(){var t,u=Date.now();if(this._lastTimeMillis===-1)this._lastTimeMillis=u-1;var v=u-this._lastTimeMillis;this._lastTimeMillis=u;var w=0,x=this._listeners.length;for(w=0;w<x;w++){t=this._listeners[w];t.onBeforeIntegrate&&t.onBeforeIntegrate(this);}this.advance(u,v);if(this._activeSprings.length===0){this._isIdle=true;this._lastTimeMillis=-1;}for(w=0;w<x;w++){t=this._listeners[w];t.onAfterIntegrate&&t.onAfterIntegrate(this);}n(this._frameCallbackId);if(!this._isIdle)this._frameCallbackId=o(this._boundFrameCallback);},activateSpring:function(t){var u=this._springRegistry[t];if(this._activeSprings.indexOf(u)==-1)this._activeSprings.push(u);if(this.getIsIdle()){this._isIdle=false;n(this._frameCallbackId);this._frameCallbackId=o(this._boundFrameCallback);}},addListener:function(t){this._listeners.push(t);},removeListener:function(t){m(this._listeners,t);},removeAllListeners:function(){this._listeners=[];}});var i=g.Spring=function t(u){this._id=t._ID++;this._springSystem=u;this._listeners=[];this._currentState=new j();this._previousState=new j();this._tempState=new j();};s(i,{_ID:0,MAX_DELTA_TIME_SEC:.064,SOLVER_TIMESTEP_SEC:.001});s(i.prototype,{_id:0,_springConfig:null,_overshootClampingEnabled:false,_currentState:null,_previousState:null,_tempState:null,_startValue:0,_endValue:0,_wasAtRest:true,_restSpeedThreshold:.001,_displacementFromRestThreshold:.001,_listeners:null,_timeAccumulator:0,_springSystem:null,destroy:function(){this._listeners=[];this._springSystem.deregisterSpring(this);},getId:function(){return this._id;},setSpringConfig:function(t){this._springConfig=t;return this;},getSpringConfig:function(){return this._springConfig;},setCurrentValue:function(t){this._startValue=t;this._currentState.position=t;for(var u=0,v=this._listeners.length;u<v;u++){var w=this._listeners[u];w.onSpringUpdate&&w.onSpringUpdate(this);}return this;},getStartValue:function(){return this._startValue;},getCurrentValue:function(){return this._currentState.position;},getCurrentDisplacementDistance:function(){return this.getDisplacementDistanceForState(this._currentState);},getDisplacementDistanceForState:function(t){return Math.abs(this._endValue-t.position);},setEndValue:function(t){if(this._endValue==t&&this.isAtRest())return this;this._startValue=this.getCurrentValue();this._endValue=t;this._springSystem.activateSpring(this.getId());for(var u=0,v=this._listeners.length;u<v;u++){var w=this._listeners[u];w.onSpringEndStateChange&&w.onSpringEndStateChange(this);}return this;},getEndValue:function(){return this._endValue;},setVelocity:function(t){this._currentState.velocity=t;return this;},getVelocity:function(){return this._currentState.velocity;},setRestSpeedThreshold:function(t){this._restSpeedThreshold=t;return this;},getRestSpeedThreshold:function(){return this._restSpeedThreshold;},setRestDisplacementThreshold:function(t){this._displacementFromRestThreshold=t;},getRestDisplacementThreshold:function(){return this._displacementFromRestThreshold;},setOvershootClampingEnabled:function(t){this._overshootClampingEnabled=t;return this;},isOvershootClampingEnabled:function(){return this._overshootClampingEnabled;},isOvershooting:function(){return (this._startValue<this._endValue&&this.getCurrentValue()>this._endValue)||(this._startValue>this._endValue&&this.getCurrentValue()<this._endValue);},advance:function(t,u){var v=this.isAtRest();if(v&&this._wasAtRest)return;var w=u;if(u>i.MAX_DELTA_TIME_SEC)w=i.MAX_DELTA_TIME_SEC;this._timeAccumulator+=w;var x=this._springConfig.tension,y=this._springConfig.friction,z=this._currentState.position,aa=this._currentState.velocity,ba=this._tempState.position,ca=this._tempState.velocity,da,ea,fa,ga,ha,ia,ja,ka,la,ma;while(this._timeAccumulator>=i.SOLVER_TIMESTEP_SEC){this._timeAccumulator-=i.SOLVER_TIMESTEP_SEC;if(this._timeAccumulator<i.SOLVER_TIMESTEP_SEC){this._previousState.position=z;this._previousState.velocity=aa;}da=aa;ea=(x*(this._endValue-ba))-y*aa;ba=z+da*i.SOLVER_TIMESTEP_SEC*.5;ca=aa+ea*i.SOLVER_TIMESTEP_SEC*.5;fa=ca;ga=(x*(this._endValue-ba))-y*ca;ba=z+fa*i.SOLVER_TIMESTEP_SEC*.5;ca=aa+ga*i.SOLVER_TIMESTEP_SEC*.5;ha=ca;ia=(x*(this._endValue-ba))-y*ca;ba=z+ha*i.SOLVER_TIMESTEP_SEC*.5;ca=aa+ia*i.SOLVER_TIMESTEP_SEC*.5;ja=ca;ka=(x*(this._endValue-ba))-y*ca;la=1/6*(da+2*(fa+ha)+ja);ma=1/6*(ea+2*(ga+ia)+ka);z+=la*i.SOLVER_TIMESTEP_SEC;aa+=ma*i.SOLVER_TIMESTEP_SEC;}this._tempState.position=ba;this._tempState.velocity=ca;this._currentState.position=z;this._currentState.velocity=aa;if(this._timeAccumulator>0)this.interpolate(this._timeAccumulator/i.SOLVER_TIMESTEP_SEC);if(this.isAtRest()||this._overshootClampingEnabled&&this.isOvershooting()){this._startValue=this._endValue;this._currentState.position=this._endValue;this.setVelocity(0);v=true;}var na=false;if(this._wasAtRest){this._wasAtRest=false;na=true;}var oa=false;if(v){this._wasAtRest=true;oa=true;}for(var pa=0,qa=this._listeners.length;pa<qa;pa++){var ra=this._listeners[pa];if(na)ra.onSpringActivate&&ra.onSpringActivate(this);ra.onSpringUpdate&&ra.onSpringUpdate(this);if(oa)ra.onSpringAtRest&&ra.onSpringAtRest(this);}},systemShouldAdvance:function(){return !this.isAtRest()||!this.wasAtRest();},wasAtRest:function(){return this._wasAtRest;},isAtRest:function(){return Math.abs(this._currentState.velocity)<this._restSpeedThreshold&&this.getDisplacementDistanceForState(this._currentState)<=this._displacementFromRestThreshold;},setAtRest:function(){this._endValue=this._currentState.position;this._tempState.position=this._currentState.position;this._currentState.velocity=0;return this;},interpolate:function(t){this._currentState.position=this._currentState.position*t+this._previousState.position*(1-t);this._currentState.velocity=this._currentState.velocity*t+this._previousState.velocity*(1-t);},addListener:function(t){this._listeners.push(t);return this;},removeListener:function(t){m(this._listeners,t);return this;},removeAllListeners:function(){this._listeners=[];return this;},currentValueIsApproximately:function(t){return Math.abs(this.getCurrentValue()-t)<=this.getRestDisplacementThreshold();}});var j=function t(){};s(j.prototype,{position:0,velocity:0});var k=g.SpringConfig=function t(u,v){this.tension=u;this.friction=v;},l={tensionFromOrigamiValue:function(t){return (t-30)*3.62+194;},origamiValueFromTension:function(t){return (t-194)/3.62+30;},frictionFromOrigamiValue:function(t){return (t-8)*3+25;},origamiFromFriction:function(t){return (t-25)/3+8;}};s(k,{fromOrigamiTensionAndFriction:function(t,u){return new k(l.tensionFromOrigamiValue(t),l.frictionFromOrigamiValue(u));}});k.DEFAULT_ORIGAMI_SPRING_CONFIG=k.fromOrigamiTensionAndFriction(40,7);s(k.prototype,{friction:0,tension:0});g.MathUtil={mapValueInRange:function(t,u,v,w,x){var y=v-u,z=x-w,aa=(t-u)/y;return w+(aa*z);}};function m(t,u){var v=t.indexOf(u);v!=-1&&t.splice(v,1);}function n(t){return typeof window!='undefined'&&window.cancelAnimationFrame&&window.cancelAnimationFrame(t);}function o(t){var u=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;return u(t);}var p=Array.prototype.concat,q=Array.prototype.slice;function r(t,u){var v=q.call(arguments,2);return function(){t.apply(u,p.call(v,q.call(arguments)));};}function s(t,u){for(var v in u)if(u.hasOwnProperty(v))t[v]=u[v];}e.exports=g;},null);
__d("StickerTriggerImage.react",["React","Image.react","rebound"],function(a,b,c,d,e,f,g,h,i){'use strict';var j=g.createClass({displayName:'StickerTriggerImage',propTypes:{stickers:g.PropTypes.array},getDefaultProps:function(){return {stickers:[]};},getInitialState:function(){return {index:0};},componentWillMount:function(){this._springSystem=new i.SpringSystem();this._spring=this._springSystem.createSpring(50,3);this._spring.addListener({onSpringUpdate:function(k){var l=k.getCurrentValue();l=i.MathUtil.mapValueInRange(l,0,1,1,.5);this._scale(this.getDOMNode(),l);}.bind(this)});this._spring.setEndValue(0);},componentDidMount:function(){this._stopIntervalID=setInterval(this.incrementIndex,3000);},componentWillUnmount:function(){clearInterval(this._stopIntervalID);this._spring.destroy();},componentWillUpdate:function(k,l){if(this.props.stickers.length===0&&k.stickers.length>=0){this._spring.setEndValue(1);setTimeout(function(){return this._spring.setEndValue(0);}.bind(this),100);}},_scale:function(k,l){if(k)k.style.mozTransform=k.style.msTransform=k.style.webkitTransform=k.style.transform='scale3d('+l+', '+l+', 1)';},incrementIndex:function(){var k=this.state.index;if(k<this.props.stickers.length-1){k++;}else k=0;this.setState({index:k});},render:function(){if(this.props.stickers.length===0)return null;return (g.createElement(h,{className:"stickerTriggerImage",src:this.props.stickers[this.state.index].triggerSourceURI}));}});e.exports=j;},null);
__d("XStickerReplyNUXControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/stickers\/tooltip\/",{});},null);
__d("ChatTabView",["Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AsyncSignal","AvailableListConstants","ChatBehavior","ChatConfig","ChatContextualDialogController","ChatFileUploader.react","ChatOpenTab","ChatPhotoEditorContextualDialog","ChatPhotoUploader.react","ChatPrivacyActionController","ChatQuietLinks","ChatShareLinkUploader","ChatStickerButton.react","ChatTabMenu.react","ChatTabMessagesView","ChatTabSheetController","ChatVisibility","MercuryConstants","ContentRollFlyout.react","CurrentUser","CSS","CurrentLocale","Dialog","Dock","DOM","DOMQuery","DragDropTarget","EmoticonsList","EmoticonUtils","Event","Focus","Input","Keys","Locale","MercuryConfig","MercuryIDs","MercuryFileUploader","MercuryLogMessageType","MercuryParticipants","MercurySourceType","MercuryThreadMetadataRawRenderer","MercuryThreadMuter","MercuryTypingReceiver","MessagesEmoticonView","NubController","Parent","PhotosUploadWaterfall","PresencePrivacy","PresenceStatus","React","Run","SelectionPosition","StickerActions","StickerConfig","StickerConstants","StickersFlyout.react","StickerState","StickerSearch","StickerSearchNUX.react","StickerTriggerImage.react","Style","SubscriptionsHandler","ChatTabTemplates","TextAreaControl","Toggler","Tooltip","TypingDetectorController","URI","UserAgent_DEPRECATED","VideoCallCore","WaterfallIDGenerator","XStickerReplyNUXControllerURIBuilder","copyProperties","cx","csx","fbt","getActiveElement","isEmpty","setIntervalAcrossTransitions","throttle","tx","OrionTrigger","MercuryMessages","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc){"use strict";var nc=b('OrionTrigger').module,oc=b('MercuryMessages').get(),pc=b('MercuryServerRequests').get(),qc=b('MercuryThreadInformer').get(),rc=b('MercuryThreadMetadataRenderer').get(),sc=b('MercuryThreads').get(),tc=/^\s*$/,uc={},vc=null,wc,xc=10;function yc(td,ud){var vd=ia.create('div');ud=ud&&ud.filter(function(yd){return yd!=wa.user;});if(jc(ud))return xb.remove(td);var wd=ud.length,xd=wd-xc;if(xd>1)ud=ud.slice(0,xc);wa.getMulti(ud,function(yd){for(var zd in yd){var ae=yd[zd],be=ub[':fb:mercury:chat:multichat-tooltip-item'].build();ia.setContent(be.getNode('name'),ae.name);var ce=wa.getUserID(zd),de=ce&&gb.get(ce)==l.ACTIVE;ea.conditionShow(be.getNode('icon'),de);ea.conditionClass(be.getNode('name'),'tooltipItemWithIcon',de);ia.appendContent(vd,be.getRoot());}if(xd>1){var ee=hc._("and {number of hidden chat participants} more.",[hc.param("number of hidden chat participants",xd)]);ia.appendContent(vd,ia.create('div',{},ee));}xb.set(td,vd,'above');});}var zc={},ad=null,bd=false;function cd(td,ud,vd){if(vd){zc[td]=ud;if(!ad)ad=kc(dd,600);}else{ea.removeClass(ud,'highlightTitle');delete zc[td];}}function dd(){for(var td in zc){var ud=zc[td];if(ud.parentNode){ea.conditionClass(ud,'highlightTitle',bd);}else delete zc[td];}bd=!bd;if(!Object.keys(zc).length){clearInterval(ad);ad=null;}}function ed(td){var ud=pc.tokenizeThreadID(td);switch(ud.type){case 'user':return ub[':fb:mercury:chat:user-tab'].build();}return ub[':fb:mercury:chat:multichat-tab'].build();}function fd(td){var ud=td._tabTemplate.getNode('input').value||'',vd=td._fileUploader.getAttachments();if(ld(td))hd(td,ud,vd,function(wd){var xd=td._fileUploader.getImageFiles();if(xd.length>0){wd.image_ids=xd;wd.has_attachment=true;}var yd=td._fileUploader.getVideoFiles();if(yd.length>0){wd.video_ids=yd;wd.has_attachment=true;}oc.sendMessage(wd);td._fileUploader.removeAttachments();td._shareLinkUploader.clear();td._getNode('input').value='';td._typingDetector&&td._typingDetector.resetState();td._messagesView&&td._messagesView.scrollToBottom();});}function gd(td,ud){if(ud===0)return;od(td,eb.POST_PUBLISHED,{count:ud});td._waterfallID=cc.generate();}function hd(td,ud,vd,wd){sc.getThreadMeta(td._threadID,function(xd){var yd=oc.constructUserGeneratedMessageObject(ud,xa.CHAT_WEB,td._threadID);if(vd.length>0){yd.has_attachment=true;yd.raw_attachments=vd;}var zd=td._shareLinkUploader.getAttachData();if(zd){yd.has_attachment=true;yd.content_attachment=zd;}if(sc.isNewEmptyLocalThread(td._threadID)){var ae=td._sheetController.getAddFriendsParticipants();if(ae===null||ae.length===0){return;}else if(ae.length===1){var be='user:'+wa.getUserID(ae[0]);yd.thread_id=be;}else sc.addParticipantsToThreadLocally(td._threadID,ae);}if(sc.isEmptyLocalThread(td._threadID)){var ce=pc.tokenizeThreadID(td._threadID);yd.message_id=ce.value;yd.specific_to_list=xd.participants;}if(typeof yd!='undefined')yd.signatureID=td._signatureID;yd.ui_push_phase=ba.UIPushPhase;wd(yd);if(td._threadID!==yd.thread_id&&!td._photoUploader.isUploading()){pd.inform('closed-tab',td._threadID);q.openThread(yd.thread_id,'ChatTabView');}});}function id(td){td._blocked=true;td._sheetController.openUploadWarningTabSheet();}function jd(td){return (td._fileUploader.isUploading()||td._photoUploader.isUploading());}function kd(td){return td._fileUploader.isUploading();}function ld(td){var ud=td._tabTemplate.getNode('input').value||'';if(!tc.test(ud))return true;if(td._fileUploader.getAttachments().length>0||td._fileUploader.getImageFiles().length>0||td._fileUploader.getVideoFiles().length>0)return true;if(td._shareLinkUploader.getAttachData())return true;return false;}function md(td){if(td._blocked){if(kd(td))return;td._blocked=false;fd(td);td._sheetController.closeUploadWarningTabSheet();}}function nd(td){td._nubController.flyoutContentChanged();td._attachmentsDiv.scrollTop=td._attachmentsDiv.scrollHeight;}function od(td,ud,vd){eb.sendSignal(ec({qn:td._waterfallID,step:ud,uploader:eb.APP_CHAT},vd||{}));}function pd(td,ud,vd){if(ud)pc.ensureThreadIsFetched(ud);this._threadID=td;this._signatureID=vd;this._eventListeners=[];this._isDragDropActive=false;this._tabTemplate=ed(td);this._tabElem=this._tabTemplate.getRoot();this._titlebar=this._getNode('nubFlyoutTitlebar');this._iconsContainerNode=this._getNode('iconsContainer');this._inputContainerNode=this._getNode('inputContainer');this._waterfallID=cc.generate();this._subscriptionsHandler=new tb();this._initializeAutoSendPhotoUploader();this._stickersFlyoutShown=false;var wd=ja.scry(this._tabElem,"._1ia");if(wd&&wd.length>0){this._dropTarget=new ka(wd[0]);this._dropTarget.setOnFilesDropCallback(this._filesDropped.bind(this));this._dropTarget.setOnURLDropCallback(this._linkDropped.bind(this));this._dropTarget.enable();}this._attachmentsDiv=this._getNode('attachmentShelf');this._shareLinkUploader=new v(this._tabTemplate.getNode('attachmentShelf'),this._tabTemplate.getNode('input'),this.focus.bind(this));this._initializeUploader(this._shareLinkUploader);this._sheetController=new z(this._threadID,this._getNode('sheet'),this._tabElem);if(n.get('chat_react_option_menu')){this._initializeReactMenu(this._tabTemplate.getNode('attachmentShelf'));}else{this._fileUploader=new ua(this._tabTemplate.getNode('attachmentShelf'),this._tabTemplate.getNode('attachButtonForm'),this._tabTemplate.getNode('fileInput'),this._tabTemplate.getNode('attachID'));this._initializeUploader(this._fileUploader);}this._sheetController.onClickNewMessagesSheet(function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();pd.inform('read',this._threadID);}.bind(this));this._sheetController.onClickThreadIsMutedSheet(function(){sc.updateThreadMuteSetting(this._threadID,0);this.focus();}.bind(this));this._nubController=new cb().init(this._tabElem);this._sheetController.onResize(this._nubController.flyoutContentChanged.bind(this._nubController));this._sheetController.onTokensChanged(function(ie,je){sc.getThreadMeta(this._threadID,function(ke){this._updateControls(ke,je.token_count);}.bind(this));}.bind(this));this._contextualDialogController=new o(this._threadID,this._getNode('videoCallLink'));if(vc===null)vc=!n.get('seen_autosend_photo_nux');this._messagesView=null;var xd=this._getNode('titlebarText'),yd=function(ie){xd.setAttribute('href',ie);xd.removeAttribute('rel');ea.removeClass(xd,'noLink');};if(n.get('chat_react_option_menu')){rc.getWebMessengerURL(td,function(ie){return yd(ie);});}else{var zd=this._getNode('conversationLink');ea.hide(zd);rc.renderWebMessengerLink(td,zd,function(){ea.show(zd);yd(zd.href);});}if(!sc.getCanonicalUserInThread(this._threadID))this._titlebarTooltipAnchor=this._getNode('titlebarText');var ae=this._getCanonicalUserID();if(this._getCanonicalUserID()){wa.get(wa.getIDForUser(ae),function(ie){if(ie.href)yd(ie.href);});}else if(n.get('chat_react_option_menu')&&this._reactChatTabMenu.props.fullURL){yd(this._reactChatTabMenu.props.fullURL);}else if(zd&&zd.href)yd(zd.href);var be=this._inputContainerNode.clientHeight;vb.getInstance(this._getNode('input')).subscribe('resize',function(){var ie=this._inputContainerNode.clientHeight;if(ie!=be)this._nubController.flyoutContentChanged();be=ie;}.bind(this));this._nubController.subscribe('resize',function(){this._resizeInputContainer();}.bind(this));this._setNameConversationLink();this._listen('closeButton','click',this._closeClicked);this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','keyup',this._closeEnter);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);this._listen('inputContainer','click',this._inputContainerClicked);this._listen('addFriendLink','click',this._addFriendLinkClicked,true);this._listen('addToThreadLink','click',this._addFriendLinkClicked,true);this._listen('nameConversationLink','click',this._nameConversationLinkClicked,true);this._listen('clearWindowLink','click',this._clearHistory,true);this._listen('unsubscribeLink','click',this._unsubscribeLinkClicked,true);this._listen('videoCallLink','click',this._callClicked,true);this._listen('reportSpamLink','click',this._reportSpamClicked,true);this._listen('createGroupLink','click',this._createGroupClicked,true);this._listen('enableDesktopNotif','click',this._enableDesktopNotif,true);this._listen('muteThreadLink','click',za.showMuteChangeDialog.bind(null,this._threadID),true);this._listen('unmuteThreadLink','click',function(){sc.updateThreadMuteSetting(this._threadID,0);wb.hide();}.bind(this),true);this._listen('input','focus',this._focusTab);this._listen('input','blur',this._blurTab);this._listen('input','paste',this._inputPasted);this._listen('sheet','keydown',function(event){if(!event.getModifiers().any&&event.keyCode===qa.TAB){this._getNode('input').focus();event.kill();}}.bind(this));var ce=this._getNode('emoticons');this._emoticonView=null;if(ce){this._emoticonView=new bb(ce,this._getNode('input'));this._stickersFlyoutToggler=ce;}if(lb.WebStickerTrigger){this._triggeredWord=null;this._stickerTriggerImage=hb.renderComponent(hb.createElement(rb,null),this._getNode('stickersTriggerImageContainer'));this._listen('input','keyup',lc(this._inputChanged,1000,this));}if(ob.shouldShowStickerSearchNUXIndicator()){this._addStickerSearchNUXIndicator();this._listen('emoticons','click',function(){if(ob.shouldShowStickerSearchNUXIndicator()){kb.selectPack(mb.SEARCH_PACK_ID);ob.clearShowStickerSearchNUXIndicator();}g.inform('stickerSearchNUXIndicator/hide');},true);g.subscribeOnce('stickerSearchNUXIndicator/hide',function(){this._clearStickerSearchNUXIndicator();this._clearStickerSearchNUXTooltip();}.bind(this));pd.subscribe('lower-activated',function(ie,je){if(je===this._threadID&&ob.shouldShowStickerSearchNUXIndicator()){this._clearStickerSearchNUXTooltip();this._addStickerSearchNUXIndicator();}}.bind(this));}this._stickersFlyoutPackID=null;if(n.get('chat_react_sticker_button')){this._selectionPosition=new jb(this._getNode('input'));this._stickerButton=hb.renderComponent(hb.createElement(w,{onFlyoutShown:this._onFlyoutShown.bind(this),onFlyoutHidden:this._onFlyoutHidden.bind(this),onStickerSelect:this._stickerSelected.bind(this),onEmoticonSelect:this._emoticonSelected.bind(this)}),this._getNode('stickerButtonContainer'));this._eventListeners.push(ob.addListener(ob.PACK_SELECTED,function(ie){if(this._stickerButton&&this._stickerButton.isMounted())this._stickerButton.setProps({packID:ie});}.bind(this)));}else{var de=this._getNode('stickers');if(de)this._stickersFlyout=hb.renderComponent(hb.createElement(nb,{onStickerSelect:function(ie){this._stickerSelected(ie);}.bind(this),onShown:this._onFlyoutShown.bind(this),onHidden:this._onFlyoutHidden.bind(this),onEscKeyDown:this._hideStickersFlyoutIfShown.bind(this)}),de);this._eventListeners.push(ob.addListener(ob.PACK_SELECTED,function(ie){if(this._stickersFlyout&&this._stickersFlyout.isMounted())this._stickersFlyout.setProps({packID:ie});}.bind(this)));}if(nc){this._orionTriggerContainer=this._getNode('orionTriggerContainer');this._orionTrigger=hb.renderComponent(hb.createElement(nc,{onTrigger:this._orionTriggered.bind(this)}),this._orionTriggerContainer);}var ee=this._getNode('contentRoll');if(ee)hb.renderComponent(hb.createElement(ca,{onSelection:function(ie){this._shareLinkUploader&&this._shareLinkUploader.loadShare(ie.url,{content_roll_entry:ie});this.focus();}.bind(this),userID:da.getID()}),ee);if(ac.firefox()&&fa.get()=='ko_KR'){this._listen('input','keyup',this._inputKeyDown);}else this._listen('input','keydown',this._inputKeyDown);this._privacyLink=this._getNode('privacyLink');if(this._privacyLink){this._privacyActionController=new t(ae,this._updatePrivacyLink.bind(this));this._eventListeners.push(na.listen(this._privacyLink,'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController)));}sc.getThreadMeta(this._threadID,function(ie){pc.getServerThreadID(this._threadID,function(ke){this._typingDetector=new yb(ae,this._getNode('input'),'mercury-chat',null,ke);}.bind(this));this._setUpMutingSettings(ie);if(sa.PicassoWebChatGK){var je=this._tabTemplate.getNode('photoAttachmentMenu');new r(this._tabTemplate.getNode('photoAttachLink'),this._tabTemplate.getNode('editPhotoLink'),this._tabTemplate.getNode('newPhotoLink'),je,this._threadID);}}.bind(this));var fe=this._getNode('muteGroupLink');if(fe){var ge=sc.getCanonicalGroupInThread(this._threadID);if(ge)fe.setAttribute('ajaxify',zb(fe.getAttribute('ajaxify')).addQueryData({id:ge}));}u.removeEmptyHrefs(this._tabElem);uc[td]=this;this.updateAvailableStatus();this.updateTab();this._setCloseTooltip(false);var he={threadID:td,userID:ae,signatureID:this._signatureID};new k('/ajax/chat/opentab_tracking.php',he).send();ib.onBeforeUnload(function(){if(this._hasUnfinishedPost())return "You haven't sent your message yet. Do you want to leave without sending?";if(oc.getNumberLocalMessages(this._threadID))return "Your message is still being sent. Are you sure you want to leave?";return null;}.bind(this),false);ib.onUnload(function(){qd(this);}.bind(this));}function qd(td){if(td._photoUploader.isUploading())od(td,eb.CANCEL_DURING_UPLOAD);}function rd(){for(var td in uc){uc[td].updateAvailableStatus();uc[td].updateMultichatTooltip();}}g.subscribe(['buddylist/availability-changed'],rd);fb.subscribe(['privacy-changed','privacy-availability-changed'],rd);m.subscribe(m.ON_CHANGED,function(){for(var td in uc)sc.getThreadMeta(td,function(ud){uc[td]._updateUnreadCount(ud);});});ab.addRetroactiveListener('state-changed',function(td){for(var ud in td){var vd=td[ud]&&td[ud].length,wd=uc[ud];wd&&wd.showTypingIndicator(vd);}});qc.subscribe('threads-updated',function(td,ud){for(var vd in uc){var wd=uc[vd];ud[vd]&&wd.updateTab();if(wd._newThreadIDFromPhotoUpload&&!wd._photoUploader.isUploading()&&ud[wd._newThreadIDFromPhotoUpload]){pd.inform('closed-tab',wd._threadID);q.openThread(wd._newThreadIDFromPhotoUpload,'ChatTabView');wd._newThreadIDFromPhotoUpload=null;}}});qc.subscribe('threads-deleted',function(td,ud){for(var vd in uc)ud[vd]&&pd.inform('thread-deleted',vd);});ec(pd,h,{get:function(td){return uc[td];}});ec(pd.prototype,{getThreadID:function(){return this._threadID;},showAddFriend:function(){setTimeout((function(){this._sheetController.openAddFriendsSheet();}).bind(this),0);},showNameConversation:function(td){setTimeout((function(){this._sheetController.openNameConversationSheet(td);}).bind(this),0);},hideAutomaticNameConversation:function(){setTimeout((function(){this._sheetController.closeAutomaticNameConversationSheet();}).bind(this),0);},isVisible:function(){return ea.shown(this._tabElem);},setVisibleState:function(td,ud){var vd=ea.shown(this._tabElem),wd=ea.hasClass(this._tabElem,'opened');ea.conditionShow(this._tabElem,td);ea.conditionClass(this._tabElem,'opened',ud);if(!(vd&&wd)&&td&&ud){if(!this._messagesView)this._messagesView=new y(this._threadID,this._sheetController,this._getNode('chatConv'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'),this);this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();}if(vd&&wd&&!(td&&ud))this._contextualDialogController.tabNotActive();},focus:function(){var td=ea.hasClass(this._tabElem,'opened')?'input':'dockButton';this._getNode(td).focus();},isFocused:function(){var td=ic();return db.byClass(td,"_50mz")===this._tabElem;},hasEmptyInput:function(){return tc.test(this._getNode('input').value);},getInputElem:function(){return this._getNode('input');},setInput:function(td){this._getNode('input').value=td;},setStickersFlyoutPackID:function(td){if(this._stickerButton){this._setPackIDReact(td);}else this._setPackIDLegacy(td);},_linkDropped:function(td){this._shareLinkUploader.loadShare(td);},_filesDropped:function(td){if(this._fileUploader)this._fileUploader.addDroppedFiles(td);},showStickerSearchNUXTooltip:function(){this._clearStickerSearchNUXIndicator();this._stickerSearchNUXTooltip=hb.renderComponent(hb.createElement(qb,{showIndicatorFunc:this._addStickerSearchNUXIndicator.bind(this)}),this._getNode('tooltipNUXContainer'));},_setPackIDLegacy:function(td){var ud=this._stickersFlyout;if(!this._stickersFlyoutToggler||!ud||!ud.isMounted())return;kb.selectPack(td);this._toggleStickersFlyoutShownLegacy(true);},_setPackIDReact:function(td){if(!this._stickerButton.isMounted())return;kb.selectPack(td);this._toggleStickersFlyoutShownReact(true);},_toggleStickersFlyoutShownReact:function(td){this._stickerButton.setProps({shown:td});this._stickersFlyoutShown=td;},_toggleStickersFlyoutShownLegacy:function(td){if(td){wb.show(this._stickersFlyoutToggler);}else wb.hide(this._stickersFlyoutToggler);this._stickersFlyoutShown=td;},_hideStickersFlyoutIfShown:function(){if(this._stickersFlyoutToggler&&this._stickersFlyout&&this._stickersFlyoutShown)this._toggleStickersFlyoutShownLegacy(false);},showStickerReplyNUX:function(){if(wc)return;var td=this._getNode('stickerButtonContainer')||this._getNode('emoticons');new j(new dc().getURI()).setRelativeTo(td).setData({thread_id:this._threadID}).setHandler(function(ud){ob.clearShowStickerReplyNUX();}).send();},insertBefore:function(td){ia.insertBefore(td._tabElem,this._tabElem);},appendTo:function(td){ia.appendContent(td,this._tabElem);},nextTabIs:function(td){var ud=td&&td._tabElem;return this._tabElem.nextSibling==ud;},getScrollTop:function(){return ia.find(this._tabElem,'.fbNubFlyoutBody.scrollable').scrollTop;},setScrollTop:function(td){ia.find(this._tabElem,'.fbNubFlyoutBody.scrollable').scrollTop=td;},destroy:function(){ia.remove(this._tabElem);this._emoticonView&&this._emoticonView.destroy();while(this._eventListeners.length)this._eventListeners.pop().remove();if(this._dropTarget)this._dropTarget.disable();this._messagesView&&this._messagesView.destroy();this._sheetController&&this._sheetController.destroy();if(n.get('chat_react_option_menu')){hb.unmountComponentAtNode(this._getNode('menuContainer'));}else this._fileUploader&&this._fileUploader.destroy();hb.unmountComponentAtNode(this._getNode('photoUploaderContainer'));if(n.get('chat_react_sticker_button')){hb.unmountComponentAtNode(this._getNode('stickerButtonContainer'));}else hb.unmountComponentAtNode(this._getNode('stickers'));if(lb.WebStickerTrigger){hb.unmountComponentAtNode(this._getNode('stickersTriggerImageContainer'));clearTimeout(this._triggerTimeoutID);}this._subscriptionsHandler&&this._subscriptionsHandler.release();this._contextualDialogController&&this._contextualDialogController.destroy();this._privacyActionController&&this._privacyActionController.destroy();delete uc[this._threadID];ha.unregisterNubController(this._nubController);pa.reset(this._getNode('input'));},updateAvailableStatus:function(){sc.getThreadMeta(this._threadID,function(td){var ud=l.OFFLINE,vd=this._getCanonicalUserID();if(vd){ud=gb.get(vd);}else{var wd=td.participants.map(function(yd){return wa.getUserID(yd);});ud=gb.getGroup(wd);}if(!aa.isOnline())ud=l.OFFLINE;if(vd)this._updateCallLink(ud);ea.conditionClass(this._tabElem,"_5238",ud===l.ACTIVE);ea.conditionClass(this._tabElem,"_42nw",ud===l.IDLE);ea.conditionClass(this._tabElem,"_5239",ud===l.MOBILE);var xd=this._getNode('presenceIndicator');switch(ud){case l.ACTIVE:xd.setAttribute('alt',"Online");break;case l.MOBILE:xd.setAttribute('alt',"Mobile");break;default:xd.removeAttribute('alt');break;}}.bind(this));},updateTab:function(){this._setNameConversationLink();sc.getThreadMeta(this._threadID,function(td){rc.renderAndSeparatedParticipantList(this._threadID,[this._getNode('name'),this._getNode('titlebarText')],{names_renderer:ya.renderShortNames,check_length:true});this._updateControls(td);this._updateMutingSettings(td);this._updateUnreadCount(td);this.updateMultichatTooltip();this._updateArchiveWarning(td);this._updateNewThread(td);this._updateNameConversationSheet(td);this._updateReadOnlySheet(td);}.bind(this));},_setNameConversationLink:function(){var td=this._getNode('nameConversationLink');if(td)sc.isEmptyLocalThread(this._threadID)?ea.hide(td):ea.show(td);},_updateNameConversationSheet:function(td){if(sc.canReply(td.thread_id)&&!td.name&&!td.is_canonical&&!td.name_conversation_sheet_dismissed&&!td.has_email_participant&&!td.read_only&&!sc.isEmptyLocalThread(td.thread_id)){this.showNameConversation(true);}else this.hideAutomaticNameConversation();},_updateReadOnlySheet:function(td){var ud=sc.canReply(td.thread_id),vd=sc.isEmptyLocalThread(td.thread_id);if(!ud&&!vd){this._sheetController.openReadOnlySheet();}else if(ud&&!vd&&sa.ReadOnlyEmailThreadsEarlyWarning&&td.has_email_participant)this._sheetController.openReadOnlyEarlyWarningSheet();},updateSignatureID:function(td){this._signatureID=td;},_showPhotoNUXIfNecessary:function(){if(vc){vc=false;new j('/ajax/chat/photo_nux.php').setRelativeTo(this._getNode('photoUploaderContainer')).setData({threadID:this._threadID}).send();return true;}},_setUpMutingSettings:function(td){var ud=za.isThreadMuted(td);if(ud)this._sheetController.openThreadIsMutedTabSheet();this._updateActionMenu(ud);},_updateMutingSettings:function(td){var ud=za.isThreadMuted(td),vd;if(n.get('chat_react_option_menu')){vd=this._reactChatTabMenu.props.isMuted;}else vd=ea.shown(this._getNode('unmuteThreadLink').parentNode);if(ud&&!vd){this._sheetController.openThreadIsMutedTabSheet();}else if(!ud&&vd)this._sheetController.closeThreadIsMutedTabSheet();this._updateActionMenu(ud);},_updateActionMenu:function(td){if(n.get('chat_react_option_menu')){this._reactChatTabMenu.setProps({isMuted:td});}else{ea.conditionShow(this._getNode('muteThreadLink').parentNode,!td);ea.conditionShow(this._getNode('unmuteThreadLink').parentNode,td);}},_updateArchiveWarning:function(td){var ud=false;wa.get(wa.user,function(vd){ud=vd.employee;if(ud)wa.getMulti(td.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));}.bind(this));},_updateControls:function(td,ud){var vd=sc.canReply(td.thread_id)&&(!jc(td.participants)||ud);ea.conditionShow(this._inputContainerNode,vd);ea.conditionShow(this._iconsContainerNode,vd);if(!n.get('chat_react_option_menu')){ea.conditionShow(this._getNode('dropdown'),vd);}else this._reactChatTabMenu.setProps({show:vd});ea.conditionShow(this._getNode('addToThreadLink'),vd);this._resizeInputContainer();this._updateOrionTrigger(vd);},_updateOrionTrigger:function(td){if(this._orionTrigger&&td){var ud=this.getParticipantIDForOrionNUX();ea.conditionShow(this._orionTriggerContainer,ud);if(ud){wa.get(ud,function(vd){vd.userId=wa.getUserID(ud);this._orionTrigger.setProps({receiver:vd,disabled:!vd.orion_eligible});if(this.isOrionNUXEligible())this.showOrionNUXTooltip();}.bind(this));}else this._orionTrigger.setProps({receiver:null});}},getParticipantIDForOrionNUX:function(){var td=this._sheetController.getAddFriendsTabSheet(),ud=td.getParticipants(),vd=this._getCanonicalUserID(),wd=null;if(vd){wd=wa.getIDForUser(vd);}else if(ud&&ud.length===1)wd=ud[0];return wd;},showOrionNUXTooltip:function(){if(this._orionTrigger&&sa.ShowOrionNUXTooltip)this._orionTrigger.setShouldShowNUXTooltip();},isOrionNUXEligible:function(){var td=this.getParticipantIDForOrionNUX();return td&&this.isVisible()&&ea.hasClass(this._tabElem,'opened');},_resizeInputContainer:function(){var td=this._tabElem.clientWidth,ud=2,vd=td-(this._inputContainerNode.clientWidth+ud),wd=ra.isRTL()?'left':'right';sb.set(this._iconsContainerNode,wd,vd+'px');vb.getInstance(this._getNode('input')).update();},_updateNewThread:function(td){if(sc.isNewEmptyLocalThread(td.thread_id))this.showAddFriend();},_showArchiveWarningIfAllParticipantsAreEmployees:function(td){var ud=true;for(var vd in td)ud=ud&&td[vd].employee;var wd=this._getNode('titanArchiveWarning');if(wd){if(this._titlebarTooltipAnchor)ea.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',ud);ea.conditionShow(wd,ud);}},updateMultichatTooltip:function(){sc.getThreadMeta(this._threadID,function(td){if(!td.is_canonical)yc(this._titlebarTooltipAnchor,td.participants);}.bind(this));},_getNode:function(td){return this._tabTemplate.getNode(td);},_getCanonicalUserID:function(){return sc.getCanonicalUserInThread(this._threadID);},_listen:function(td,event,ud,vd){var wd=this._getNode(td);if(wd){this._eventListeners.push(na.listen(wd,event,ud.bind(this)));}else if(!vd)throw new Error('Could not find node "'+td+'"');},_closePreClicked:function(td){this._closeMouseDown=true;},_closeClicked:function(td){qd(this);pd.inform('closed-tab',this._threadID);td.kill();},_closeEnter:function(td){if(td.keyCode===qa.RETURN)this._closeClicked(td);},_nubClicked:function(td){if(!this._isDragDropActive){td.kill();return pd.inform('nub-activated',this._threadID);}},_dockKeyDown:function(event){if(event.keyCode===qa.RETURN||event.keyCode===qa.SPACE){pd.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===qa.ESC){this._handleEscape();event.kill();}else if(event.keyCode===qa.TAB&&!event.ctrlKey){var td=pd.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});!td&&event.kill();}},_handleEscape:function(){if(this._stickersFlyoutShown){this._stickerButton?this._toggleStickersFlyoutShownReact(false):this._toggleStickersFlyoutShownLegacy(false);return;}qd(this);if(this.hasEmptyInput()){pd.inform('esc-pressed',this._threadID);}else{var td="Are you sure you want to close this chat window?",ud="You haven't sent your message.",vd=new ga().setTitle(td).setBody(ud).setButtons([ga.CLOSE,ga.CANCEL]).setHandler(pd.inform.bind(pd,'esc-pressed',this._threadID,null)).setModal(true).show(),wd=vd.getButtonElement('yes');wd&&oa.set(wd);}},_titleClicked:function(event){var td=event.getTarget();if(!db.byClass(td,'titlebarText')&&!db.byClass(td,'uiSelector')&&!db.byClass(td,'addToThread')&&!db.byClass(td,'optionMenu')&&!this._isDragDropActive){pd.inform('lower-activated',this._threadID);event.kill();}},_callClicked:function(td){var ud=this._getCanonicalUserID();if(bc.availableForCall(ud)){var vd='chat_tab_icon';if(td.target&&ea.hasClass(td.target,'video_call_promo')){vd='chat_tab_icon_promo';}else if(td.target&&ea.hasClass(td.target,'video_call_tour'))vd='chat_tab_icon_tour';pd.inform('video-call-clicked',{threadID:this._threadID,userID:ud,clickSource:vd});}return false;},_addFriendLinkClicked:function(){this.showAddFriend();},_nameConversationLinkClicked:function(){this.showNameConversation();},_showParticipantsClicked:function(){pc.getServerThreadID(this._threadID,function(td){i.send(new j(zb('/ajax/browser/dialog/multichat_members/').addQueryData({id:td})));});},_clearHistory:function(){var td=sc.getThreadMetaNow(this._threadID);if(td){var ud=this._getCanonicalUserID();pc.clearChat(this._threadID,ud,td.timestamp);}},_unsubscribeLinkClicked:function(){var td=[];td.push({name:'unsubscribe',label:"Leave Conversation",handler:this._unsubscribeToThread.bind(this)});td.push(ga.CANCEL);new ga().setTitle("Leave Conversation?").setBody("You will stop receiving messages from this conversation and people will see that you left.").setButtons(td).show();},_getUserParticipants:function(td){var ud=[];td.forEach(function(vd){var wd=wa.getUserID(vd);wd&&ud.push(wd);});return ud;},_createGroupClicked:function(){sc.getThreadMeta(this._threadID,function(td){if(!td.is_canonical){var ud=zb('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger_dock',parent_id:'0'}),vd=this._getUserParticipants(td.participants);ud.addQueryData({members:vd});if(td.name)ud.addQueryData({name:td.name});i.send(new j(ud));}}.bind(this));},_enableDesktopNotif:function(){Notification.requestPermission();},_reportSpamClicked:function(){var td=this._getCanonicalUserID(),ud=zb('/ajax/chat/report.php').addQueryData({id:td}).addQueryData({src:'top_report_link'});i.send(new j(ud));},_inputPasted:function(event){if(ac.chrome()){var td=event.clipboardData||event.originalEvent.clipboardData;if(!td||!td.items||td.items.length<1)return;var ud=td.items[0].type;if(ud!=='image/png')return;if(td.items[0].getAsFile){var vd=td.items[0].getAsFile();this._photoUploader.uploadFile(vd);}}},_focusTab:function(){ea.addClass(this._tabElem,'focusedTab');this.tryMarkAsRead();this._contextualDialogController.tabFocused();if(!wc&&this._showPhotoNUXIfNecessary())g.subscribe(['ChatNUX/show','ChatNUX/hide'],function(event){wc=event==='ChatNUX/show';});this._closeMouseDown=false;this._setCloseTooltip(true);pd.inform('focus-tab',this._threadID);},_blurTab:function(){ea.removeClass(this._tabElem,'focusedTab');!this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function(td){var ud=this._getNode('titlebarCloseButton'),vd=td?"Press Esc to close":"Close tab";xb.set(ud,vd,'above');},_inputKeyDown:function(event){this.tryMarkAsRead();this._inputKeyDownForStickerTrigger(event);if(event.keyCode===qa.RETURN&&!event.shiftKey){if(kd(this)){id(this);event.kill();return;}fd(this);event.kill();return;}if(event.keyCode===qa.DOWN&&event.shiftKey&&this._getNode('input').value===''){pd.inform('lower-activated',this._threadID);event.kill();return;}this._handleHotkeyPressed(event);},_inputKeyDownForStickerTrigger:function(event){if(lb.WebStickerTrigger)if(event.keyCode===qa.RETURN&&!event.shiftKey){this._activateStickerTriggerAfterparty();}else if(this._persistTrigger)this._deactivateStickerTriggerAfterparty();},_activateStickerTriggerAfterparty:function(){this._persistTrigger=true;clearTimeout(this._triggerTimeoutID);this._triggerTimeoutID=setTimeout(this._deactivateStickerTriggerAfterparty.bind(this),10000);},_deactivateStickerTriggerAfterparty:function(){clearTimeout(this._triggerTimeoutID);this._persistTrigger=false;this._userUsedTrigger=false;this._setStickerTrigger([],null);},_setStickerTrigger:function(td,ud){this._triggeredWord=ud;this._stickerTriggerImage.setProps({stickers:td});},_inputChanged:function(event){if(!this._userUsedTrigger&&!this._persistTrigger){var td=event.target.value;pb.prepareTagsData().then(function(){return pb.findTagForInput(td,function(ud,vd){return this._setStickerTrigger(ud,vd);}.bind(this));}.bind(this));}},_hasUnfinishedPost:function(){return ld(this)||jd(this);},tryMarkAsRead:function(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){pd.inform('read',this._threadID);return true;}return false;},_chatConvClicked:function(td){this.tryMarkAsRead();if(db.byTag(td.getTarget(),'a')||ia.getSelection())return;this.focus();},_inputContainerClicked:function(td){this.tryMarkAsRead();this.focus();},showTypingIndicator:function(td){ea.conditionClass(this._tabElem,'typing',td);},_updateUnreadCount:function(td){var ud=td.unread_count;if(typeof ud!='undefined'){var vd=!!ud&&(!m.showsTabUnreadUI||m.showsTabUnreadUI()),wd=this._getNode('numMessages');ea.conditionShow(wd,vd);ea.conditionClass(this._tabElem,'highlightTab',vd);cd(this._threadID,this._tabElem,vd);ia.setContent(wd,ud);}},_updateCallLink:function(td){var ud=this._getNode('videoCallLink'),vd=this._getCanonicalUserID();if(vd===da.getID()){this._hideVideoCallouts();ea.hide(ud);return;}if(aa.isOnline()){var wd='fbid:'+vd;wa.get(wd,function(xd){if(bc.availableForCall(vd)){xb.set(ud,mc._("Start a video call with {firstname}",{firstname:xd.short_name}));}else{xb.set(ud,mc._("{firstname} is currently unavailable for video calling",{firstname:xd.short_name}));this._hideVideoCallouts();}}.bind(this));}else{xb.set(ud,"You must be online to make a call.");this._hideVideoCallouts();}},_hideVideoCallouts:function(){this._contextualDialogController.hideVideoCallouts();},_updatePrivacyLink:function(td){var ud;if(td==t.OFFLINE){ud="Go online";if(n.get('chat_react_option_menu')){this._reactChatTabMenu.setProps({privacyText:ud});}else ia.setContent(this._privacyLink,ud);return;}var vd=this._getCanonicalUserID();if(!vd)return;var wd='fbid:'+vd;wa.get(wd,function(xd){if(td==t.BLOCKED){ud=mc._("Turn On Chat for {name}",{name:xd.short_name});}else ud=mc._("Turn Off Chat for {name}",{name:xd.short_name});if(n.get('chat_react_option_menu')){this._reactChatTabMenu.setProps({privacyText:ud});}else ia.setContent(this._privacyLink,ud);}.bind(this));},_unsubscribeToThread:function(){if(!sc.isEmptyLocalThread(this._threadID)){var td=oc.constructLogMessageObject(xa.CHAT_WEB,this._threadID,va.UNSUBSCRIBE,{removed_participants:[wa.user]});oc.sendMessage(td);}pd.inform('unsubscribed',this._threadID);return true;},_initializeUploader:function(td){this._subscriptionsHandler.addSubscriptions(td.subscribe(['all-uploads-completed','upload-canceled'],function(){md(this);}.bind(this)),td.subscribe('dom-updated',function(){nd(this);}.bind(this)),td.subscribe('submit',function(){this._getNode('input').focus();}.bind(this)));},_initializeReactMenu:function(td){var ud=this._getNode('menuContainer'),vd=ta.isMultichat(this._threadID),wd=this._sheetController.openAddFriendsSheet.bind(this._sheetController);if(ud)this._reactChatTabMenu=hb.renderComponent(hb.createElement(x,{onFileUploaderMounted:this.setFileUploader.bind(this),updatePrivacyLinkFunc:this._updatePrivacyLink.bind(this),nameConversationFunc:this._nameConversationLinkClicked.bind(this),showParticipantsFunc:this._showParticipantsClicked.bind(this),leaveConversationFunc:this._unsubscribeLinkClicked.bind(this),clearHistoryFunc:this._clearHistory.bind(this),reportSpamFunc:this._reportSpamClicked.bind(this),createGroupFunc:this._createGroupClicked.bind(this),isMultichat:vd,showAddFriend:wd,threadID:this._threadID,attachmentsShelf:td,onUploadFinished:md.bind(this,this),onUpdateAttachmentsShelf:nd.bind(this,this),onSubmit:function(){this._getNode('input').focus();}.bind(this),enableDesktopNotif:function(){this._enableDesktopNotif();}.bind(this)}),ud);},_initializeReactFileUploader:function(td){this._fileUploader=hb.renderComponent(hb.createElement(p,{onFileUploaderMount:this.setFileUploader.bind(this),attachmentsShelf:td,onUploadFinished:md.bind(this,this),onUpdateAttachmentsShelf:nd.bind(this,this),onSubmit:function(){this._getNode('input').focus();}.bind(this)}),this._getNode('fileUploaderContainer'));},setFileUploader:function(td){this._fileUploader=td;},_initializeAutoSendPhotoUploader:function(){this._photoUploader=hb.renderComponent(hb.createElement(s,{onSubmit:this._handlePUSubmit.bind(this),onAllUploadsComplete:this._handlePUAllUploadsCompleted.bind(this),onLastUploadFail:this._handlePULastUploadFailed.bind(this),onLastUploadCancel:this._handlePULastUploadCanceled.bind(this)}),this._getNode('photoUploaderContainer'));},_handlePUSubmit:function(td,ud){od(this,eb.UPLOAD_START,ud);hd(this,'',[],function(vd){if(this._threadID!==vd.thread_id){this._newThreadIDFromPhotoUpload=vd.thread_id;if(this._messagesView)this._messagesView.setNewThreadID(vd.thread_id);}vd.content_attachment=null;oc.updateNewMessage(vd,ud.upload_id,ud);oc.sendMessage(vd);}.bind(this));this._getNode('input').focus();},_handlePULastUploadFailed:function(td,ud){od(this,eb.CLIENT_ERROR,ud);sd(ud);var vd="Photo Upload Failed",wd="Please try again. Make sure you are uploading a valid photo.";new ga().setTitle(vd).setBody(wd).setButtons(ga.OK).show();},_handlePULastUploadCanceled:function(td,ud){od(this,eb.CANCEL_DURING_UPLOAD,ud);sd(ud);},_handlePUAllUploadsCompleted:function(td,ud){od(this,eb.ALL_UPLOADS_DONE,ud);var vd=oc.updateMessageAfterUpload(ud.upload_id,ud);oc.clearUploadedMessage(ud.upload_id);oc.sendMessage(vd);var wd=ud.image_ids.length||ud.attachments.length;gd(this,wd);},_stickerSelected:function(td){hd(this,'',[],function(ud){ud.has_attachment=true;ud.sticker_id=td;oc.sendMessage(ud);this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emoticonSelected:function(td){var ud=la.symbols[td];if(!ud)return;var vd=vb.getInstance(this._getNode('input')),wd=vd.getValue(),xd=ma.insertEmoticon(ud,wd,this._selectionPosition.getPos());vd.setValue(xd.result);this._selectionPosition.setPos(xd.start,xd.end);},_clearStickerSearchNUXIndicator:function(){ea.removeClass(this._getNode('nuxIndicator'),'nux');},_orionTriggered:function(){hd(this,'',[],function(td){this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_addStickerSearchNUXIndicator:function(){ea.addClass(this._getNode('nuxIndicator'),'nux');},_clearStickerSearchNUXTooltip:function(){this._stickerSearchNUXTooltip&&this._stickerSearchNUXTooltip.hideNUX();},_onFlyoutShown:function(td){if(n.get('chat_react_sticker_button')){var ud=this._stickersFlyout.props.packID;if(ud!==mb.SEARCH_PACK_ID)this.focus();}if(lb.WebStickerTrigger&&this._triggeredWord&&!this._userUsedTrigger){this._userUsedTrigger=true;this._stickersFlyout.setProps({packID:mb.SEARCH_PACK_ID,trigger:this._triggeredWord},td);this._stickerTriggerImage.setProps({stickers:[]});}else td();this.flyoutShown=true;},_onFlyoutHidden:function(){this._stickersFlyoutShown=false;this.focus();}});function sd(td){var ud=oc.updateMessageAfterUpload(td.upload_id,td);oc.clearUploadedMessage(td.upload_id);oc.deleteMessages(ud.thread_id,[ud.message_id]);oc.deleteLocalMessage(ud.thread_id);}e.exports=pd;},null);
__d("ChatNewMessageHandler",["ArbiterMixin","ChatActivity","ChatMentionsNotifications","ChatTabModel","ChatTabView","JSLogger","MercuryAssert","MercuryBrowserAlerts","UserActivity","MercuryConfig","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=l.create('chat_new_message'),s={_raiseNewMessageTab:function(t,u){var v=j.getTab(t),w=false;if(v){w=v.raised;}else w=true;s.inform('chat/new-message-from-server',{thread_id:t});u.to_new_tab=!v;u.to_raised_tab=!!w;},_notify:function(t,u,v){if(p.DesktopNotificationsGK)i.notifyIfMessageToMe(u);var w=k.get(t);v.view_is_visible=w&&w.isVisible();v.view_is_focused=w&&w.isFocused();if(!v.view_is_visible)r.log('message_to_hidden');v.is_active=h.isActive();n.messageReceived(u);},newMessage:function(t,u,v){m.isThreadID(t);var w={thread_id:t,message_id:u.message_id};this._raiseNewMessageTab(t,w);this._notify(t,u,w);r.log('message',w);}};q(s,g);n.subscribe('before-alert',function(t,event){var u=event.threadID,v=k.get(u),w=j.getTab(u);if(w&&w.raised&&v&&v.isVisible()&&v.isFocused()&&o.isActive()){v.tryMarkAsRead();event.cancelAlert();}});e.exports=s;},null);
__d("ChatTabLRUManager",["ChatTabView","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f,g,h){var i=b('MercuryThreads').get(),j={getLRUVisibleTab:function(k){if(k.hasRoomForRaisedTab())return undefined;var l=Object.keys(k.getTabsToShow()||{}),m=1*60,n=null,o=Infinity;for(var p=0;p<l.length;p++){var q=l[p],r=i.getThreadMetaNow(q);if(h.isTabPromoted(q))continue;if(!g.get(q).hasEmptyInput()||!r)continue;var s=(h.getServerTime()-r.timestamp)/1000;if(!r.timestamp||(r.timestamp&&r.timestamp<o&&s>m)){n=r.thread_id;o=r.timestamp;}}return n;}};e.exports=j;},null);
__d("ChatTabPolicy",["ChatBehavior","JSLogger","MercuryActionTypeConstants","MercuryLogMessageType","MercuryAssert","MercuryParticipants","MercuryParticipantTypes","MercurySourceType","MercuryThreadMode","MercuryThreadMuter","MessagingTag","PresencePrivacy","ShortProfiles","MercuryUnseenState"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=b('MercuryUnseenState').get(),u=h.create('tab_policy');function v(w,x){t.markThreadSeen(w,x);}e.exports={messageIsAllowed:function(w,x,y){var z=w.thread_id,aa=x.message_id;k.isThreadID(z);k.isParticipantID(x.author);var ba;if(p.isThreadMuted(w)){ba={thread_id:z,message_id:aa,mute_settings:w.mute_settings};u.log('message_thread_muted',ba);return;}if(w.mode==o.OBJECT_ORIGINATED){ba={thread_id:z,message_id:aa,mode:w.mode};u.log('message_object_originated',ba);return;}if(x.source==n.EMAIL||x.source==n.TITAN_EMAIL_REPLY){ba={thread_id:z,message_id:aa,source:x.source};u.log('message_source_not_allowed',ba);return;}var ca=l.getUserID(x.author);if(!ca){u.log('message_bad_author',{thread_id:z,message_id:aa,user:ca});return;}if(x.action_type!=i.USER_GENERATED_MESSAGE&&!this._messageIsNewlyCreatedGroup(x,w)){ba={thread_id:z,message_id:aa,type:x.action_type};u.log('message_non_user_generated',ba);return;}if(w.is_canonical_user&&!g.notifiesUserMessages()){u.log('message_jabber',{thread_id:z,message_id:aa});v(z,true);return;}if(w.is_canonical&&!w.canonical_fbid){u.log('message_canonical_contact',{thread_id:z,message_id:aa});return;}if(w.folder!=q.INBOX){u.log('message_folder',{thread_id:z,message_id:aa,folder:w.folder});return;}var da=l.getUserID(l.user);s.getMulti([ca,da],function(ea){if(!r.allows(ca)){u.log('message_privacy',{thread_id:z,message_id:aa,user:ca});return;}var fa=ea[ca].employee&&ea[da].employee;if(!fa&&ea[ca].type!==m.FRIEND){u.log('message_non_friend',{thread_id:z,message_id:aa,user:ca});return;}y();});},_messageIsNewlyCreatedGroup:function(w,x){return w.action_type===i.LOG_MESSAGE&&w.log_message_type===j.THREAD_NAME&&x.message_count===1;}};},null);
__d("ChatTabViewSelector",["Event","Arbiter","CSS","DataStore","DOM","MenuDeprecated","NubController","ChatTabTemplates","Toggler","copyProperties","MercuryThreadInformer","MercuryThreads","MercuryThreadMetadataRenderer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=b('MercuryThreadInformer').get(),r=b('MercuryThreads').get(),s=b('MercuryThreadMetadataRenderer').get();function t(u){var v=n[':fb:chat:tab:selector'].build(),w=v.getRoot(),x=v.getNode('menu'),y=k.find(x,'.uiMenuInner'),z={},aa=new m().init(w);i.hide(w);k.insertBefore(u,w);function ba(ea){var fa=0;for(var ga in z){var ha=z[ga],ia=r.getThreadMetaNow(ga),ja=ha.getNode('unreadCount'),ka=(ia&&ia.unread_count)||0;fa+=ka;if(ka>9)ka='+';i.conditionClass(ja,'invisible_elem',!ka);k.setContent(ja,ka);}var la=v.getNode('numMessages');i.conditionShow(la,fa);k.setContent(la,fa);}this.setTabData=function(ea){z={};if(ea.length<1){i.hide(w);return;}i.show(w);k.empty(y);ea.forEach(function(fa){var ga=n[':fb:chat:tab:selector:item'].build();z[fa.id]=ga;var ha=ga.getNode('content');s.renderAndSeparatedParticipantList(fa.id,ha);k.prependContent(y,ga.getRoot());j.set(ga.getRoot(),'threadID',fa.id);var ia=ga.getNode('closeButton');g.listen(ia,'click',function(event){t.inform('selector/close-tab',fa.id);event.kill();});});aa.flyoutContentChanged();k.setContent(v.getNode('numTabs'),ea.length);ba();};function ca(event,ea){if(ea.menu!=x)return;var fa=j.get(ea.item,'threadID');t.inform('selected',fa);o.hide(w);}function da(event,ea){l.register(x);}l.subscribe('select',ca.bind(this));o.listen('show',w,function(){h.inform('layer_shown',{type:'ChatTabSelector'});da();});o.listen('hide',w,function(){h.inform('layer_hidden',{type:'ChatTabSelector'});});q.subscribe('threads-updated',ba);}p(t,new h());e.exports=t;},null);
__d("ChatTabViewCoordinator",["Arbiter","BanzaiODS","Bootloader","ChatTabModel","ChatTabView","ChatTabViewSelector","CSS","JSLogger","Style","Rect","VideoCallSupport","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=n.create('chat_tab_coordinator'),t,u;function v(w,x){var y=new l(w),z={},aa={},ba=false;function ca(){var oa=j.get(),pa={};oa.tabs.forEach(function(ra){pa[ra.id]=1;});s.log('process_tab_changed',{model_tabs:Object.keys(pa),view_tabs:Object.keys(z)});for(var qa in z)if(!pa[qa]){s.log('remove_tab',{tab_id:qa});z[qa].destroy();delete(z[qa]);}da(oa);ma(oa);if(oa.tabNeedsFocus&&!oa.tabNeedsFocus.isFocused())oa.tabNeedsFocus.focus();}function da(oa){var pa=null;oa.tabs.forEach(function(qa){var ra=qa.id,sa=false;if(!z[ra]){s.log('add_tab',{tab_id:ra});z[ra]=new k(ra,qa.server_id,qa.signatureID);sa=true;}else z[ra].updateSignatureID(qa.signatureID);if(z[ra].isFocused())oa.tabNeedsFocus=z[ra];if(sa||!z[ra].nextTabIs(pa)){var ta=z[ra].getScrollTop();if(pa){z[ra].insertBefore(pa);}else z[ra].appendTo(w);if(ta)z[ra].setScrollTop(ta);}pa=z[ra];});}function ea(){var oa=x.getShowingTabsOrder();if(!oa||!oa.length)return;var pa=z[oa[0].id]._tabElem,qa=z[oa[oa.length-1].id]._tabElem,ra=parseInt(o.get(qa,'margin-left'),10)||0,sa=p.getElementBounds(qa).l-2*ra;sa=sa>0?sa:0;t&&t.setBoundingBox(new p(0,p.getElementBounds(pa).r,0,sa));}function fa(oa,pa){var qa=false;pa.forEach(function(ta){if(ta.raised){if(aa[ta.id]){qa=true;delete aa[ta.id];}}else if(!aa[ta.id]){qa=true;aa[ta.id]=true;}});if(qa)return true;if(!t)return true;var ra=ga()||[];if(ra.length!==oa.length)return true;for(var sa=0;sa<oa.length;sa++)if(ra[sa]!==oa[sa].id)return true;return false;}function ga(){var oa=t&&t.getOrder();oa&&oa.reverse();return oa;}function ha(){var oa=ga();if(oa){h.bumpEntityKey('chat.web','tab.drag_order_changed');g.inform('chat/tabs-order-changed',oa);}}function ia(oa,pa,qa){if(z[qa]._scrollTop!=null)z[qa].setScrollTop(z[qa]._scrollTop);}function ja(oa,pa){u=pa;z[pa]._isDragDropActive=true;z[pa]._scrollTop=z[pa].getScrollTop();o.set(z[pa]._tabElem,'z-index',1);ea();h.bumpEntityKey('chat.web','tab.drag_started');}function ka(oa){o.set(z[oa]._tabElem,'z-index','');if(z[oa]._scrollTop!=null)z[oa].setScrollTop(z[oa]._scrollTop);z[oa]._scrollTop=null;u=null;setTimeout(function(){z[oa]._isDragDropActive=false;},0);}function la(oa){i.loadModules(["SortableGroup"],function(pa){var qa=x.getShowingTabsOrder(),ra=fa(qa,oa);if(qa.length<=1){t&&t.removeAllSortables();return;}if(ra){if(t){t.removeAllSortables();}else t=new pa().setBeforeGrabCallback(ja).setDragOverCallback(ia).setDropCallback(ka).setOrderChangeHandler(ha).setUseScroller(false).setDragOverHorizontally();for(var sa=0;sa<qa.length;sa++){var ta=qa[sa];t.addSortable(ta.id,z[ta.id]._tabElem,aa[ta.id]?null:z[ta.id]._titlebar);}}});}function ma(oa){var pa=x.getTabsToShow(oa),qa=[],ra=false;oa.tabs.forEach(function(sa){if(!pa[sa.id]){z[sa.id].setVisibleState(false,sa.raised);qa.push(sa);}});oa.tabs.forEach(function(sa){if(pa[sa.id]){z[sa.id].setVisibleState(true,sa.raised);ra|=sa.raised;}});y.setTabData(qa);na(ra);la(oa.tabs);}function na(oa){if(!oa&&ba){g.inform('layer_hidden',{type:'ChatTab'});ba=false;}else if(oa&&!ba){g.inform('layer_shown',{type:'ChatTab'});ba=true;}}if(q.isVideoCallSupported())m.addClass(w,'videoCallEnabled');x.subscribe('tabs-changed',ca);ca();}r(v.prototype,{forceDrop:function(){if(t&&u){t.forceDrop(u);u=null;return true;}return false;}});e.exports=v;},null);
__d("ChatApp",["CSS","JSLogger"],function(a,b,c,d,e,f,g,h){var i={init:function(j,k,l){if(this._isInitialized){h.create('chat_app').error('repeated_init');return;}this._rootElem=j;d(['TabsViewport','ChatTabController','ChatTabViewCoordinator','MercuryServerRequests','MercuryChannelHandler','MercuryStateCheck'],function(m,n,o,p,q,r){p.get().handleUpdate(l);this.tabsViewport=new m(k);this.tabViewCoordinator=new o(k,this.tabsViewport);this.tabController=new n(this.tabsViewport,this.tabViewCoordinator);this._isInitialized=this._isLoaded=true;}.bind(this));},isInitialized:function(){return !!this._isInitialized;},isHidden:function(){return !this._isInitialized||this._isHidden;},hide:function(){if(this.isHidden())return;g.hide(this._rootElem);this._isHidden=true;},unhide:function(){if(this._isInitialized){if(this._isHidden){g.show(this._rootElem);this.tabsViewport.checkWidth();d(['Dock'],function(j){j.resizeAllFlyouts();});this._isHidden=false;}}else if(!this._isLoaded){d(['UIPagelet'],function(j){j.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');j.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});this._isLoaded=true;}}};e.exports=i;},null);