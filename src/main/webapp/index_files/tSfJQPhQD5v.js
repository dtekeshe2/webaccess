/*!CK:3380930248!*//*1407732391,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["49sZ4"]); }

__d("AggregatedMapRedPin",["AggregatedMapPin","AggregatedMapRedPinSprite"],function(a,b,c,d,e,f,g,h){for(var i in g)if(g.hasOwnProperty(i))k[i]=g[i];var j=g===null?null:g.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=g;function k(l,m,n,o,p){"use strict";var q=h.dot(o);g.call(this,l,q,m,n,p);}e.exports=k;},null);
__d("legacy:AggregatedMap",["AggregatedMap","AggregatedMapCalloutOrientation"],function(a,b,c,d){a.AggregatedMap=b('AggregatedMap');a.AggregatedMapCalloutOrientation=b('AggregatedMapCalloutOrientation');},3);
__d("MicrosoftMapsBootloader",["Bootloader","MicrosoftMapsConfig"],function(a,b,c,d,e,f,g,h){var i=[],j=false,k={onLoad:function(l){if(j){l(a.Microsoft.Maps);}else i.push(l);}};a.__onMicrosoftMapsReady=function(){a.__onMicrosoftMapsReady=undefined;j=true;for(var l=0;l<i.length;l++)i[l](a.Microsoft.Maps);};g.requestJSResource(h.url);e.exports=k;},null);
__d("DynamicMap",["Arbiter","ArbiterMixin","CSS","DOM","MicrosoftMapsBootloader","Run","Rect","Style","Vector","copyProperties","ge","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s={},t=r(h);for(var u in t)if(t.hasOwnProperty(u))w[u]=t[u];var v=t===null?null:t.prototype;w.prototype=Object.create(v);w.prototype.constructor=w;w.__superConstructor__=t;function w(x,y,z,aa,ba,ca){"use strict";this.mapOptions={zoom:12,showScalebar:false,enableSearchLogo:false,showCopyright:true,showDashboard:true};this.params={lat:0,lon:0,draw_lines:false,view_padding:80};this.mapDiv=y;ba=ba||{};var da={};for(var ea=0;ea<aa.length;ea++)da[ea]=aa[ea];this.bingMapEvents=[];var fa=p(ba,{map_options:z,pins:da});k.onLoad(this.$DynamicMap0.bind(this,fa));this.copyrightDiv=ca;}w.prototype.getMap=function(){"use strict";return this.map;};w.prototype.getMicrosoftMaps=function(){"use strict";return this.microsoftMaps;};w.prototype.getWidth=function(){"use strict";return this.map.getWidth();};w.prototype.getHeight=function(){"use strict";return this.map.getHeight();};w.prototype.onInit=function(x){"use strict";if(!this.initialized){this.onInitCallback=x;}else x();};w.prototype.insertPointList=function(event,x){"use strict";this.$DynamicMap1(x);};w.prototype.$DynamicMap2=function(){"use strict";this.bingMapEvents.forEach(function(x){this.microsoftMaps.Events.removeHandler(x);}.bind(this));this.unsubscribe(this.updatePinsToken);this.unsubscribe(this.drawRadiusToken);this.unsubscribe(this.setViewToken);this.pins={};this.entities={};this.map.entities.clear();this.map=null;};w.prototype.$DynamicMap1=function(x){"use strict";var y=[];x.locations.forEach(function(aa){aa.point=new this.microsoftMaps.Location(aa.latitude,aa.longitude,aa.altitude);y.push(aa.point);}.bind(this));if(x.options){var z=function(aa){if(typeof aa==='string')return this.microsoftMaps.Color.fromHex(aa);return aa;}.bind(this);x.options.strokeColor=z(x.options.strokeColor);x.options.fillColor=z(x.options.fillColor);if(x.options.mouseover){x.options.mouseover.strokeColor=z(x.options.mouseover.strokeColor);x.options.mouseover.fillColor=z(x.options.mouseover.fillColor);}}if(x.type==='polygon'){x.entity=new this.microsoftMaps.Polygon(y,x.options);this.$DynamicMap3(x);}else x.entity=new this.microsoftMaps.Polyline(y,x.options);this.pointlists.push(x);this.map.entities.push(x.entity);};w.prototype.$DynamicMap3=function(x){"use strict";if(x.options&&x.options.callout){var y=new this.microsoftMaps.Infobox(this.$DynamicMap4(x.entity.getLocations()),{htmlContent:x.options.callout,visible:false});this.map.entities.push(y);}this.microsoftMaps.Events.addHandler(x.entity,'click',function(z,aa,ba){if(this.params.default_poly_events_handlers)this.$DynamicMap5(z,aa,ba);this.inform('DynamicMap/onPolyClick',z,this.BEHAVIOR_PERSISTENT);}.bind(this,x.entity,y,x.options));this.microsoftMaps.Events.addHandler(x.entity,'mouseover',function(z,aa){if(this.params.default_poly_events_handlers)this.$DynamicMap6(z,aa);this.inform('DynamicMap/onPolyMouseOver',z,this.BEHAVIOR_PERSISTENT);}.bind(this,x.entity,x.options.mouseover));this.microsoftMaps.Events.addHandler(x.entity,'mouseout',function(z,aa){if(this.params.default_poly_events_handlers)this.$DynamicMap7(z,aa);this.inform('DynamicMap/onPolyMouseOut',z,this.BEHAVIOR_PERSISTENT);}.bind(this,x.entity,x.options));this.microsoftMaps.Events.addHandler(y,'mouseenter',function(z,aa){if(this.params.default_poly_events_handlers)this.$DynamicMap8(z,aa);this.inform('DynamicMap/onPolyMouseEnter',z,this.BEHAVIOR_PERSISTENT);}.bind(this,x.entity,x.options));};w.prototype.$DynamicMap9=function(x){"use strict";var y=this.map.tryPixelToLocation(new this.microsoftMaps.Point(x.getX(),x.getY()),null);if(y){this.map.setView({animate:true,zoom:this.map.getZoom()+1,center:y,centerOffset:this.centerOffset});x.handled=true;}};w.prototype.$DynamicMap8=function(x,y){"use strict";if(this.lastPolyClicked&&this.lastPolyClicked!=x){this.lastPolyClicked.clicked=false;this.$DynamicMap7(this.lastPolyClicked,y);}this.$DynamicMap6(x,y.mouseover);};w.prototype.$DynamicMap5=function(x,y,z){"use strict";x.clicked=true;this.$DynamicMap8(x,z);this.$DynamicMap6(x,z.mouseover);if(y){this.$DynamicMapa();y.setOptions({visible:true});this.lastPolyInfoBox=y;}this.lastPolyClicked=x;this.lastPolyClickedFillColor=z.fillColor;};w.prototype.$DynamicMap6=function(x,y){"use strict";this.map.getRootElement().style.cursor='pointer';if(y){if(y.fillColor)x.setOptions({fillColor:y.fillColor});if(y.strokeColor)x.setOptions({strokeColor:y.strokeColor});}};w.prototype.$DynamicMap7=function(x,y){"use strict";this.map.getRootElement().style.cursor=this.cursorStyle;if(y&&!x.clicked)x.setOptions({fillColor:y.fillColor});};w.prototype.$DynamicMapa=function(){"use strict";if(this.lastPolyInfoBox){this.lastPolyInfoBox.setOptions({visible:false});this.lastPolyInfoBox=null;}};w.prototype.$DynamicMapb=function(){"use strict";if(this.lastPolyClicked){this.lastPolyClicked.setOptions({fillColor:this.lastPolyClickedFillColor});this.lastPolyClicked.clicked=false;}};w.prototype.$DynamicMap4=function(x){"use strict";var y=0,z=0,aa=0;for(var ba=0;ba<x.length;ba++){z+=x[ba].latitude;aa+=x[ba].longitude;y++;}return new this.microsoftMaps.Location(z/y,aa/y);};w.prototype.$DynamicMapc=function(x,y){"use strict";var z=this.map.getZoom()+y.zoom;if(z<=this.map.getZoomRange().max&&z>=this.map.getZoomRange().min)this.map.setView({animate:true,zoom:z,center:this.map.getCenter(),centerOffset:new this.microsoftMaps.Point(y.zoom>0?-this.centerOffset.x:this.centerOffset.x/2,y.zoom>0?-this.centerOffset.y:this.centerOffset.y/2)});};w.prototype.$DynamicMapd=function(x,y){"use strict";var z=y.pins||{};if(y.clear_existing){this.pins={};this.entities={};}p(this.pins,z);for(var aa in z){var ba;if(z[aa].latitude&&z[aa].longitude)ba=new this.microsoftMaps.Location(z[aa].latitude,z[aa].longitude);var ca=this.$DynamicMape(z[aa]);if(!this.entities[aa]){this.entities[aa]=new this.microsoftMaps.Pushpin(ba,ca);if(ca.draggable)this.microsoftMaps.Events.addHandler(this.entities[aa],'drag',function(da){var ea=da.entity.getLocation();this.inform('DynamicMap/pinDrag',{pin_id:aa,latitude:ea.latitude,longitude:ea.longitude},g.BEHAVIOR_PERSISTENT);}.bind(this));if(z[aa].infobox)this.microsoftMaps.Events.addHandler(this.entities[aa],function(da){var ea=new this.microsoftMaps.Infobox(this.entities[aa].getLocation(),z[aa].infobox);this.map.entities.push(ea);}.bind(this));if(z[aa].popupinfobox){this.microsoftMaps.Events.addHandler(this.entities[aa],'click',this.$DynamicMapf.bind(this,aa,z[aa].popupinfobox,'click'));this.microsoftMaps.Events.addHandler(this.entities[aa],'drag',this.$DynamicMapf.bind(this,aa,z[aa].popupinfobox,'drag'));if(z[aa].showpopupinfobox)this.$DynamicMapf(aa,z[aa].popupinfobox,'click');}}else{if(ba)this.entities[aa].setLocation(ba);this.entities[aa].setOptions(ca);}}this.$DynamicMapg(y.set_view,y.view_settings);this.$DynamicMaph();return false;};w.prototype.$DynamicMapf=function(x,y,z){"use strict";var aa=this.map.tryLocationToPixel(this.entities[x].getLocation());if(!aa)return;var ba=null;if(this.closeLastInfobox)ba=this.lastInfoboxId;this.$DynamicMapi({action:z,boundingbox:this.$DynamicMapj(this.entities[x]),popupinfobox:y,closeinfobox:ba,infoboxtype:this.pins[x].infoboxtype,map:this.map,centerOffset:this.centerOffset});if(z==='click')if(y===this.lastInfoboxId){this.lastInfoboxId=null;}else{this.lastInfoboxId=y;if(this.zoomOnClick){var ca=Math.max(this.map.getZoom(),this.MIN_ZOOM),da={x:this.clickOffsetX,y:this.clickOffsetY};this.$DynamicMapk([this.entities[x].getLocation()],{offset:da,zoom:ca});}}};w.prototype.$DynamicMapl=function(){"use strict";this.map.getCopyrights(function(x){j.setContent(this.copyrightDiv,x.join(' \u00b7 '));}.bind(this));};w.prototype.$DynamicMapm=function(x){"use strict";var y=this.map.tryPixelToLocation(new this.microsoftMaps.Point(x.getX(),x.getY()),null),z={x:x.getX(),y:x.getY(),lat:y&&y.latitude,lng:y&&y.longitude};this.$DynamicMapa();this.$DynamicMapb();this.inform('DynamicMap/onClick',z,this.BEHAVIOR_PERSISTENT);};w.prototype.$DynamicMapn=function(){"use strict";this.$DynamicMaph();this.$DynamicMapo('DynamicMap/onViewChange');};w.prototype.$DynamicMaph=function(){"use strict";var x={};this.boundaryPins.forEach(function(z){x[z]=this.pins[z];x[z].rect=this.$DynamicMapj(this.entities[z]);}.bind(this));this.inform('DynamicMap/onPinsChange',x);for(var y in this.pins)if(this.pins[y].popupinfobox)this.$DynamicMapf(y,this.pins[y].popupinfobox,'window_move');};w.prototype.$DynamicMapj=function(x){"use strict";var y=x.getAnchor(),z=this.map.tryLocationToPixel(x.getLocation(),this.microsoftMaps.PixelReference.control);if(z==null)return null;return new m(Math.round(z.y-y.y),Math.round(z.x-y.x+parseInt(x.getWidth(),10)),Math.round(z.y-y.y+parseInt(x.getHeight(),10)),Math.round(z.x-y.x));};w.prototype.$DynamicMapp=function(){"use strict";this.$DynamicMapo('DynamicMap/onViewChangeEnd');};w.prototype.$DynamicMapo=function(x){"use strict";var y=this.map.getBounds(),z={w:y.getWest(),n:y.getNorth(),e:y.getEast(),s:y.getSouth(),z:this.map.getZoom()};this.inform(x,z,this.BEHAVIOR_PERSISTENT);};w.prototype.$DynamicMape=function(x){"use strict";var y={src:'icon',height:'height',width:'width',zIndex:'zIndex',draggable:'draggable'},z={};for(var aa in y)if(typeof x[aa]!=='undefined')z[y[aa]]=x[aa];if(typeof x.anchorX!=='undefined'&&typeof x.anchorY!=='undefined')z.anchor=new this.microsoftMaps.Point(x.anchorX,x.anchorY);return z;};w.prototype.$DynamicMapk=function(x,y){"use strict";y=y||{};var z={animate:true,padding:this.params.view_padding};if(x.length==1){z.center=x[0];z.zoom=y.zoom||this.mapOptions.zoom;}else if(x.length>1){var aa=y.zoom;if(aa){if(aa>this.map.getZoom()){z.zoom=y.zoom;}else z.zoom=this.map.getZoom();}else{z.bounds=this.microsoftMaps.LocationRect.fromLocations(x);if(y.sizeFactor){z.bounds.width=z.bounds.width*y.sizeFactor.width;z.bounds.height=z.bounds.height*y.sizeFactor.height;}}if(y.onPin){var ba=this.pins[y.onPin];z.center=new this.microsoftMaps.Location(ba.latitude,ba.longitude);}if(y.offset){var ca=this.map.getCenter(),da=this.map.getZoom();z.animate=false;this.map.setView(z);var ea=this.map.getTargetCenter(),fa=this.map.getTargetZoom();this.map.setView({animate:false,center:ca,zoom:da});z=p(z,{animate:true,bounds:null,center:ea,zoom:fa});}}this.centerOffset.x=0;this.centerOffset.y=0;if(y.offset){z.centerOffset=new this.microsoftMaps.Point(y.offset.x,y.offset.y);this.centerOffset.x=z.centerOffset.x;this.centerOffset.y=z.centerOffset.y;if(!this.params.map_options.disableMouseInput&&!this.dblClickHandler)this.dblClickHandler=this.microsoftMaps.Events.addHandler(this.map,'dblclick',this.$DynamicMap9.bind(this));}this.map.setView(z);if(this.params.draw_lines)this.$DynamicMapq();};w.prototype.$DynamicMapq=function(){"use strict";this.boundaryPins.sort(function(y,z){var aa=this.pins[y].timestamp,ba=this.pins[z].timestamp;return (aa<ba)?-1:((aa>ba)?1:0);}.bind(this));var x=new this.microsoftMaps.Polyline(this.boundaryPinLocations,{strokeColor:new this.microsoftMaps.Color(100,59,89,151),strokeThickness:4});this.map.entities.push(x);};w.prototype.$DynamicMapr=function(x,y){"use strict";if(!this.map)return;var z=y/120000,aa=this.mapOptions.center,ba=new this.microsoftMaps.Location(aa.latitude+z,aa.longitude),ca=new this.microsoftMaps.Location(aa.latitude-z,aa.longitude);this.$DynamicMapk([ba,ca]);this.geoLocationProvider.addAccuracyCircle(aa,y,10000,{});};w.prototype.$DynamicMaps=function(x,y){"use strict";if(y.center)y.center=new this.microsoftMaps.Location(y.center.latitude,y.center.longitude);this.map.setView(y);};w.prototype.$DynamicMapg=function(x,y){"use strict";this.boundaryPins=[];var z=new this.microsoftMaps.EntityCollection();this.boundaryPinLocations=[];for(var aa in this.pins){var ba=this.entities[aa];if(this.pins[aa].inBounds){this.boundaryPins.push(aa);this.$DynamicMapt(this.boundaryPinLocations,ba);z.push(ba);}else if(this.params.show_all_pins)z.push(ba);}this.map.entities.clear();this.map.entities.push(z);this.pointlists.forEach(function(ca){this.map.entities.push(ca.entity);this.$DynamicMapt(this.boundaryPinLocations,ca.entity);}.bind(this));if(this.boundaryPinLocations.length&&x)this.$DynamicMapk(this.boundaryPinLocations,y);};w.prototype.$DynamicMapt=function(x,y){"use strict";if(y.getLocation){x.push(y.getLocation());}else if(y.getLocations)x.push.apply(x,y.getLocations());};w.prototype.$DynamicMap0=function(x,y){"use strict";this.microsoftMaps=y;this.centerOffset=new this.microsoftMaps.Point(0,0);p(this.params,x);this.mapOptions.center=new this.microsoftMaps.Location(x.lat,x.lon);this.mapOptions.backgroundColor=new this.microsoftMaps.Color(1,177,189,214);p(this.mapOptions,x.map_options);i.conditionClass(this.mapDiv,'mouseEventsDisabled',this.mapOptions.disableMouseInput);this.mapElem=this.mapDiv;this.map=new this.microsoftMaps.Map(this.mapDiv,this.mapOptions);this.cursorStyle=this.map.getRootElement().style.cursor;this.geoLocationProvider=new this.microsoftMaps.GeoLocationProvider(this.map);this.pins={};this.pointlists=[];this.boundaryPins=[];this.boundaryPinLocations=[];this.entities={};this.closeLastInfobox=x.auto_close_infobox;this.zoomOnClick=x.zoom_on_click;this.lastInfoboxId=null;this.lastPolyInfoBox=null;this.lastPolyClicked=null;this.lastPolyClickedFillColor=null;this.clickOffsetX=x.click_offset_x;this.clickOffsetY=x.click_offset_y;this.MIN_ZOOM=10;this.bingMapEvents=[this.microsoftMaps.Events.addHandler(this.map,'click',this.$DynamicMapm.bind(this)),this.microsoftMaps.Events.addHandler(this.map,'viewchange',this.$DynamicMapn.bind(this)),this.microsoftMaps.Events.addHandler(this.map,'viewchangeend',this.$DynamicMapp.bind(this)),this.microsoftMaps.Events.addHandler(this.map,'copyrightchanged',this.$DynamicMapl.bind(this))];if(x.pins)this.$DynamicMapd('init',{pins:x.pins});if(x.pointlists.length){x.pointlists.forEach(this.$DynamicMap1.bind(this));var z=[];for(var aa=0;aa<this.map.entities.getLength();aa++){var ba=this.map.entities.get(aa);this.$DynamicMapt(z,ba);}this.$DynamicMapk(z,x.view_settings);}if(x.map_options.enablePolylineDrawListener)g.subscribe('DynamicMap/addPolyline',this.insertPointList.bind(this));this.zoomToken=this.subscribe('DynamicMap/zoom',this.$DynamicMapc.bind(this));this.updatePinsToken=this.subscribe('DynamicMap/updatePins',this.$DynamicMapd.bind(this));this.drawRadiusToken=this.subscribe('DynamicMap/drawRadius',this.$DynamicMapr.bind(this));this.setViewToken=this.subscribe('DynamicMap/setView',this.$DynamicMaps.bind(this));l.onLeave(this.$DynamicMap2.bind(this));if(x.autocenter)this.$DynamicMapg(true,{});if(x.map_options.$DynamicMapr)this.$DynamicMapr(null,x.map_options.$DynamicMapr);this.$DynamicMapl();this.onInitCallback&&this.onInitCallback();this.inform('DynamicMap/onInit',this.pointlists,this.BEHAVIOR_PERSISTENT);this.initialized=true;};w.prototype.$DynamicMapi=function(x){"use strict";var y=parseInt(x.boundingbox.l+(x.boundingbox.r-x.boundingbox.l)/2,10),z=x.boundingbox.t,aa=q(x.popupinfobox),ba=x.closeinfobox,ca=x.map,da=x.centerOffset,ea,fa=false;if(aa){if(x.action==='click'){if(!aa.justDragged){if(!s[aa.id]){if(q(ba)){i.hide(ba);delete s[ba];}s[aa.id]=aa;fa=true;}else delete s[aa.id];}else{aa.justDragged=false;for(ea in s)i.removeClass(s[ea],'mapPopUpInfoboxInactive');}}else if(x.action==='drag'){aa.justDragged=true;for(ea in s)i.addClass(s[ea],'mapPopUpInfoboxInactive');}else aa.justDragged=false;if(s[aa.id]){if(x.boundingbox.l<0||x.boundingbox.t<0||x.boundingbox.r>this.getWidth()||x.boundingbox.b>this.getHeight()){i.hide(aa);}else{i.show(aa);var ga=o.getElementDimensions(aa),ha=y,ia=z-ga.y;if(x.infoboxtype==='placemap'){ha-=(ga.x/2);}else ha-=11;n.set(aa,'left',ha+'px');n.set(aa,'top',ia+'px');if(fa){var ja=ca.getWidth()-(ha+ga.x),ka=ca.getHeight()-(ia+ga.y);da.x=(ha<0)?-ha:0;da.x=(ja<0)?ja:da.x;da.y=(ia<0)?-ia:0;da.y=(ka<0)?ka:da.y;var la={animate:true,center:ca.getCenter(),centerOffset:da};ca.setView(la);}}}else i.hide(aa);}};e.exports=w;},null);